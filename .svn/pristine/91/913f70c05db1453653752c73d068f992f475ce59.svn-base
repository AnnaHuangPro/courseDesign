var w2ui=w2ui||{},w2obj=w2obj||{},w2utils=function(){function d(a){return/^[-+]?[0-9]+$/.test(a)}var c={};return{version:"1.4.3",settings:{locale:"en-us",date_format:"m/d/yyyy",date_display:"Mon d, yyyy",time_format:"hh:mi pm",currencyPrefix:"$",currencySuffix:"",currencyPrecision:2,groupSymbol:",",decimalSymbol:".",shortmonths:"Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" "),fullmonths:"January February March April May June July August September October November December".split(" "),
shortdays:"MTWTFSS".split(""),fulldays:"Monday Tuesday Wednesday Thursday Friday Saturday Sunday".split(" "),dataType:"HTTP",phrases:{}},isInt:d,isFloat:function(a){"string"==typeof a&&(a=a.replace(w2utils.settings.decimalSymbol,"."));return("number"===typeof a||"string"===typeof a&&""!==a)&&!isNaN(Number(a))},isMoney:function(a){var b=w2utils.settings,c=new RegExp("^"+(b.currencyPrefix?"\\"+b.currencyPrefix+"?":"")+"[-+]?[0-9]*[\\"+w2utils.settings.decimalSymbol+"]?[0-9]+"+(b.currencySuffix?"\\"+
b.currencySuffix+"?":"")+"$","i");"string"===typeof a&&(a=a.replace(new RegExp(b.groupSymbol,"g"),""));return"object"===typeof a||""===a?!1:c.test(a)},isHex:function(a){return/^[a-fA-F0-9]+$/.test(a)},isAlphaNumeric:function(a){return/^[a-zA-Z0-9_-]+$/.test(a)},isEmail:function(a){return/^[a-zA-Z0-9._%-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,4}$/.test(a)},isDate:function(a,b,c){if(!a)return!1;var f="Invalid Date",g,k,h;null==b&&(b=w2utils.settings.date_format);if("function"===typeof a.getUTCFullYear&&"function"===
typeof a.getUTCMonth&&"function"===typeof a.getUTCDate)h=a.getUTCFullYear(),g=a.getUTCMonth(),k=a.getUTCDate();else if("function"===typeof a.getFullYear&&"function"===typeof a.getMonth&&"function"===typeof a.getDate)h=a.getFullYear(),g=a.getMonth(),k=a.getDate();else{a=String(a);if(RegExp("mon","ig").test(b)){b=b.replace(/month/ig,"m").replace(/mon/ig,"m").replace(/dd/ig,"d").replace(/[, ]/ig,"/").replace(/\/\//g,"/").toLowerCase();a=a.replace(/[, ]/ig,"/").replace(/\/\//g,"/").toLowerCase();for(var f=
0,l=w2utils.settings.fullmonths.length;f<l;f++){var m=w2utils.settings.fullmonths[f];a=a.replace(RegExp(m,"ig"),parseInt(f)+1).replace(RegExp(m.substr(0,3),"ig"),parseInt(f)+1)}}a=a.replace(/-/g,"/").replace(/\./g,"/").toLowerCase().split("/");b=b.replace(/-/g,"/").replace(/\./g,"/").toLowerCase();"mm/dd/yyyy"===b&&(g=a[0],k=a[1],h=a[2]);"m/d/yyyy"===b&&(g=a[0],k=a[1],h=a[2]);"dd/mm/yyyy"===b&&(g=a[1],k=a[0],h=a[2]);"d/m/yyyy"===b&&(g=a[1],k=a[0],h=a[2]);"yyyy/dd/mm"===b&&(g=a[2],k=a[1],h=a[0]);"yyyy/d/m"===
b&&(g=a[2],k=a[1],h=a[0]);"yyyy/mm/dd"===b&&(g=a[1],k=a[2],h=a[0]);"yyyy/m/d"===b&&(g=a[1],k=a[2],h=a[0]);"mm/dd/yy"===b&&(g=a[0],k=a[1],h=a[2]);"m/d/yy"===b&&(g=a[0],k=a[1],h=parseInt(a[2])+1900);"dd/mm/yy"===b&&(g=a[1],k=a[0],h=parseInt(a[2])+1900);"d/m/yy"===b&&(g=a[1],k=a[0],h=parseInt(a[2])+1900);"yy/dd/mm"===b&&(g=a[2],k=a[1],h=parseInt(a[0])+1900);"yy/d/m"===b&&(g=a[2],k=a[1],h=parseInt(a[0])+1900);"yy/mm/dd"===b&&(g=a[1],k=a[2],h=parseInt(a[0])+1900);"yy/m/d"===b&&(g=a[1],k=a[2],h=parseInt(a[0])+
1900)}if(!d(h)||!d(g)||!d(k))return!1;h=+h;g=+g;k=+k;f=new Date(h,g-1,k);return null==g||"Invalid Date"==String(f)||f.getMonth()+1!==g||f.getDate()!==k||f.getFullYear()!==h?!1:!0===c?f:!0},isTime:function(a,b){if(null==a)return!1;var c,f;a=String(a);a=a.toUpperCase();var g=(f=0<=a.indexOf("PM"))||0<=a.indexOf("AM");c=g?12:24;a=a.replace("AM","").replace("PM","");a=$.trim(a);var d=a.split(":"),h=parseInt(d[0]||0),l=parseInt(d[1]||0);return(!g||1!==d.length)&&2!==d.length||""===d[0]||0>h||h>c||!this.isInt(d[0])||
2<d[0].length||2===d.length&&(""===d[1]||0>l||59<l||!this.isInt(d[1])||2!==d[1].length)||!g&&c===h&&0!==l||g&&1===d.length&&0===h?!1:!0===b?(f&&(h+=12),{hours:h,minutes:l}):!0},age:function(a){if(""===a||null==a)return"";var b=new Date(a);w2utils.isInt(a)&&(b=new Date(Number(a)));if("Invalid Date"==String(b))return"";a=((new Date).getTime()-b.getTime())/1E3;var c=b="";0>a?(b='<span style="color: #aaa">future</span>',c=""):60>a?(b=Math.floor(a),c="sec",0>a&&(b=0,c="sec")):3600>a?(b=Math.floor(a/60),
c="min"):86400>a?(b=Math.floor(a/60/60),c="hour"):2592E3>a?(b=Math.floor(a/24/60/60),c="day"):31557600>a?(b=Math.floor(a/365.25/24/60/60*10)/10,c="month"):31557600<=a&&(b=Math.floor(a/365.25/24/60/60*10)/10,c="year");return b+" "+c+(1<b?"s":"")},date:function(a){if(""===a||null==a)return"";var b=new Date(a);w2utils.isInt(a)&&(b=new Date(Number(a)));if("Invalid Date"==String(b))return"";var c=w2utils.settings.shortmonths,f=new Date,g=new Date;g.setTime(g.getTime()-864E5);a=c[b.getMonth()]+" "+b.getDate()+
", "+b.getFullYear();var f=c[f.getMonth()]+" "+f.getDate()+", "+f.getFullYear(),c=c[g.getMonth()]+" "+g.getDate()+", "+g.getFullYear(),g=b.getHours()-(12<b.getHours()?12:0)+":"+(10>b.getMinutes()?"0":"")+b.getMinutes()+" "+(12<=b.getHours()?"pm":"am"),b=b.getHours()-(12<b.getHours()?12:0)+":"+(10>b.getMinutes()?"0":"")+b.getMinutes()+":"+(10>b.getSeconds()?"0":"")+b.getSeconds()+" "+(12<=b.getHours()?"pm":"am"),d=a;a===f&&(d=g);a===c&&(d=w2utils.lang("Yesterday"));return'<span title="'+a+" "+b+'">'+
d+"</span>"},size:function(a){if(!w2utils.isFloat(a)||""===a)return"";a=parseFloat(a);if(0===a)return 0;var b=parseInt(Math.floor(Math.log(a)/Math.log(1024)));return(Math.floor(a/Math.pow(1024,b)*10)/10).toFixed(0===b?0:1)+" "+["Bt","KB","MB","GB","TB"][b]},formatNumber:function(a,b,e){e="";null==b&&(b=w2utils.settings.groupSymbol||",");if(w2utils.isFloat(a)||w2utils.isInt(a)||w2utils.isMoney(a))c=String(a).split("."),e=String(c[0]).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1"+b),null!=c[1]&&(e+=w2utils.settings.decimalSymbol+
c[1]);return e},formatDate:function(a,b){b||(b=this.settings.date_format);if(""===a||null==a||"object"==typeof a&&!a.getMonth)return"";var c=new Date(a);w2utils.isInt(a)&&(c=new Date(Number(a)));if("Invalid Date"==String(c))return"";var f=c.getFullYear(),g=c.getMonth(),c=c.getDate();return b.toLowerCase().replace("month",w2utils.settings.fullmonths[g]).replace("mon",w2utils.settings.shortmonths[g]).replace(/yyyy/g,f).replace(/yyy/g,f).replace(/yy/g,2E3<f?100+parseInt(String(f).substr(2)):String(f).substr(2)).replace(/(^|[^a-z$])y/g,
"$1"+f).replace(/mm/g,(10>g+1?"0":"")+(g+1)).replace(/dd/g,(10>c?"0":"")+c).replace(/th/g,1==c?"st":"th").replace(/th/g,2==c?"nd":"th").replace(/th/g,3==c?"rd":"th").replace(/(^|[^a-z$])m/g,"$1"+(g+1)).replace(/(^|[^a-z$])d/g,"$1"+c)},formatTime:function(a,b){b||(b=this.settings.time_format);if(""===a||null==a||"object"==typeof a&&!a.getMonth)return"";var c=new Date(a);w2utils.isInt(a)&&(c=new Date(Number(a)));if(w2utils.isTime(a)){var f=w2utils.isTime(a,!0),c=new Date;c.setHours(f.hours);c.setMinutes(f.minutes)}if("Invalid Date"==
String(c))return"";var f="am",g=c.getHours(),d=c.getHours(),h=c.getMinutes(),c=c.getSeconds();10>h&&(h="0"+h);10>c&&(c="0"+c);if(-1!==b.indexOf("am")||-1!==b.indexOf("pm"))12<=g&&(f="pm"),12<g&&(g-=12);return b.toLowerCase().replace("am",f).replace("pm",f).replace("hhh",10>g?"0"+g:g).replace("hh24",10>d?"0"+d:d).replace("h24",d).replace("hh",g).replace("mm",h).replace("mi",h).replace("ss",c).replace(/(^|[^a-z$])h/g,"$1"+g).replace(/(^|[^a-z$])m/g,"$1"+h).replace(/(^|[^a-z$])s/g,"$1"+c)},formatDateTime:function(a,
b){var c;if(""===a||null==a||"object"==typeof a&&!a.getMonth)return"";c="string"!==typeof b?[this.settings.date_format,this.settings.time_format]:b.split("|");return this.formatDate(a,c[0])+" "+this.formatTime(a,c[1])},stripTags:function(a){if(null===a)return a;switch(typeof a){case "string":a=$.trim(String(a).replace(/(<([^>]+)>)/ig,""));break;case "object":for(var b in a)a[b]=this.stripTags(a[b])}return a},encodeTags:function(a){if(null===a)return a;switch(typeof a){case "string":a=String(a).replace(/&/g,
"&amp;").replace(/>/g,"&gt;").replace(/</g,"&lt;").replace(/"/g,"&quot;");break;case "object":for(var b in a)a[b]=this.encodeTags(a[b])}return a},escapeId:function(a){return""===a||null==a?"":String(a).replace(/([;&,\.\+\*\~'`:"\!\^#$%@\[\]\(\)=<>\|\/? {}\\])/g,"\\$1")},base64encode:function(a){var b="",c,f,g,d,h,l,m=0;a=String(a).replace(/\r\n/g,"\n");f="";for(g=0;g<a.length;g++)d=a.charCodeAt(g),128>d?f+=String.fromCharCode(d):(127<d&&2048>d?f+=String.fromCharCode(d>>6|192):(f+=String.fromCharCode(d>>
12|224),f+=String.fromCharCode(d>>6&63|128)),f+=String.fromCharCode(d&63|128));for(a=f;m<a.length;)c=a.charCodeAt(m++),f=a.charCodeAt(m++),g=a.charCodeAt(m++),d=c>>2,c=(c&3)<<4|f>>4,h=(f&15)<<2|g>>6,l=g&63,isNaN(f)?h=l=64:isNaN(g)&&(l=64),b=b+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(d)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(c)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(h)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(l);
return b},base64decode:function(a){var b="",c,f,g,d,h,l=0;for(a=a.replace(/[^A-Za-z0-9\+\/\=]/g,"");l<a.length;)c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(l++)),f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(l++)),d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(l++)),h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a.charAt(l++)),c=c<<2|f>>4,f=(f&
15)<<4|d>>2,g=(d&3)<<6|h,b+=String.fromCharCode(c),64!==d&&(b+=String.fromCharCode(f)),64!==h&&(b+=String.fromCharCode(g));a=b;b="";for(h=d=0;d<a.length;)h=a.charCodeAt(d),128>h?(b+=String.fromCharCode(h),d++):191<h&&224>h?(l=a.charCodeAt(d+1),b+=String.fromCharCode((h&31)<<6|l&63),d+=2):(l=a.charCodeAt(d+1),c=a.charCodeAt(d+2),b+=String.fromCharCode((h&15)<<12|(l&63)<<6|c&63),d+=3);return b},transition:function(a,b,c,f){function g(a,b,c){window.webkitURL||"undefined"===typeof c||(b=c);return";"+
a+": "+b+"; -webkit-"+a+": "+b+"; -moz-"+a+": "+b+"; -ms-"+a+": "+b+"; -o-"+a+": "+b+";"}var d=$(a).width(),h=$(a).height();if(a&&b){a.parentNode.style.cssText+=g("perspective","700px")+"; overflow: hidden;";a.style.cssText+="; position: absolute; z-index: 1019; "+g("backface-visibility","hidden");b.style.cssText+="; position: absolute; z-index: 1020; "+g("backface-visibility","hidden");switch(c){case "slide-left":a.style.cssText+="overflow: hidden; "+g("transform","translate3d(0, 0, 0)","translate(0, 0)");
b.style.cssText+="overflow: hidden; "+g("transform","translate3d("+d+"px, 0, 0)","translate("+d+"px, 0)");$(b).show();window.setTimeout(function(){b.style.cssText+=g("transition","0.5s")+";"+g("transform","translate3d(0, 0, 0)","translate(0, 0)");a.style.cssText+=g("transition","0.5s")+";"+g("transform","translate3d(-"+d+"px, 0, 0)","translate(-"+d+"px, 0)")},1);break;case "slide-right":a.style.cssText+="overflow: hidden; "+g("transform","translate3d(0, 0, 0)","translate(0, 0)");b.style.cssText+=
"overflow: hidden; "+g("transform","translate3d(-"+d+"px, 0, 0)","translate(-"+d+"px, 0)");$(b).show();window.setTimeout(function(){b.style.cssText+=g("transition","0.5s")+"; "+g("transform","translate3d(0px, 0, 0)","translate(0px, 0)");a.style.cssText+=g("transition","0.5s")+"; "+g("transform","translate3d("+d+"px, 0, 0)","translate("+d+"px, 0)")},1);break;case "slide-down":a.style.cssText+="overflow: hidden; z-index: 1; "+g("transform","translate3d(0, 0, 0)","translate(0, 0)");b.style.cssText+=
"overflow: hidden; z-index: 0; "+g("transform","translate3d(0, 0, 0)","translate(0, 0)");$(b).show();window.setTimeout(function(){b.style.cssText+=g("transition","0.5s")+"; "+g("transform","translate3d(0, 0, 0)","translate(0, 0)");a.style.cssText+=g("transition","0.5s")+"; "+g("transform","translate3d(0, "+h+"px, 0)","translate(0, "+h+"px)")},1);break;case "slide-up":a.style.cssText+="overflow: hidden; "+g("transform","translate3d(0, 0, 0)","translate(0, 0)");b.style.cssText+="overflow: hidden; "+
g("transform","translate3d(0, "+h+"px, 0)","translate(0, "+h+"px)");$(b).show();window.setTimeout(function(){b.style.cssText+=g("transition","0.5s")+"; "+g("transform","translate3d(0, 0, 0)","translate(0, 0)");a.style.cssText+=g("transition","0.5s")+"; "+g("transform","translate3d(0, 0, 0)","translate(0, 0)")},1);break;case "flip-left":a.style.cssText+="overflow: hidden; "+g("transform","rotateY(0deg)");b.style.cssText+="overflow: hidden; "+g("transform","rotateY(-180deg)");$(b).show();window.setTimeout(function(){b.style.cssText+=
g("transition","0.5s")+"; "+g("transform","rotateY(0deg)");a.style.cssText+=g("transition","0.5s")+"; "+g("transform","rotateY(180deg)")},1);break;case "flip-right":a.style.cssText+="overflow: hidden; "+g("transform","rotateY(0deg)");b.style.cssText+="overflow: hidden; "+g("transform","rotateY(180deg)");$(b).show();window.setTimeout(function(){b.style.cssText+=g("transition","0.5s")+"; "+g("transform","rotateY(0deg)");a.style.cssText+=g("transition","0.5s")+"; "+g("transform","rotateY(-180deg)")},
1);break;case "flip-down":a.style.cssText+="overflow: hidden; "+g("transform","rotateX(0deg)");b.style.cssText+="overflow: hidden; "+g("transform","rotateX(180deg)");$(b).show();window.setTimeout(function(){b.style.cssText+=g("transition","0.5s")+"; "+g("transform","rotateX(0deg)");a.style.cssText+=g("transition","0.5s")+"; "+g("transform","rotateX(-180deg)")},1);break;case "flip-up":a.style.cssText+="overflow: hidden; "+g("transform","rotateX(0deg)");b.style.cssText+="overflow: hidden; "+g("transform",
"rotateX(-180deg)");$(b).show();window.setTimeout(function(){b.style.cssText+=g("transition","0.5s")+"; "+g("transform","rotateX(0deg)");a.style.cssText+=g("transition","0.5s")+"; "+g("transform","rotateX(180deg)")},1);break;case "pop-in":a.style.cssText+="overflow: hidden; "+g("transform","translate3d(0, 0, 0)","translate(0, 0)");b.style.cssText+="overflow: hidden; "+g("transform","translate3d(0, 0, 0)","translate(0, 0)")+"; "+g("transform","scale(.8)")+"; opacity: 0;";$(b).show();window.setTimeout(function(){b.style.cssText+=
g("transition","0.5s")+"; "+g("transform","scale(1)")+"; opacity: 1;";a.style.cssText+=g("transition","0.5s")+";"},1);break;case "pop-out":a.style.cssText+="overflow: hidden; "+g("transform","translate3d(0, 0, 0)","translate(0, 0)")+"; "+g("transform","scale(1)")+"; opacity: 1;";b.style.cssText+="overflow: hidden; "+g("transform","translate3d(0, 0, 0)","translate(0, 0)")+"; opacity: 0;";$(b).show();window.setTimeout(function(){b.style.cssText+=g("transition","0.5s")+"; opacity: 1;";a.style.cssText+=
g("transition","0.5s")+"; "+g("transform","scale(1.7)")+"; opacity: 0;"},1);break;default:a.style.cssText+="overflow: hidden; "+g("transform","translate3d(0, 0, 0)","translate(0, 0)"),b.style.cssText+="overflow: hidden; "+g("transform","translate3d(0, 0, 0)","translate(0, 0)")+"; opacity: 0;",$(b).show(),window.setTimeout(function(){b.style.cssText+=g("transition","0.5s")+"; opacity: 1;";a.style.cssText+=g("transition","0.5s")},1)}setTimeout(function(){"slide-down"===c&&($(a).css("z-index","1019"),
$(b).css("z-index","1020"));b&&$(b).css({opacity:"1","-webkit-transition":"","-moz-transition":"","-ms-transition":"","-o-transition":"","-webkit-transform":"","-moz-transform":"","-ms-transform":"","-o-transform":"","-webkit-backface-visibility":"","-moz-backface-visibility":"","-ms-backface-visibility":"","-o-backface-visibility":""});a&&($(a).css({opacity:"1","-webkit-transition":"","-moz-transition":"","-ms-transition":"","-o-transition":"","-webkit-transform":"","-moz-transform":"","-ms-transform":"",
"-o-transform":"","-webkit-backface-visibility":"","-moz-backface-visibility":"","-ms-backface-visibility":"","-o-backface-visibility":""}),a.parentNode&&$(a.parentNode).css({"-webkit-perspective":"","-moz-perspective":"","-ms-perspective":"","-o-perspective":""}));"function"===typeof f&&f()},500)}else console.log("ERROR: Cannot do transition when one of the divs is null")},lock:function(a,b,c){var f={};"object"===typeof b?f=b:(f.msg=b,f.spinner=c);f.msg||0===f.msg||(f.msg="");w2utils.unlock(a);$(a).prepend('<div class="w2ui-lock"></div><div class="w2ui-lock-msg"></div>');
b=$(a).find(".w2ui-lock");a=$(a).find(".w2ui-lock-msg");f.msg||a.css({"background-color":"transparent",border:"0px"});!0===f.spinner&&(f.msg='<div class="w2ui-spinner" '+(f.msg?"":'style="width: 35px; height: 35px"')+"></div>"+f.msg);null!=f.opacity&&b.css("opacity",f.opacity);"function"==typeof b.fadeIn?(b.fadeIn(200),a.html(f.msg).fadeIn(200)):(b.show(),a.html(f.msg).show(0));$().w2tag()},unlock:function(a){$(a).find(".w2ui-lock").remove();$(a).find(".w2ui-lock-msg").remove()},lang:function(a){var b=
this.settings.phrases[a];return null==b?a:b},locale:function(a){a||(a="en-us");5===a.length&&(a="locale/"+a+".json");$.ajax({url:a,type:"GET",dataType:"JSON",async:!1,cache:!1,success:function(a,c,f){w2utils.settings=$.extend(!0,w2utils.settings,a);a=w2obj.grid.prototype;for(var g in a.buttons)a.buttons[g].caption=w2utils.lang(a.buttons[g].caption),a.buttons[g].hint=w2utils.lang(a.buttons[g].hint);a.msgDelete=w2utils.lang(a.msgDelete);a.msgNotJSON=w2utils.lang(a.msgNotJSON);a.msgRefresh=w2utils.lang(a.msgRefresh)},
error:function(b,c,f){console.log("ERROR: Cannot load locale "+a)}})},getSize:function(a,b){var c=$(a),f=parseInt(c.css("border-left-width"))||0,g=parseInt(c.css("border-right-width"))||0,d=parseInt(c.css("border-top-width"))||0,h=parseInt(c.css("border-bottom-width"))||0,l=parseInt(c.css("margin-left"))||0,m=parseInt(c.css("margin-right"))||0,n=parseInt(c.css("margin-top"))||0,p=parseInt(c.css("margin-bottom"))||0,r=parseInt(c.css("padding-left"))||0,u=parseInt(c.css("padding-right"))||0,x=parseInt(c.css("padding-top"))||
0,t=parseInt(c.css("padding-bottom"))||0;switch(b){case "top":return d+n+x;case "bottom":return h+p+t;case "left":return f+l+r;case "right":return g+m+u;case "width":return f+g+l+m+r+u+parseInt(c.width());case "height":return d+h+n+p+x+t+parseInt(c.height());case "+width":return f+g+l+m+r+u;case "+height":return d+h+n+p+x+t}return 0},scrollBarSize:function(){if(c.scrollBarSize)return c.scrollBarSize;$("body").append('<div id="_scrollbar_width" style="position: absolute; top: -300px; width: 100px; height: 100px; overflow-y: scroll;">    <div style="height: 120px">1</div></div>');
c.scrollBarSize=100-$("#_scrollbar_width > div").width();$("#_scrollbar_width").remove();0<=String(navigator.userAgent).indexOf("MSIE")&&(c.scrollBarSize/=2);return c.scrollBarSize},checkName:function(a,b){return a&&"undefined"!==typeof a.name?"undefined"!==typeof w2ui[a.name]?(console.log('ERROR: The parameter "name" is not unique. There are other objects already created with the same name (obj: '+a.name+")."),!1):w2utils.isAlphaNumeric(a.name)?!0:(console.log('ERROR: The parameter "name" has to be alpha-numeric (a-z, 0-9, dash and underscore). '),
!1):(console.log('ERROR: The parameter "name" is required but not supplied in $().'+b+"()."),!1)},checkUniqueId:function(a,b,c,f){$.isArray(b)||(b=[b]);for(var g=0;g<b.length;g++)if(b[g].id===a)return console.log('ERROR: The parameter "id='+a+'" is not unique within the current '+c+". (obj: "+f+")"),!1;return!0},parseRoute:function(a){var b=[];a=a.replace(/\/\(/g,"(?:/").replace(/\+/g,"__plus__").replace(/(\/)?(\.)?:(\w+)(?:(\(.*?\)))?(\?)?/g,function(a,c,g,d,h,l){b.push({name:d,optional:!!l});c=
c||"";return""+(l?"":c)+"(?:"+(l?c:"")+(g||"")+(h||g&&"([^/.]+?)"||"([^/]+?)")+")"+(l||"")}).replace(/([\/.])/g,"\\$1").replace(/__plus__/g,"(.+)").replace(/\*/g,"(.*)");return{path:new RegExp("^"+a+"$","i"),keys:b}},isIOS:-1!=navigator.userAgent.toLowerCase().indexOf("iphone")||-1!=navigator.userAgent.toLowerCase().indexOf("ipod")||-1!=navigator.userAgent.toLowerCase().indexOf("ipad")?!0:!1,isIE:-1!=navigator.userAgent.toLowerCase().indexOf("msie")||-1!=navigator.userAgent.toLowerCase().indexOf("trident")?
!0:!1}}();
w2utils.event={on:function(d,c){$.isPlainObject(d)||(d={type:d});d=$.extend({type:null,execute:"before",target:null,onComplete:null},d);d.type?c?($.isArray(this.handlers)||(this.handlers=[]),this.handlers.push({event:d,handler:c})):console.log("ERROR: You must specify event handler function when calling .on() method of "+this.name):console.log("ERROR: You must specify event type when calling .on() method of "+this.name)},off:function(d,c){$.isPlainObject(d)||(d={type:d});d=$.extend({},{type:null,execute:"before",
target:null,onComplete:null},d);if(d.type){c||(c=null);for(var a=[],b=0,e=this.handlers.length;b<e;b++){var f=this.handlers[b];(f.event.type!==d.type&&"*"!==d.type||f.event.target!==d.target&&null!==d.target||f.handler!==c&&null!==c)&&a.push(f)}this.handlers=a}else console.log("ERROR: You must specify event type when calling .off() method of "+this.name)},trigger:function(d){d=$.extend({type:null,phase:"before",target:null},d,{isStopped:!1,isCancelled:!1,preventDefault:function(){this.isCancelled=
!0},stopPropagation:function(){this.isStopped=!0}});"before"===d.phase&&(d.onComplete=null);var c,a,b;null==d.target&&(d.target=null);$.isArray(this.handlers)||(this.handlers=[]);for(a=this.handlers.length-1;0<=a;a--){var e=this.handlers[a];if(!(e.event.type!==d.type&&"*"!==e.event.type||e.event.target!==d.target&&null!==e.event.target||e.event.execute!==d.phase&&"*"!==e.event.execute&&"*"!==e.event.phase)&&(d=$.extend({},e.event,d),c=[],(b=RegExp(/\((.*?)\)/).exec(e.handler))&&(c=b[1].split(/\s*,\s*/)),
2===c.length?e.handler.call(this,d.target,d):e.handler.call(this,d),!0===d.isStopped||!0===d.stop))return d}e="on"+d.type.substr(0,1).toUpperCase()+d.type.substr(1);if("before"===d.phase&&"function"===typeof this[e]&&(a=this[e],c=[],(b=RegExp(/\((.*?)\)/).exec(a))&&(c=b[1].split(/\s*,\s*/)),2===c.length?a.call(this,d.target,d):a.call(this,d),!0===d.isStopped||!0===d.stop)||null!=d.object&&"before"===d.phase&&"function"===typeof d.object[e]&&(a=d.object[e],c=[],(b=RegExp(/\((.*?)\)/).exec(a))&&(c=
b[1].split(/\s*,\s*/)),2===c.length?a.call(this,d.target,d):a.call(this,d),!0===d.isStopped||!0===d.stop))return d;"after"===d.phase&&"function"===typeof d.onComplete&&d.onComplete.call(this,d);return d}};
w2utils.keyboard=function(d){var c=null;d.active=function(a){"undefined"!==typeof a&&(c=a);return c};d.clear=function(){c=null};$(document).on("keydown",function(a){-1===$.inArray(a.target.tagName,["INPUT","SELECT","TEXTAREA"])&&"true"!==$(a.target).prop("contenteditable")&&c&&w2ui[c]&&"function"===typeof w2ui[c].keydown&&w2ui[c].keydown.call(w2ui[c],a)});$(document).on("mousedown",function(a){a=$(a.target).parents(".w2ui-reset");0<a.length&&(a=a.attr("name"),w2ui[a]&&w2ui[a].keyboard&&(c=a))});return d}({});
(function(){$.fn.w2render=function(d){0<$(this).length&&("string"===typeof d&&w2ui[d]&&w2ui[d].render($(this)[0]),"object"===typeof d&&d.render($(this)[0]))};$.fn.w2destroy=function(d){!d&&0<this.length&&(d=this.attr("name"));"string"===typeof d&&w2ui[d]&&w2ui[d].destroy();"object"===typeof d&&d.destroy()};$.fn.w2marker=function(d){return""===d||null==d?$(this).each(function(c,a){a.innerHTML=a.innerHTML.replace(/\<span class=\"w2ui\-marker\"\>(.*)\<\/span\>/ig,"$1")}):$(this).each(function(c,a){function b(a){return'<span class="w2ui-marker">'+
a+"</span>"}"string"===typeof d&&(d=[d]);a.innerHTML=a.innerHTML.replace(/\<span class=\"w2ui\-marker\"\>(.*)\<\/span\>/ig,"$1");for(var e in d){var f=d[e];"string"!==typeof f&&(f=String(f));f=f.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&").replace(/&/g,"&amp;").replace(/</g,"&gt;").replace(/>/g,"&lt;");a.innerHTML=a.innerHTML.replace(new RegExp(f+"(?!([^<]+)?>)","gi"),b)}})};$.fn.w2tag=function(d,c){$.isPlainObject(c)||(c={});$.isPlainObject(c.css)||(c.css={});"undefined"===typeof c["class"]&&(c["class"]=
"");if(0===$(this).length)$(".w2ui-tag").each(function(a,b){var c=$(b).data("options");null==c&&(c={});$($(b).data("taged-el")).removeClass(c["class"]);clearInterval($(b).data("timer"));$(b).remove()});else return $(this).each(function(a,b){var e=b.id,f=w2utils.escapeId(b.id);if(""===d||null==d)$("#w2ui-tag-"+f).css("opacity",0),setTimeout(function(){clearInterval($("#w2ui-tag-"+f).data("timer"));$("#w2ui-tag-"+f).remove()},300);else{var g=function(){$tag=$("#w2ui-tag-"+f);if(!(0>=$tag.length)&&(clearInterval($tag.data("timer")),
$tag.remove(),$(b).off("keypress",g).removeClass(c["class"]),0<$(b).length&&($(b)[0].style.cssText=h),"function"===typeof c.onHide))c.onHide()};clearInterval($("#w2ui-tag-"+f).data("timer"));$("#w2ui-tag-"+f).remove();$("body").append('<div id="w2ui-tag-'+e+'" class="w2ui-tag '+(0<$(b).parents(".w2ui-popup").length?"w2ui-tag-popup":"")+'" style=""></div>');var k=setInterval(function(){0===$(b).length||0===$(b).offset().left&&0===$(b).offset().top?(clearInterval($("#w2ui-tag-"+f).data("timer")),g()):
$("#w2ui-tag-"+f).data("position")!==$(b).offset().left+b.offsetWidth+"x"+$(b).offset().top&&$("#w2ui-tag-"+f).css({"-webkit-transition":".2s","-moz-transition":".2s","-ms-transition":".2s","-o-transition":".2s",left:$(b).offset().left+b.offsetWidth+"px",top:$(b).offset().top+"px"}).data("position",$(b).offset().left+b.offsetWidth+"x"+$(b).offset().top)},100);setTimeout(function(){if($(b).offset()&&($("#w2ui-tag-"+f).css({opacity:"1",left:$(b).offset().left+b.offsetWidth+"px",top:$(b).offset().top+
"px"}).html('<div style="margin-top: -2px 0px 0px -2px; white-space: nowrap;"> <div class="w2ui-tag-body">'+d+"</div> </div>").data("text",d).data("taged-el",b).data("options",c).data("position",$(b).offset().left+b.offsetWidth+"x"+$(b).offset().top).data("timer",k),$(b).off("keypress",g).on("keypress",g).off("change",g).on("change",g).css(c.css).addClass(c["class"]),"function"===typeof c.onShow))c.onShow()},1);var h="";0<$(b).length&&(h=$(b)[0].style.cssText)}})};$.fn.w2overlay=function(d,c){function a(){var c=
$("#w2ui-overlay"+g);if(c.data("element")===f[0]&&0!==c.length){var e=$(f).offset().left+"x"+$(f).offset().top;c.data("position")!==e?b():setTimeout(a,250)}}function b(){var a=$("#w2ui-overlay"+g);if(!0===a.data("keepOpen"))a.removeData("keepOpen");else{var e;"function"===typeof c.onHide&&(e=c.onHide());!1!==e&&(a.remove(),$(document).off("click",b),clearInterval(a.data("timer")))}}function e(){var a=$("#w2ui-overlay"+g),b=a.find(" > div");if(0<a.length){b.height("auto").width("auto");var d=b.height(),
h=b.width();c.width&&c.width<h&&(h=c.width);30>h&&(h=30);c.tmp.contentHeight&&(d=c.tmp.contentHeight,b.height(d),setTimeout(function(){b.height()>b.find("div.menu > table").height()&&b.find("div.menu").css("overflow-y","hidden")},1),setTimeout(function(){b.find("div.menu").css("overflow-y","auto")},10));c.tmp.contentWidth&&(h=c.tmp.contentWidth,b.width(h),setTimeout(function(){b.width()>b.find("div.menu > table").width()&&b.find("div.menu").css("overflow-x","hidden")},1),setTimeout(function(){b.find("div.menu").css("overflow-y",
"auto")},10));switch(c.align){case "both":c.left=17;0===c.width&&(c.width=w2utils.getSize($(f),"width"));break;case "left":c.left=17;break;case "right":c.tipLeft=h-45,c.left=w2utils.getSize($(f),"width")-h+10}var k=(h-17)/2,u=c.left,x=c.width,t=c.tipLeft,x=30!==h||x?c.width?c.width:"auto":30;25>k&&(u=25-k,t=Math.floor(k));a.css({top:f.offset().top+w2utils.getSize(f,"height")+c.top+7+"px",left:(25<f.offset().left?f.offset().left:25)+u+"px","min-width":x,"min-height":c.height?c.height:"auto"});k=window.innerHeight+
$(document).scrollTop()-b.offset().top-7;u=window.innerWidth+$(document).scrollLeft()-b.offset().left-7;-50<k&&210>k||!0===c.openAbove?(k=b.offset().top-$(document).scrollTop()-7,c.maxHeight&&k>c.maxHeight&&(k=c.maxHeight),d>k&&(b.height(k).width(h).css({"overflow-y":"auto"}),d=k),a.css("top",$(f).offset().top-d-24+c.top+"px"),a.find(">style").html("#w2ui-overlay"+g+":before { display: none; margin-left: "+parseInt(t)+"px; }#w2ui-overlay"+g+":after { display: block; margin-left: "+parseInt(t)+"px; }")):
(c.maxHeight&&k>c.maxHeight&&(k=c.maxHeight),d>k&&b.height(k).width(h).css({"overflow-y":"auto"}),a.find(">style").html("#w2ui-overlay"+g+":before { display: block; margin-left: "+parseInt(t)+"px; }#w2ui-overlay"+g+":after { display: none; margin-left: "+parseInt(t)+"px; }"));h=b.width();u=window.innerWidth+$(document).scrollLeft()-b.offset().left-7;c.maxWidth&&u>c.maxWidth&&(u=c.maxWidth);h>u&&"both"!==c.align&&(c.align="right",setTimeout(function(){e()},1))}}var f=this,g="";1==arguments.length&&
(c="object"==typeof d?d:{html:d});2==arguments.length&&(c.html=d);$.isPlainObject(c)||(c={});c=$.extend({},{name:null,html:"",align:"none",left:0,top:0,tipLeft:30,width:0,height:0,maxWidth:null,maxHeight:null,style:"","class":"",onShow:null,onHide:null,openAbove:!1,tmp:{}},c);c.name&&(g="-"+c.name);var k;if(0===this.length||""===c.html||null==c.html)return 0<$("#w2ui-overlay"+g).length?(k=$("#w2ui-overlay"+g)[0].hide,"function"===typeof k&&k()):$("#w2ui-overlay"+g).remove(),$(this);0<$("#w2ui-overlay"+
g).length&&(k=$("#w2ui-overlay"+g)[0].hide,$(document).off("click",k),"function"===typeof k&&k());$("body").append('<div id="w2ui-overlay'+g+'" style="display: none"        class="w2ui-reset w2ui-overlay '+(0<$(this).parents(".w2ui-popup, .w2ui-overlay-popup").length?"w2ui-overlay-popup":"")+'">    <style></style>    <div style="'+c.style+'" class="'+c["class"]+'"></div></div>');k=$("#w2ui-overlay"+g);var h=k.find(" > div");h.html(c.html);h=h.css("background-color");null!=h&&"rgba(0, 0, 0, 0)"!==
h&&"transparent"!==h&&k.css("background-color",h);k.data("element",0<f.length?f[0]:null).data("options",c).data("position",$(f).offset().left+"x"+$(f).offset().top).fadeIn("fast").on("mousedown",function(a){$("#w2ui-overlay"+g).data("keepOpen",!0);-1===["INPUT","TEXTAREA","SELECT"].indexOf(a.target.tagName)&&a.preventDefault()});k[0].hide=b;k[0].resize=e;e();setTimeout(function(){e();$(document).off("click",b).on("click",b);if("function"===typeof c.onShow)c.onShow()},10);a();return $(this)};$.fn.w2menu=
function(d,c){function a(){setTimeout(function(){$("#w2ui-overlay"+k+" tr.w2ui-selected").removeClass("w2ui-selected");var a=$("#w2ui-overlay"+k+" tr[index="+c.index+"]"),b=$("#w2ui-overlay"+k+" div.menu").scrollTop();a.addClass("w2ui-selected");c.tmp&&(c.tmp.contentHeight=$("#w2ui-overlay"+k+" table").height()+(c.search?50:10));c.tmp&&(c.tmp.contentWidth=$("#w2ui-overlay"+k+" table").width());0<$("#w2ui-overlay"+k).length&&$("#w2ui-overlay"+k)[0].resize();if(0<a.length){var e=a[0].offsetTop-5,f=
$("#w2ui-overlay"+k+" div.menu").height();$("#w2ui-overlay"+k+" div.menu").scrollTop(b);(e<b||e+a.height()>b+f)&&$("#w2ui-overlay"+k+" div.menu").animate({scrollTop:e-(f-2*a.height())/2},200,"linear")}},1)}function b(b){var e=this.value,f=!1;switch(b.keyCode){case 13:$("#w2ui-overlay"+k).remove();$.fn.w2menuHandler(b,c.index);break;case 9:case 27:$("#w2ui-overlay"+k).remove();$.fn.w2menuHandler(b,-1);break;case 38:c.index=w2utils.isInt(c.index)?parseInt(c.index):0;for(c.index--;0<c.index&&c.items[c.index].hidden;)c.index--;
if(0===c.index&&c.items[c.index].hidden)for(;c.items[c.index]&&c.items[c.index].hidden;)c.index++;0>c.index&&(c.index=0);f=!0;break;case 40:c.index=w2utils.isInt(c.index)?parseInt(c.index):0;for(c.index++;c.index<c.items.length-1&&c.items[c.index].hidden;)c.index++;if(c.index===c.items.length-1&&c.items[c.index].hidden)for(;c.items[c.index]&&c.items[c.index].hidden;)c.index--;c.index>=c.items.length&&(c.index=c.items.length-1);f=!0}if(!f){b=0;for(var d in c.items){var f=c.items[d],h="",u="";-1!==
["is","begins with"].indexOf(c.match)&&(h="^");-1!==["is","ends with"].indexOf(c.match)&&(u="$");try{(new RegExp(h+e+u,"i")).test(f.text)||"..."===f.text?f.hidden=!1:f.hidden=!0}catch(x){}"enum"===g.type&&-1!==$.inArray(f.id,ids)&&(f.hidden=!0);!0!==f.hidden&&b++}for(c.index=0;c.index<c.items.length-1&&c.items[c.index].hidden;)c.index++;0>=b&&(c.index=-1)}$(g).w2menu("refresh",c);a()}function e(){if(c.spinner)return'<table class="w2ui-drop-menu"><tr><td style="padding: 5px 10px 10px 10px; text-align: center">    <div class="w2ui-spinner" style="width: 18px; height: 18px; position: relative; top: 5px;"></div>     <div style="display: inline-block; padding: 3px; color: #999;">'+
w2utils.lang("Loading...")+"</div></td></tr></table>";for(var a=0,b='<table cellspacing="0" cellpadding="0" class="w2ui-drop-menu">',e=null,f=null,g=0;g<c.items.length;g++){var d=c.items[g];"string"===typeof d?d={id:d,text:d}:(null!=d.text&&null==d.id&&(d.id=d.text),null==d.text&&null!=d.id&&(d.text=d.id),null!=d.caption&&(d.text=d.caption),e=d.img,f=d.icon,null==e&&(e=null),null==f&&(f=null));if(!0!==d.hidden){var h="",t=d.text;"function"===typeof c.render&&(t=c.render(d,c));e&&(h='<td class="menu-icon"><div class="w2ui-tb-image w2ui-icon '+
e+'"></div></td>');f&&(h='<td class="menu-icon" align="center"><span class="w2ui-icon '+f+'"></span></td>');if("undefined"===typeof t||""===t||/^-+$/.test(t))b+='<tr><td colspan="2" style="padding: 6px; pointer-events: none"><div style="border-top: 1px solid silver;"></div></td></tr>';else{var y=0===a%2?"w2ui-item-even":"w2ui-item-odd";!0!==c.altRows&&(y="");var v=1;""==h&&v++;null==d.count&&v++;b+='<tr index="'+g+'" style="'+(d.style?d.style:"")+'"         class="'+y+" "+(c.index===g?"w2ui-selected":
"")+" "+(!0===d.disabled?"w2ui-disabled":"")+"\"        onmousedown=\"$(this).parent().find('tr').removeClass('w2ui-selected'); $(this).addClass('w2ui-selected');\"        onclick=\"event.stopPropagation();                if ("+(!0===d.disabled?"true":"false")+") return;               $('#w2ui-overlay"+k+"').remove();                $.fn.w2menuHandler(event, '"+g+"');\">"+h+'   <td class="menu-text" colspan="'+v+'">'+t+'</td>   <td class="menu-count">'+(null!=d.count?"<span>"+d.count+"</span>":"")+
"</td></tr>";a++}}c.items[g]=d}0===a&&(b+='<tr><td style="padding: 13px; color: #999; text-align: center">'+c.msgNoItems+"</div></td></tr>");return b+"</table>"}var f={index:null,items:[],render:null,msgNoItems:"No items",onSelect:null,tmp:{}},g=this,k="";if("refresh"===d)if(0<$("#w2ui-overlay"+k).length){c=$.extend($.fn.w2menuOptions,c);var h=$("#w2ui-overlay"+k+" div.menu").scrollTop();$("#w2ui-overlay"+k+" div.menu").html(e());$("#w2ui-overlay"+k+" div.menu").scrollTop(h);a()}else $(this).w2menu(c);
else{1===arguments.length?c=d:c.items=d;"object"!==typeof c&&(c={});c=$.extend({},f,c);$.fn.w2menuOptions=c;c.name&&(k="-"+c.name);"function"===typeof c.select&&"function"!==typeof c.onSelect&&(c.onSelect=c.select);"function"===typeof c.onRender&&"function"!==typeof c.render&&(c.render=c.onRender);$.fn.w2menuHandler=function(a,b){"function"===typeof c.onSelect&&setTimeout(function(){c.onSelect({index:b,item:c.items[b],originalEvent:a})},10)};f="";if(c.search)for(h in f+='<div style="position: absolute; top: 0px; height: 40px; left: 0px; right: 0px; border-bottom: 1px solid silver; background-color: #ECECEC; padding: 8px 5px;">    <div class="w2ui-icon icon-search" style="position: absolute; margin-top: 4px; margin-left: 6px; width: 11px; background-position: left !important;"></div>    <input id="menu-search" type="text" style="width: 100%; outline: none; padding-left: 20px;" onclick="event.stopPropagation();"></div>',
c.style+=";background-color: #ECECEC",c.index=0,c.items)c.items[h].hidden=!1;f+='<div class="menu" style="position: absolute; top: '+(c.search?40:0)+'px; bottom: 0px; width: 100%; overflow: auto;">'+e()+"</div>";h=$(this).w2overlay(f,c);setTimeout(function(){$("#w2ui-overlay"+k+" #menu-search").on("keyup",b).on("keydown",function(a){9===a.keyCode&&(a.stopPropagation(),a.preventDefault())});c.search&&-1==["text","password"].indexOf($(g)[0].type)&&"texarea"!=$(g)[0].tagName&&$("#w2ui-overlay"+k+" #menu-search").focus()},
200);a();return h}}})();
(function(){var d=function(c){this.box=this.name=null;this.url=this.header="";this.routeData={};this.columns=[];this.columnGroups=[];this.records=[];this.summary=[];this.searches=[];this.searchData=[];this.sortData=[];this.postData={};this.toolbar={};this.show={header:!1,toolbar:!1,footer:!1,columnHeaders:!0,lineNumbers:!1,expandColumn:!1,selectColumn:!1,emptyRecords:!0,toolbarReload:!0,toolbarColumns:!0,toolbarSearch:!0,toolbarAdd:!1,toolbarEdit:!1,toolbarDelete:!1,toolbarSave:!1,selectionBorder:!0,
recordTitles:!0,skipRecords:!0};this.fixedBody=this.autoLoad=!0;this.recordHeight=24;this.keyboard=!0;this.selectType="row";this.multiSort=this.multiSelect=this.multiSearch=!0;this.reorderRows=this.reorderColumns=!1;this.markSearch=!0;this.total=0;this.limit=100;this.offset=0;this.style="";this.ranges=[];this.menu=[];this.onStateRestore=this.onStateSave=this.onDestroy=this.onResize=this.onReload=this.onRefresh=this.onRender=this.onEditField=this.onSelectionExtend=this.onPaste=this.onCopy=this.onColumnOnOff=
this.onToolbar=this.onKeydown=this.onError=this.onCollapse=this.onExpand=this.onRestore=this.onChange=this.onSearch=this.onSort=this.onColumnResize=this.onColumnClick=this.onMenuClick=this.onContextMenu=this.onDblClick=this.onClick=this.onUnselect=this.onSelect=this.onSave=this.onSubmit=this.onDeleted=this.onDelete=this.onLoad=this.onRequest=this.onEdit=this.onAdd=this.parser=this.recid=this.method=null;this.last={field:"all",caption:w2utils.lang("All Fields"),logic:"OR",search:"",searchIds:[],selection:{indexes:[],
columns:{}},multi:!1,scrollTop:0,scrollLeft:0,sortData:null,sortCount:0,xhr:null,range_start:null,range_end:null,sel_ind:null,sel_col:null,sel_type:null,edit_col:null};$.extend(!0,this,w2obj.grid,c)};$.fn.w2grid=function(c){if("object"!==typeof c&&c){if(w2ui[$(this).attr("name")]){var a=w2ui[$(this).attr("name")];a[c].apply(a,Array.prototype.slice.call(arguments,1));return this}console.log("ERROR: Method "+c+" does not exist on jQuery.w2grid")}else if(w2utils.checkName(c,"w2grid")){var b=c.columns,
e=c.columnGroups,f=c.records,g=c.searches,k=c.searchData,h=c.sortData,l=c.postData,m=c.toolbar,a=new d(c);$.extend(a,{postData:{},records:[],columns:[],searches:[],toolbar:{},sortData:[],searchData:[],handlers:[]});null!=a.onExpand&&(a.show.expandColumn=!0);$.extend(!0,a.toolbar,m);for(var n in b)a.columns[n]=$.extend(!0,{},b[n]);for(n in e)a.columnGroups[n]=$.extend(!0,{},e[n]);for(n in g)a.searches[n]=$.extend(!0,{},g[n]);for(n in k)a.searchData[n]=$.extend(!0,{},k[n]);for(n in h)a.sortData[n]=
$.extend(!0,{},h[n]);a.postData=$.extend(!0,{},l);for(var p in f){if(null==f[p].recid||"undefined"==typeof f[p].recid){console.log("ERROR: Cannot add records without recid. (obj: "+a.name+")");return}a.records[p]=$.extend(!0,{},f[p])}for(var r in a.columns)b=a.columns[r],"undefined"!=typeof b.searchable&&null==a.getSearch(b.field)&&(e=b.searchable,f="",!0===b.searchable&&(e="text",f='size="20"'),a.addSearch({field:b.field,caption:b.caption,type:e,attr:f}));a.initToolbar();0!==$(this).length&&a.render($(this)[0]);
return w2ui[a.name]=a}};d.prototype={msgDelete:w2utils.lang("Are you sure you want to delete selected records?"),msgNotJSON:w2utils.lang("Returned data is not in valid JSON format."),msgAJAXerror:w2utils.lang("AJAX error. See console for more details."),msgRefresh:w2utils.lang("Refreshing..."),buttons:{reload:{type:"button",id:"w2ui-reload",icon:"w2ui-icon-reload",hint:w2utils.lang("Reload data in the list")},columns:{type:"drop",id:"w2ui-column-on-off",icon:"w2ui-icon-columns",hint:w2utils.lang("Show/hide columns"),
arrow:!1,html:""},search:{type:"html",id:"w2ui-search",html:'<div class="w2ui-icon icon-search-down w2ui-search-down" title="Select Search Field" onclick="var obj = w2ui[$(this).parents(\'div.w2ui-grid\').attr(\'name\')]; obj.searchShowFields();"></div>'},"search-go":{type:"check",id:"w2ui-search-advanced",caption:w2utils.lang("Search..."),hint:w2utils.lang("Open Search Fields")},add:{type:"button",id:"w2ui-add",caption:w2utils.lang("Add New"),hint:w2utils.lang("Add new record"),icon:"w2ui-icon-plus"},
edit:{type:"button",id:"w2ui-edit",caption:w2utils.lang("Edit"),hint:w2utils.lang("Edit selected record"),icon:"w2ui-icon-pencil",disabled:!0},"delete":{type:"button",id:"w2ui-delete",caption:w2utils.lang("Delete"),hint:w2utils.lang("Delete selected records"),icon:"w2ui-icon-cross",disabled:!0},save:{type:"button",id:"w2ui-save",caption:w2utils.lang("Save"),hint:w2utils.lang("Save changed records"),icon:"w2ui-icon-check"}},add:function(c){$.isArray(c)||(c=[c]);var a=0,b;for(b in c)this.recid&&"undefined"==
typeof c[b].recid&&(c[b].recid=c[b][this.recid]),null==c[b].recid||"undefined"==typeof c[b].recid?console.log("ERROR: Cannot add record without recid. (obj: "+this.name+")"):(this.records.push(c[b]),a++);("object"!=typeof this.url?this.url:this.url.get)||(this.total=this.records.length,this.localSort(),this.localSearch());this.refresh();return a},find:function(c,a){if("undefined"==typeof c||null==c)c={};var b=[],e=!1,f;for(f in c)-1!=String(f).indexOf(".")&&(e=!0);for(var g=0;g<this.records.length;g++){var d=
!0;for(f in c){var h=this.records[g][f];e&&-1!=String(f).indexOf(".")&&(h=this.parseField(this.records[g],f));c[f]!=h&&(d=!1)}d&&!0!==a&&b.push(this.records[g].recid);d&&!0===a&&b.push(g)}return b},set:function(c,a,b){"object"==typeof c&&(b=a,a=c,c=null);if(null==c){for(var e in this.records)$.extend(!0,this.records[e],a);!0!==b&&this.refresh()}else{e=this.get(c,!0);if(null==e)return!1;this.records[e]&&this.records[e].recid==c?$.extend(!0,this.records[e],a):$.extend(!0,this.summary[e],a);!0!==b&&
this.refreshRow(c)}return!0},get:function(c,a){for(var b=0;b<this.records.length;b++)if(this.records[b].recid==c)return!0===a?b:this.records[b];for(b=0;b<this.summary.length;b++)if(this.summary[b].recid==c)return!0===a?b:this.summary[b];return null},remove:function(){for(var c=0,a=0;a<arguments.length;a++)for(var b=this.records.length-1;0<=b;b--)this.records[b].recid==arguments[a]&&(this.records.splice(b,1),c++);("object"!=typeof this.url?this.url:this.url.get)||(this.localSort(),this.localSearch());
this.refresh();return c},addColumn:function(c,a){var b=0;1==arguments.length?(a=c,c=this.columns.length):("string"==typeof c&&(c=this.getColumn(c,!0)),null===c&&(c=this.columns.length));$.isArray(a)||(a=[a]);for(var e in a)this.columns.splice(c,0,a[e]),c++,b++;this.refresh();return b},removeColumn:function(){for(var c=0,a=0;a<arguments.length;a++)for(var b=this.columns.length-1;0<=b;b--)this.columns[b].field==arguments[a]&&(this.columns.splice(b,1),c++);this.refresh();return c},getColumn:function(c,
a){for(var b=0;b<this.columns.length;b++)if(this.columns[b].field==c)return!0===a?b:this.columns[b];return null},toggleColumn:function(){for(var c=0,a=0;a<arguments.length;a++)for(var b=this.columns.length-1;0<=b;b--){var e=this.columns[b];e.field==arguments[a]&&(e.hidden=!e.hidden,c++)}this.refresh();return c},showColumn:function(){for(var c=0,a=0;a<arguments.length;a++)for(var b=this.columns.length-1;0<=b;b--){var e=this.columns[b];e.gridMinWidth&&delete e.gridMinWidth;e.field==arguments[a]&&!1!==
e.hidden&&(e.hidden=!1,c++)}this.refresh();return c},hideColumn:function(){for(var c=0,a=0;a<arguments.length;a++)for(var b=this.columns.length-1;0<=b;b--){var e=this.columns[b];e.field==arguments[a]&&!0!==e.hidden&&(e.hidden=!0,c++)}this.refresh();return c},addSearch:function(c,a){var b=0;1==arguments.length?(a=c,c=this.searches.length):("string"==typeof c&&(c=this.getSearch(c,!0)),null===c&&(c=this.searches.length));$.isArray(a)||(a=[a]);for(var e in a)this.searches.splice(c,0,a[e]),c++,b++;this.searchClose();
return b},removeSearch:function(){for(var c=0,a=0;a<arguments.length;a++)for(var b=this.searches.length-1;0<=b;b--)this.searches[b].field==arguments[a]&&(this.searches.splice(b,1),c++);this.searchClose();return c},getSearch:function(c,a){for(var b=0;b<this.searches.length;b++)if(this.searches[b].field==c)return!0===a?b:this.searches[b];return null},toggleSearch:function(){for(var c=0,a=0;a<arguments.length;a++)for(var b=this.searches.length-1;0<=b;b--)this.searches[b].field==arguments[a]&&(this.searches[b].hidden=
!this.searches[b].hidden,c++);this.searchClose();return c},showSearch:function(){for(var c=0,a=0;a<arguments.length;a++)for(var b=this.searches.length-1;0<=b;b--)this.searches[b].field==arguments[a]&&!1!==this.searches[b].hidden&&(this.searches[b].hidden=!1,c++);this.searchClose();return c},hideSearch:function(){for(var c=0,a=0;a<arguments.length;a++)for(var b=this.searches.length-1;0<=b;b--)this.searches[b].field==arguments[a]&&!0!==this.searches[b].hidden&&(this.searches[b].hidden=!0,c++);this.searchClose();
return c},getSearchData:function(c){for(var a in this.searchData)if(this.searchData[a].field==c)return this.searchData[a];return null},localSort:function(c){if("object"!=typeof this.url?this.url:this.url.get)console.log("ERROR: grid.localSort can only be used on local data source, grid.url should be empty.");else if(!$.isEmptyObject(this.sortData)){var a=(new Date).getTime(),b=this;b.prepareData();for(var e in this.sortData){var f=this.getColumn(this.sortData[e].field);if(!f)return;"string"==typeof f.render&&
(-1!=["date","age"].indexOf(f.render.split(":")[0])&&(this.sortData[e].field_=f.field+"_"),-1!=["time"].indexOf(f.render.split(":")[0])&&(this.sortData[e].field_=f.field+"_"))}this.records.sort(function(a,c){var e=0,f;for(f in b.sortData){var d=b.sortData[f].field;b.sortData[f].field_&&(d=b.sortData[f].field_);var n=a[d],p=c[d];-1!=String(d).indexOf(".")&&(n=b.parseField(a,d),p=b.parseField(c,d));"string"==typeof n&&(n=$.trim(n.toLowerCase()));"string"==typeof p&&(p=$.trim(p.toLowerCase()));n>p&&
(e="asc"==b.sortData[f].direction?1:-1);n<p&&(e="asc"==b.sortData[f].direction?-1:1);"object"!=typeof n&&"object"==typeof p&&(e=-1);"object"!=typeof p&&"object"==typeof n&&(e=1);null==n&&null!=p&&(e=1);null!=n&&null==p&&(e=-1);if(0!=e)break}return e});a=(new Date).getTime()-a;!0!==c&&setTimeout(function(){b.status(w2utils.lang("Sorting took")+" "+a/1E3+" "+w2utils.lang("sec"))},10);return a}},localSearch:function(c){var a="object"!=typeof this.url?this.url:this.url.get;if(a)console.log("ERROR: grid.localSearch can only be used on local data source, grid.url should be empty.");
else{var b=(new Date).getTime(),e=this;this.total=this.records.length;this.last.searchIds=[];this.prepareData();if(0<this.searchData.length&&!a){this.total=0;for(var f in this.records){var a=this.records[f],g=0,d;for(d in this.searchData){var h=this.searchData[d],l=this.getSearch(h.field);if(null!=h){null==l&&(l={field:h.field,type:h.type});var m=String(e.parseField(a,l.field)).toLowerCase();if("undefined"!=typeof h.value)if($.isArray(h.value))var n=h.value[0],p=h.value[1];else var n=String(h.value).toLowerCase();
switch(h.operator){case "is":a[l.field]==h.value&&g++;"date"==l.type&&(m=w2utils.formatDate(a[l.field+"_"],"yyyy-mm-dd"),n=w2utils.formatDate(n,"yyyy-mm-dd"),m==n&&g++);"time"==l.type&&(m=w2utils.formatTime(a[l.field+"_"],"h24:mi"),n=w2utils.formatTime(n,"h24:mi"),m==n&&g++);break;case "between":-1!=["int","float","money","currency","percent"].indexOf(l.type)&&parseFloat(a[l.field])>=parseFloat(n)&&parseFloat(a[l.field])<=parseFloat(p)&&g++;"date"==l.type&&(m=a[l.field+"_"],n=w2utils.isDate(n,w2utils.settings.date_format,
!0),p=w2utils.isDate(p,w2utils.settings.date_format,!0),null!=p&&(p=new Date(p.getTime()+864E5)),m>=n&&m<p&&g++);"time"==l.type&&(m=a[l.field+"_"],n=w2utils.isTime(n,!0),p=w2utils.isTime(p,!0),n=(new Date).setHours(n.hours,n.minutes,n.seconds?n.seconds:0,0),p=(new Date).setHours(p.hours,p.minutes,p.seconds?p.seconds:0,0),m>=n&&m<p&&g++);break;case "in":l=h.value;h.svalue&&(l=h.svalue);-1!==l.indexOf(m)&&g++;break;case "not in":l=h.value;h.svalue&&(l=h.svalue);-1==l.indexOf(m)&&g++;break;case "begins":case "begins with":0==
m.indexOf(n)&&g++;break;case "contains":0<=m.indexOf(n)&&g++;break;case "ends":case "ends with":0<=m.indexOf(n)&&m.indexOf(n)==m.length-n.length&&g++}}}("OR"==this.last.logic&&0!=g||"AND"==this.last.logic&&g==this.searchData.length)&&this.last.searchIds.push(parseInt(f))}this.total=this.last.searchIds.length}b=(new Date).getTime()-b;!0!==c&&setTimeout(function(){e.status(w2utils.lang("Search took")+" "+b/1E3+" "+w2utils.lang("sec"))},10);return b}},getRangeData:function(c,a){var b=this.get(c[0].recid,
!0),e=this.get(c[1].recid,!0),f=c[0].column,g=c[1].column,d=[];if(f==g)for(;b<=e;b++){var h=this.records[b],l=h[this.columns[f].field]||null;!0!==a?d.push(l):d.push({data:l,column:f,index:b,record:h})}else if(b==e)for(var h=this.records[b],m=f;m<=g;m++)l=h[this.columns[m].field]||null,!0!==a?d.push(l):d.push({data:l,column:m,index:b,record:h});else for(;b<=e;b++)for(h=this.records[b],d.push([]),m=f;m<=g;m++)l=h[this.columns[m].field],!0!==a?d[d.length-1].push(l):d[d.length-1].push({data:l,column:m,
index:b,record:h});return d},addRange:function(c){var a=0;if("row"==this.selectType)return a;$.isArray(c)||(c=[c]);for(var b in c){"object"!=typeof c[b]&&(c[b]={name:"selection"});if("selection"==c[b].name){if(!1===this.show.selectionBorder)continue;var e=this.getSelection();if(0==e.length){this.removeRange(c[b].name);continue}else{var f=e[0],e=e[e.length-1];$("#grid_"+this.name+"_rec_"+f.recid+" td[col="+f.column+"]");$("#grid_"+this.name+"_rec_"+e.recid+" td[col="+e.column+"]")}}else f=c[b].range[0],
e=c[b].range[1],$("#grid_"+this.name+"_rec_"+f.recid+" td[col="+f.column+"]"),$("#grid_"+this.name+"_rec_"+e.recid+" td[col="+e.column+"]");if(f){var f={name:c[b].name,range:[{recid:f.recid,column:f.column},{recid:e.recid,column:e.column}],style:c[b].style||""},e=!1,g;for(g in this.ranges)if(this.ranges[g].name==c[b].name){e=b;break}!1!==e?this.ranges[e]=f:this.ranges.push(f);a++}}this.refreshRanges();return a},removeRange:function(){for(var c=0,a=0;a<arguments.length;a++){var b=arguments[a];$("#grid_"+
this.name+"_"+b).remove();for(var e=this.ranges.length-1;0<=e;e--)this.ranges[e].name==b&&(this.ranges.splice(e,1),c++)}return c},refreshRanges:function(){function c(a){var c=b.last.move;if(c&&"expand"==c.type){c.divX=a.screenX-c.x;c.divY=a.screenY-c.y;var e;a=a.originalEvent.target;"TD"!=a.tagName&&(a=$(a).parents("td")[0]);"undefined"!=typeof $(a).attr("col")&&(e=parseInt($(a).attr("col")));a=$(a).parents("tr")[0];a=$(a).attr("recid");if(c.newRange[1].recid!=a||c.newRange[1].column!=e){var f=$.extend({},
c.newRange);c.newRange=[{recid:c.recid,column:c.column},{recid:a,column:e}];m=b.trigger($.extend(m,{originalRange:c.originalRange,newRange:c.newRange}));!0===m.isCancelled?(c.newRange=f,m.newRange=f):(b.removeRange("grid-selection-expand"),b.addRange({name:"grid-selection-expand",range:m.newRange,style:"background-color: rgba(100,100,100,0.1); border: 2px dotted rgba(100,100,100,0.5);"}))}}}function a(e){b.removeRange("grid-selection-expand");delete b.last.move;$(document).off("mousemove",c);$(document).off("mouseup",
a);b.trigger($.extend(m,{phase:"after"}))}var b=this,e=(new Date).getTime(),f=$("#grid_"+this.name+"_records"),g;for(g in this.ranges){var d=this.ranges[g],h=d.range[0],l=d.range[1],h=$("#grid_"+this.name+"_rec_"+h.recid+" td[col="+h.column+"]"),l=$("#grid_"+this.name+"_rec_"+l.recid+" td[col="+l.column+"]");0==$("#grid_"+this.name+"_"+d.name).length?f.append('<div id="grid_'+this.name+"_"+d.name+'" class="w2ui-selection" style="'+d.style+'">'+("selection"==d.name?'<div id="grid_'+this.name+'_resizer" class="w2ui-selection-resizer"></div>':
"")+"</div>"):$("#grid_"+this.name+"_"+d.name).attr("style",d.style);0<h.length&&0<l.length&&$("#grid_"+this.name+"_"+d.name).css({left:h.position().left-1+f.scrollLeft()+"px",top:h.position().top-1+f.scrollTop()+"px",width:l.position().left-h.position().left+l.width()+3+"px",height:l.position().top-h.position().top+l.height()+3+"px"})}$(this.box).find("#grid_"+this.name+"_resizer").off("mousedown").on("mousedown",function(e){var f=b.getSelection();b.last.move={type:"expand",x:e.screenX,y:e.screenY,
divX:0,divY:0,recid:f[0].recid,column:f[0].column,originalRange:[{recid:f[0].recid,column:f[0].column},{recid:f[f.length-1].recid,column:f[f.length-1].column}],newRange:[{recid:f[0].recid,column:f[0].column},{recid:f[f.length-1].recid,column:f[f.length-1].column}]};$(document).off("mousemove",c).on("mousemove",c);$(document).off("mouseup",a).on("mouseup",a)});var m={phase:"before",type:"selectionExtend",target:b.name,originalRange:null,newRange:null};return(new Date).getTime()-e},select:function(){var c=
0,a=this.last.selection;this.multiSelect||this.selectNone();for(var b=0;b<arguments.length;b++){var e="object"==typeof arguments[b]?arguments[b].recid:arguments[b];if(null!=this.get(e)){var f=this.get(e,!0),g=$("#grid_"+this.name+"_rec_"+w2utils.escapeId(e));if("row"==this.selectType){if(0<=a.indexes.indexOf(f))continue;e=this.trigger({phase:"before",type:"select",target:this.name,recid:e,index:f});if(!0===e.isCancelled)continue;a.indexes.push(f);a.indexes.sort(function(a,b){return a-b});g.addClass("w2ui-selected").data("selected",
"yes");g.find(".w2ui-grid-select-check").prop("checked",!0);c++}else{var d=arguments[b].column;if(!w2utils.isInt(d)){var c=[],h;for(h in this.columns)this.columns[h].hidden||c.push({recid:e,column:parseInt(h)});this.multiSelect||(c=c.splice(0,1));return this.select.apply(this,c)}var l=a.columns[f]||[];if($.isArray(l)&&-1!=l.indexOf(d))continue;e=this.trigger({phase:"before",type:"select",target:this.name,recid:e,index:f,column:d});if(!0===e.isCancelled)continue;-1==a.indexes.indexOf(f)&&(a.indexes.push(f),
a.indexes.sort(function(a,b){return a-b}));l.push(d);l.sort(function(a,b){return a-b});g.find(" > td[col="+d+"]").addClass("w2ui-selected");c++;g.data("selected","yes");g.find(".w2ui-grid-select-check").prop("checked",!0);a.columns[f]=l}this.trigger($.extend(e,{phase:"after"}))}}a.indexes.length==this.records.length||0!==this.searchData.length&&a.indexes.length==this.last.searchIds.length?$("#grid_"+this.name+"_check_all").prop("checked",!0):$("#grid_"+this.name+"_check_all").prop("checked",!1);this.status();
this.addRange("selection");return c},unselect:function(){for(var c=0,a=this.last.selection,b=0;b<arguments.length;b++){var e="object"==typeof arguments[b]?arguments[b].recid:arguments[b],f=this.get(e);if(null!=f){var f=this.get(f.recid,!0),g=$("#grid_"+this.name+"_rec_"+w2utils.escapeId(e));if("row"==this.selectType){if(-1==a.indexes.indexOf(f))continue;var d=this.trigger({phase:"before",type:"unselect",target:this.name,recid:e,index:f});if(!0===d.isCancelled)continue;a.indexes.splice(a.indexes.indexOf(f),
1);g.removeClass("w2ui-selected").removeData("selected");0!=g.length&&(g[0].style.cssText="height: "+this.recordHeight+"px; "+g.attr("custom_style"));g.find(".w2ui-grid-select-check").prop("checked",!1);c++}else{var h=arguments[b].column;if(!w2utils.isInt(h)){var c=[],l;for(l in this.columns)this.columns[l].hidden||c.push({recid:e,column:parseInt(l)});return this.unselect.apply(this,c)}var m=a.columns[f];if(!$.isArray(m)||-1==m.indexOf(h))continue;d=this.trigger({phase:"before",type:"unselect",target:this.name,
recid:e,column:h});if(!0===d.isCancelled)continue;m.splice(m.indexOf(h),1);$("#grid_"+this.name+"_rec_"+w2utils.escapeId(e)+" > td[col="+h+"]").removeClass("w2ui-selected");c++;0==m.length&&(delete a.columns[f],a.indexes.splice(a.indexes.indexOf(f),1),g.removeData("selected"),g.find(".w2ui-grid-select-check").prop("checked",!1))}this.trigger($.extend(d,{phase:"after"}))}}a.indexes.length==this.records.length||0!==this.searchData.length&&a.indexes.length==this.last.searchIds.length?$("#grid_"+this.name+
"_check_all").prop("checked",!0):$("#grid_"+this.name+"_check_all").prop("checked",!1);this.status();this.addRange("selection");return c},selectAll:function(){if(!1!==this.multiSelect){var c=this.trigger({phase:"before",type:"select",target:this.name,all:!0});if(!0!==c.isCancelled){var a="object"!=typeof this.url?this.url:this.url.get,b=this.last.selection,e=[],f;for(f in this.columns)e.push(parseInt(f));b.indexes=[];if(a||0===this.searchData.length)for(a=this.records.length,0==this.searchData.length||
this.url||(a=this.last.searchIds.length),f=0;f<a;f++)b.indexes.push(f),"row"!=this.selectType&&(b.columns[f]=e.slice());else for(f=0;f<this.last.searchIds.length;f++)b.indexes.push(this.last.searchIds[f]),"row"!=this.selectType&&(b.columns[this.last.searchIds[f]]=e.slice());this.refresh();b=this.getSelection();1==b.length?this.toolbar.enable("w2ui-edit"):this.toolbar.disable("w2ui-edit");1<=b.length?this.toolbar.enable("w2ui-delete"):this.toolbar.disable("w2ui-delete");this.addRange("selection");
this.trigger($.extend(c,{phase:"after"}))}}},selectNone:function(){var c=this.trigger({phase:"before",type:"unselect",target:this.name,all:!0});if(!0!==c.isCancelled){var a=this.last.selection,b;for(b in a.indexes){var e=a.indexes[b],f=this.records[e],f=$("#grid_"+this.name+"_rec_"+w2utils.escapeId(f?f.recid:null));f.removeClass("w2ui-selected").removeData("selected");f.find(".w2ui-grid-select-check").prop("checked",!1);if("row"!=this.selectType){var e=a.columns[e],g;for(g in e)f.find(" > td[col="+
e[g]+"]").removeClass("w2ui-selected")}}a.indexes=[];a.columns={};this.toolbar.disable("w2ui-edit","w2ui-delete");this.removeRange("selection");$("#grid_"+this.name+"_check_all").prop("checked",!1);this.trigger($.extend(c,{phase:"after"}))}},getSelection:function(c){var a=[],b=this.last.selection;if("row"==this.selectType)for(var e in b.indexes)this.records[b.indexes[e]]&&(!0===c?a.push(b.indexes[e]):a.push(this.records[b.indexes[e]].recid));else for(e in b.indexes)if(c=b.columns[b.indexes[e]],this.records[b.indexes[e]])for(var f in c)a.push({recid:this.records[b.indexes[e]].recid,
index:parseInt(b.indexes[e]),column:c[f]});return a},search:function(c,a){var b="object"!=typeof this.url?this.url:this.url.get,e=[],f=this.last.multi,g=this.last.logic,d=this.last.field,h=this.last.search;if(0==arguments.length){var h="",l;for(l in this.searches){var m=this.searches[l],f=$("#grid_"+this.name+"_operator_"+l).val(),n=$("#grid_"+this.name+"_field_"+l),p=$("#grid_"+this.name+"_field2_"+l),g=n.val(),r=p.val(),u=null;if(-1!=["int","float","money","currency","percent"].indexOf(m.type)){var x=
n.data("w2field"),p=p.data("w2field");x&&(g=x.clean(g));p&&(r=p.clean(r))}if(-1!=["list","enum"].indexOf(m.type))if(g=n.data("selected")||{},$.isArray(g)){var u=[],t;for(t in g)u.push(w2utils.isFloat(g[t].id)?parseFloat(g[t].id):String(g[t].id).toLowerCase()),delete g[t].hidden}else g=g.id||"";if(""!=g&&null!=g||"undefined"!=typeof r&&""!=r){n={field:m.field,type:m.type,operator:f};"between"==f?$.extend(n,{value:[g,r]}):"in"==f&&"string"==typeof g?$.extend(n,{value:g.split(",")}):"not in"==f&&"string"==
typeof g?$.extend(n,{value:g.split(",")}):$.extend(n,{value:g});u&&$.extend(n,{svalue:u});try{"date"==m.type&&"between"==f&&(n.value[0]=g,n.value[1]=r),"date"==m.type&&"is"==f&&(n.value=g)}catch(w){}e.push(n)}}f=!0;g="AND"}if("string"==typeof c&&(d=c,h=a,f=!1,g="OR","undefined"!=typeof a))if("all"==c.toLowerCase())if(0<this.searches.length)for(l in this.searches){m=this.searches[l];if("text"==m.type||"alphanumeric"==m.type&&w2utils.isAlphaNumeric(a)||"int"==m.type&&w2utils.isInt(a)||"float"==m.type&&
w2utils.isFloat(a)||"percent"==m.type&&w2utils.isFloat(a)||"hex"==m.type&&w2utils.isHex(a)||"currency"==m.type&&w2utils.isMoney(a)||"money"==m.type&&w2utils.isMoney(a)||"date"==m.type&&w2utils.isDate(a))n={field:m.field,type:m.type,operator:"text"==m.type?"contains":"is",value:a},e.push(n);if(-1!=["int","float","money","currency","percent"].indexOf(m.type)&&-1!=String(a).indexOf("-")){var y=String(a).split("-"),n={field:m.field,type:m.type,operator:"between",value:[y[0],y[1]]};e.push(n)}}else for(var v in this.columns)n=
{field:this.columns[v].field,type:"text",operator:"contains",value:a},e.push(n);else if(l=$("#grid_"+this.name+"_search_all"),m=this.getSearch(c),null==m&&(m={field:c,type:"text"}),m.field==c&&(this.last.caption=m.caption),"list"==m.type&&(n=l.data("selected"))&&!$.isEmptyObject(n)&&(a=n.id),""!=a){l="contains";t=a;-1!=["date","time","list"].indexOf(m.type)&&(l="is");if("int"==m.type&&""!=a&&(l="is",-1!=String(a).indexOf("-")&&(n=a.split("-"),2==n.length&&(l="between",t=[parseInt(n[0]),parseInt(n[1])])),
-1!=String(a).indexOf(",")))for(y in n=a.split(","),l="in",t=[],n)t.push(n[y]);n={field:m.field,type:m.type,operator:l,value:t};e.push(n)}if($.isArray(c)){m="AND";"string"==typeof a&&(m=a.toUpperCase(),"OR"!=m&&"AND"!=m&&(m="AND"));var h="",f=!0,g=m,q;for(q in c)y=c[q],m=this.getSearch(y.field),null==m&&(m={type:"text",operator:"contains"}),e.push($.extend(!0,{},m,y))}e=this.trigger({phase:"before",type:"search",target:this.name,searchData:e,searchField:c?c:"multi",searchValue:a?a:"multi"});!0!==
e.isCancelled&&(this.searchData=e.searchData,this.last.field=d,this.last.search=h,this.last.multi=f,this.last.logic=g,this.last.scrollTop=0,this.last.scrollLeft=0,this.last.selection.indexes=[],this.last.selection.columns={},this.searchClose(),this.set({expanded:!1},!0),b?(this.last.xhr_offset=0,this.reload()):(this.localSearch(),this.refresh()),this.trigger($.extend(e,{phase:"after"})))},searchOpen:function(){if(this.box&&0!=this.searches.length){var c=this;$("#tb_"+this.name+"_toolbar_item_w2ui-search-advanced").w2overlay(this.getSearchesHTML(),
{name:"searches-"+this.name,left:-10,"class":"w2ui-grid-searches",onShow:function(){"OR"==c.last.logic&&(c.searchData=[]);c.initSearches();$("#w2ui-overlay-searches-"+this.name+" .w2ui-grid-searches").data("grid-name",c.name);var a=$("#w2ui-overlay-searches-"+this.name+" .w2ui-grid-searches *[rel=search]");0<a.length&&a[0].focus()}})}},searchClose:function(){this.box&&0!=this.searches.length&&(this.toolbar&&this.toolbar.uncheck("w2ui-search-advanced"),0<$("#w2ui-overlay-searches-"+this.name+" .w2ui-grid-searches").length&&
$().w2overlay("",{name:"searches-"+this.name}))},searchShowFields:function(){for(var c=$("#grid_"+this.name+"_search_all"),a='<div class="w2ui-select-field"><table>',b=-1;b<this.searches.length;b++){var e=this.searches[b];if(-1==b){if(!this.multiSearch)continue;e={field:"all",caption:w2utils.lang("All Fields")}}else if(!0===this.searches[b].hidden)continue;a+="<tr "+(w2utils.isIOS?"onTouchStart":"onClick")+"=\"w2ui['"+this.name+"'].initAllField('"+e.field+'\')">    <td><input type="radio" tabIndex="-1" '+
(e.field==this.last.field?"checked":"")+"></td>    <td>"+e.caption+"</td></tr>"}a+="</table></div>";setTimeout(function(){$(c).w2overlay(a,{left:-10})},1)},initAllField:function(c,a){var b=$("#grid_"+this.name+"_search_all"),e=this.getSearch(c);if("all"==c)e={field:"all",caption:w2utils.lang("All Fields")},b.w2field("clear"),b.change().focus();else{var f=e.type;-1!=["enum","select"].indexOf(f)&&(f="list");b.w2field(f,$.extend({},e.options,{suffix:"",autoFormat:!1,selected:a}));-1!=["list","enum"].indexOf(e.type)&&
(this.last.search="",this.last.item="",b.val(""));setTimeout(function(){b.focus()},1)}""!=this.last.search?this.search(e.field,this.last.search):(this.last.field=e.field,this.last.caption=e.caption);b.attr("placeholder",e.caption);$().w2overlay()},searchReset:function(c){var a=this.trigger({phase:"before",type:"search",target:this.name,searchData:[]});!0!==a.isCancelled&&(this.searchData=[],this.last.search="",this.last.logic="OR",this.last.multi=!1,this.last.xhr_offset=0,this.last.scrollTop=0,this.last.scrollLeft=
0,this.last.selection.indexes=[],this.last.selection.columns={},this.searchClose(),$("#grid_"+this.name+"_search_all").val(""),c||this.reload(),this.trigger($.extend(a,{phase:"after"})))},clear:function(c){this.records=[];this.summary=[];this.last.scrollTop=0;this.last.scrollLeft=0;this.last.selection.indexes=[];this.last.selection.columns={};this.last.range_start=null;this.last.range_end=null;this.last.xhr_offset=0;c||this.refresh()},reset:function(c){this.total=this.offset=0;this.last.scrollTop=
0;this.last.scrollLeft=0;this.last.selection.indexes=[];this.last.selection.columns={};this.last.range_start=null;this.last.range_end=null;this.last.xhr_offset=0;this.searchReset(c);null!=this.last.sortData&&(this.sortData=this.last.sortData);this.set({expanded:!1},!0);c||this.refresh()},skip:function(c){if("object"!=typeof this.url?this.url:this.url.get){this.offset=parseInt(c);this.offset>this.total&&(this.offset=this.total-this.limit);if(0>this.offset||!w2utils.isInt(this.offset))this.offset=0;
this.records=[];this.last.xhr_offset=0;this.last.pull_more=!0;this.last.scrollTop=0;this.last.scrollLeft=0;$("#grid_"+this.name+"_records").prop("scrollTop",0);this.reload()}else console.log("ERROR: grid.skip() can only be called when you have remote data source.")},load:function(c,a){"undefined"==typeof c?console.log('ERROR: You need to provide url argument when calling .load() method of "'+this.name+'" object.'):this.request("get-records",{},c,a)},reload:function(c){("object"!=typeof this.url?this.url:
this.url.get)?(this.clear(!0),this.request("get-records",{},null,c)):(this.last.scrollTop=0,this.last.scrollLeft=0,this.last.range_start=null,this.last.range_end=null,this.localSearch(),this.refresh(),"function"==typeof c&&c({status:"success"}))},request:function(c,a,b,e){"undefined"==typeof a&&(a={});if("undefined"==typeof b||""==b||null==b)b=this.url;if(""!=b&&null!=b){var f={};w2utils.isInt(this.offset)||(this.offset=0);w2utils.isInt(this.last.xhr_offset)||(this.last.xhr_offset=0);f.cmd=c;f.selected=
this.getSelection();f.limit=this.limit;f.offset=parseInt(this.offset)+this.last.xhr_offset;f.search=this.searchData;f.searchLogic=this.last.logic;f.sort=this.sortData;0==this.searchData.length&&(delete f.search,delete f.searchLogic);0==this.sortData.length&&delete f.sort;$.extend(f,this.postData);$.extend(f,a);if("get-records"==c){if(a=this.trigger({phase:"before",type:"request",target:this.name,url:b,postData:f}),!0===a.isCancelled){"function"==typeof e&&e({status:"error",message:"Request aborted."});
return}}else a={url:b,postData:f};var g=this;0==this.last.xhr_offset?this.lock(this.msgRefresh,!0):(b=$("#grid_"+this.name+"_rec_more"),!0===this.autoLoad?b.show().find("td").html('<div><div style="width: 20px; height: 20px;" class="w2ui-spinner"></div></div>'):b.find("td").html("<div>"+w2utils.lang("Load")+" "+g.limit+" "+w2utils.lang("More")+"...</div>"));if(this.last.xhr)try{this.last.xhr.abort()}catch(d){}b="object"!=typeof a.url?a.url:a.url.get;"save-records"==f.cmd&&"object"==typeof a.url&&
(b=a.url.save);"delete-records"==f.cmd&&"object"==typeof a.url&&(b=a.url.remove);if(!$.isEmptyObject(g.routeData)){var k=w2utils.parseRoute(b);if(0<k.keys.length)for(var h=0;h<k.keys.length;h++)null!=g.routeData[k.keys[h].name]&&(b=b.replace(new RegExp(":"+k.keys[h].name,"g"),g.routeData[k.keys[h].name]))}b={type:"POST",url:b,data:a.postData,dataType:"text"};"HTTP"==w2utils.settings.dataType&&(b.data="object"==typeof b.data?String($.param(b.data,!1)).replace(/%5B/g,"[").replace(/%5D/g,"]"):b.data);
"RESTFULL"==w2utils.settings.dataType&&(b.type="GET","save-records"==f.cmd&&(b.type="PUT"),"delete-records"==f.cmd&&(b.type="DELETE"),b.data="object"==typeof b.data?String($.param(b.data,!1)).replace(/%5B/g,"[").replace(/%5D/g,"]"):b.data);"JSON"==w2utils.settings.dataType&&(b.type="POST",b.data=JSON.stringify(b.data),b.contentType="application/json");this.method&&(b.type=this.method);this.last.xhr_cmd=f.cmd;this.last.xhr_start=(new Date).getTime();this.last.xhr=$.ajax(b).done(function(a,b,f){g.requestComplete(b,
c,e)}).fail(function(a,b,f){f=g.trigger({phase:"before",type:"error",error:{status:b,error:f,rawResponseText:a.responseText},xhr:a});if(!0!==f.isCancelled){if("abort"!=b){var d;try{d=$.parseJSON(a.responseText)}catch(h){}console.log("ERROR: Server communication failed.","\n   EXPECTED:",{status:"success",total:5,records:[{recid:1,field:"value"}]},"\n         OR:",{status:"error",message:"error message"},"\n   RECEIVED:","object"==typeof d?d:a.responseText);g.requestComplete("error",c,e)}g.trigger($.extend(f,
{phase:"after"}))}});"get-records"==c&&this.trigger($.extend(a,{phase:"after"}))}},requestComplete:function(c,a,b){var e=this;this.unlock();setTimeout(function(){e.status(w2utils.lang("Server Response")+" "+((new Date).getTime()-e.last.xhr_start)/1E3+" "+w2utils.lang("sec"))},10);this.last.pull_more=!1;this.last.pull_refresh=!0;var f="load";"save-records"==this.last.xhr_cmd&&(f="save");"delete-records"==this.last.xhr_cmd&&(f="deleted");f=this.trigger({phase:"before",target:this.name,type:f,xhr:this.last.xhr,
status:c});if(!0===f.isCancelled)"function"==typeof b&&b({status:"error",message:"Request aborted."});else{var d,k=this.last.xhr.responseText;if("error"!=c){if("undefined"!=typeof k&&""!=k){if("object"==typeof k)d=k;else if("function"==typeof e.parser)d=e.parser(k),"object"!=typeof d&&console.log("ERROR: Your parser did not return proper object");else try{eval("data = "+k)}catch(l){}if(e.recid)for(var h in d.records)d.records[h].recid=d.records[h][e.recid];"undefined"==typeof d&&(d={status:"error",
message:this.msgNotJSON,responseText:k});if("error"==d.status)e.error(d.message);else{if("get-records"==a)if(0==this.last.xhr_offset)this.records=[],this.summary=[],delete d.status,$.extend(!0,this,d);else for(h in c=d.records,delete d.records,delete d.status,$.extend(!0,this,d),c)this.records.push(c[h]);if("delete-records"==a){this.reset();return}}}}else d={status:"error",message:this.msgAJAXerror,responseText:k},e.error(this.msgAJAXerror);("object"!=typeof this.url?this.url:this.url.get)||(this.localSort(),
this.localSearch());this.total=parseInt(this.total);this.trigger($.extend(f,{phase:"after"}));0==this.last.xhr_offset?this.refresh():this.scroll();"function"==typeof b&&b(d)}},error:function(c){var a=this.trigger({target:this.name,type:"error",message:c,xhr:this.last.xhr});!0===a.isCancelled?"function"==typeof callBack&&callBack({status:"error",message:"Request aborted."}):(w2alert(c,"Error"),this.trigger($.extend(a,{phase:"after"})))},getChanges:function(){var c=[],a;for(a in this.records){var b=
this.records[a];"undefined"!=typeof b.changes&&c.push($.extend(!0,{recid:b.recid},b.changes))}return c},mergeChanges:function(){var c=this.getChanges(),a;for(a in c){var b=this.get(c[a].recid),e;for(e in c[a])if("recid"!=e){try{eval("record."+e+" = changes[c][s]")}catch(f){}delete b.changes}}this.refresh()},save:function(){var c=this,a=this.getChanges(),b=this.trigger({phase:"before",target:this.name,type:"submit",changes:a});!0!==b.isCancelled&&(("object"!=typeof this.url?this.url:this.url.save)?
this.request("save-records",{changes:b.changes},null,function(a){"error"!==a.status&&c.mergeChanges();c.trigger($.extend(b,{phase:"after"}))}):(this.mergeChanges(),this.trigger($.extend(b,{phase:"after"}))))},editField:function(c,a,b,e){var f=this,d=f.get(c,!0),k=f.records[d],h=f.columns[a],l=h?h.editable:null;if(k&&h&&l&&!1!==k.editable)if(-1!=["enum","file"].indexOf(l.type))console.log('ERROR: input types "enum" and "file" are not supported in inline editing.');else if(e=f.trigger({phase:"before",
type:"editField",target:f.name,recid:c,column:a,value:b,index:d,originalEvent:e}),!0!==e.isCancelled&&(b=e.value,this.selectNone(),this.select({recid:c,column:a}),this.last.edit_col=a,-1==["checkbox","check"].indexOf(l.type))){var m=$("#grid_"+f.name+"_rec_"+w2utils.escapeId(c)).find("[col="+a+"] > div");"undefined"==typeof l.inTag&&(l.inTag="");"undefined"==typeof l.outTag&&(l.outTag="");"undefined"==typeof l.style&&(l.style="");"undefined"==typeof l.items&&(l.items=[]);var n=k.changes&&"undefined"!=
typeof k.changes[h.field]?w2utils.stripTags(k.changes[h.field]):w2utils.stripTags(k[h.field]);if(null==n||"undefined"==typeof n)n="";"undefined"!=typeof b&&null!=b&&(n=b);var p="undefined"!=typeof h.style?h.style+";":"";"string"==typeof h.render&&-1!=["number","int","float","money","percent"].indexOf(h.render.split(":")[0])&&(p+="text-align: right;");0<l.items.length&&!$.isPlainObject(l.items[0])&&(l.items=w2obj.field.prototype.normMenu(l.items));if("select"==l.type){var r="",u;for(u in l.items)r+=
'<option value="'+l.items[u].id+'" '+(l.items[u].id==n?"selected":"")+">"+l.items[u].text+"</option>";m.addClass("w2ui-editable").html('<select id="grid_'+f.name+"_edit_"+c+"_"+a+'" column="'+a+'"     style="width: 100%; '+p+l.style+'" field="'+h.field+'" recid="'+c+'"     '+l.inTag+">"+r+"</select>"+l.outTag);m.find("select").focus().on("change",function(a){delete f.last.move}).on("blur",function(b){f.editChange.call(f,this,d,a,b)})}else{m.addClass("w2ui-editable").html('<input id="grid_'+f.name+
"_edit_"+c+"_"+a+'"     type="text" style="font-family: inherit; font-size: inherit; outline: none; '+p+l.style+'" field="'+h.field+'" recid="'+c+'"     column="'+a+'" '+l.inTag+">"+l.outTag);null==b&&m.find("input").val("object"!=n?n:"");var x=m.find("input").get(0);$(x).w2field(l.type,$.extend(l,{selected:n}));setTimeout(function(){var b=x;"list"==l.type&&(b=$($(x).data("w2field").helpers.focus).find("input"),"object"!=typeof n&&""!=n&&b.val(n).css({opacity:1}).prev().css({opacity:1}));$(b).on("blur",
function(b){f.editChange.call(f,x,d,a,b)})},10);null!=b&&$(x).val("object"!=n?n:"")}setTimeout(function(){m.find("input, select").on("click",function(a){a.stopPropagation()}).on("keydown",function(b){var e=!1;switch(b.keyCode){case 9:var e=!0,l=c,m=b.shiftKey?f.prevCell(a,!0):f.nextCell(a,!0);if(null==m){var n=b.shiftKey?f.prevRow(d):f.nextRow(d);if(null!=n&&n!=d){var l=f.records[n].recid,p;for(p in f.columns)if(n=f.columns[p].editable,"undefined"!=typeof n&&-1==["checkbox","check"].indexOf(n.type)&&
(m=parseInt(p),!b.shiftKey))break}}!1===l&&(l=c);null==m&&(m=a);this.blur();setTimeout(function(){"row"!=f.selectType?(f.selectNone(),f.select({recid:l,column:m})):f.editField(l,m,null,b)},1);break;case 13:this.blur();var r=b.shiftKey?f.prevRow(d):f.nextRow(d);null!=r&&r!=d&&setTimeout(function(){"row"!=f.selectType?(f.selectNone(),f.select({recid:f.records[r].recid,column:a})):f.editField(f.records[r].recid,a,null,b)},100);break;case 38:if(!b.shiftKey)break;e=!0;r=f.prevRow(d);r!=d&&(this.blur(),
setTimeout(function(){"row"!=f.selectType?(f.selectNone(),f.select({recid:f.records[r].recid,column:a})):f.editField(f.records[r].recid,a,null,b)},1));break;case 40:if(!b.shiftKey)break;e=!0;r=f.nextRow(d);null!=r&&r!=d&&(this.blur(),setTimeout(function(){"row"!=f.selectType?(f.selectNone(),f.select({recid:f.records[r].recid,column:a})):f.editField(f.records[r].recid,a,null,b)},1));break;case 27:n=f.parseField(k,h.field),k.changes&&"undefined"!=typeof k.changes[h.field]&&(n=k.changes[h.field]),this.value=
"undefined"!=typeof n?n:"",this.blur(),setTimeout(function(){f.select({recid:c,column:a})},1)}e&&b.preventDefault&&b.preventDefault()});var e=m.find("input").focus();null!=b?e[0].setSelectionRange(e.val().length,e.val().length):e.select()},1);f.trigger($.extend(e,{phase:"after"}))}},editChange:function(c,a,b,e){e=0>a;a=0>a?-a-1:a;var f=(e?this.summary:this.records)[a],d=$("#grid_"+this.name+"_rec_"+w2utils.escapeId(f.recid)),k=this.columns[b],h=c.value,l=this.parseField(f,k.field),m=$(c).data("w2field");
m&&(h=m.clean(h),"list"==m.type&&""!=h&&(h=$(c).data("selected")));"checkbox"==c.type&&(!1===f.editable&&(c.checked=!c.checked),h=c.checked);for(c={phase:"before",type:"change",target:this.name,input_id:c.id,recid:f.recid,index:a,column:b,value_new:h,value_previous:f.changes&&f.changes.hasOwnProperty(k.field)?f.changes[k.field]:l,value_original:l};;){h=c.value_new;if("object"!=typeof h&&String(l)!=String(h)||"object"==typeof h&&("object"!=typeof l||h.id!=l.id)){if(c=this.trigger($.extend(c,{type:"change",
phase:"before"})),!0!==c.isCancelled){if(h!==c.value_new)continue;f.changes=f.changes||{};f.changes[k.field]=c.value_new;this.trigger($.extend(c,{phase:"after"}))}}else if(c=this.trigger($.extend(c,{type:"restore",phase:"before"})),!0!==c.isCancelled){if(h!==c.value_new)continue;f.changes&&delete f.changes[k.field];$.isEmptyObject(f.changes)&&delete f.changes;this.trigger($.extend(c,{phase:"after"}))}break}a=this.getCellHTML(a,b,e);e||(f.changes&&"undefined"!=typeof f.changes[k.field]?$(d).find("[col="+
b+"]").addClass("w2ui-changed").html(a):$(d).find("[col="+b+"]").removeClass("w2ui-changed").html(a))},"delete":function(c){var a=this,b=this.trigger({phase:"before",target:this.name,type:"delete",force:c});if(!0!==b.isCancelled){c=b.force;var e=this.getSelection();if(0!=e.length)if(""==this.msgDelete||c){if("object"!=typeof this.url?this.url:this.url.remove)this.request("delete-records");else if(this.selectNone(),"object"!=typeof e[0])this.remove.apply(this,e);else{for(var f in e){c=this.columns[e[f].column].field;
var d=this.get(e[f].recid,!0);null!=d&&"recid"!=c&&(this.records[d][c]="",this.records[d].changes&&delete this.records[d].changes[c])}this.refresh()}this.trigger($.extend(b,{phase:"after"}))}else w2confirm({title:w2utils.lang("Delete Confirmation"),msg:a.msgDelete,btn_yes:{"class":"btn-red"},callBack:function(b){if("Yes"==b)w2ui[a.name]["delete"](!0)}})}},click:function(c,a){var b=(new Date).getTime(),e=null;if(!(1==this.last.cancelClick||a&&a.altKey))if("object"==typeof c&&(e=c.column,c=c.recid),
"undefined"==typeof a&&(a={}),350>b-parseInt(this.last.click_time)&&this.last.click_recid==c&&"click"==a.type)this.dblClick(c,a);else{this.last.click_time=b;this.last.click_recid=c;if(null==e&&a.target){var f=a.target;"TD"!=f.tagName&&(f=$(f).parents("td")[0]);"undefined"!=typeof $(f).attr("col")&&(e=parseInt($(f).attr("col")))}b=this.trigger({phase:"before",target:this.name,type:"click",recid:c,column:e,originalEvent:a});if(!0!==b.isCancelled){var d=$("#grid_"+this.name+"_rec_"+w2utils.escapeId(c)).parents("tr");
if(0<d.length&&-1!=String(d.attr("id")).indexOf("expanded_row")){var k=d.parents(".w2ui-grid").attr("name");w2ui[k].selectNone();d.parents(".w2ui-grid").find(".w2ui-expanded-row .w2ui-grid").each(function(a,b){var c=$(b).attr("name");w2ui[c]&&w2ui[c].selectNone()})}$(this.box).find(".w2ui-expanded-row .w2ui-grid").each(function(a,b){var c=$(b).attr("name");w2ui[c]&&w2ui[c].selectNone()});f=this.getSelection();$("#grid_"+this.name+"_check_all").prop("checked",!1);k=this.get(c,!0);d=[];this.last.sel_ind=
k;this.last.sel_col=e;this.last.sel_recid=c;this.last.sel_type="click";if(a.shiftKey&&0<f.length&&this.multiSelect){if(f[0].recid){var h=this.get(f[0].recid,!0),k=this.get(c,!0);if(e>f[0].column)var l=f[0].column;else l=e,e=f[0].column;for(f=l;f<=e;f++)d.push(f)}else h=this.get(f[0],!0),k=this.get(c,!0);e=[];h>k&&(f=h,h=k,k=f);for(f="object"!=typeof this.url?this.url:this.url.get;h<=k;h++)if(!(0<this.searchData.length)||f||-1!=$.inArray(h,this.last.searchIds))if("row"==this.selectType)e.push(this.records[h].recid);
else for(var m in d)e.push({recid:this.records[h].recid,column:d[m]});this.select.apply(this,e)}else m=this.last.selection,d=-1!=m.indexes.indexOf(k)?!0:!1,(a.ctrlKey||a.shiftKey||a.metaKey)&&this.multiSelect||this.showSelectColumn?"row"!=this.selectType&&-1==$.inArray(e,m.columns[k])&&(d=!1):("row"!=this.selectType&&-1==$.inArray(e,m.columns[k])&&(d=!1),300<f.length?this.selectNone():this.unselect.apply(this,f)),!0===d?this.unselect({recid:c,column:e}):this.select({recid:c,column:e});this.status();
this.initResize();this.trigger($.extend(b,{phase:"after"}))}}},columnClick:function(c,a){var b=this.trigger({phase:"before",type:"columnClick",target:this.name,field:c,originalEvent:a});if(!0!==b.isCancelled){var e=this.getColumn(c);e&&e.sortable&&this.sort(c,null,a&&(a.ctrlKey||a.metaKey)?!0:!1);this.trigger($.extend(b,{phase:"after"}))}},keydown:function(c){function a(){var a=Math.floor((k[0].scrollTop+k.height()/2.1)/e.recordHeight);e.records[a]||(a=0);e.select({recid:e.records[a].recid,column:0})}
function b(){if("click"!=e.last.sel_type)return!1;if("row"!=e.selectType){if(e.last.sel_type="key",1<h.length){for(var a in h)if(h[a].recid==e.last.sel_recid&&h[a].column==e.last.sel_col){h.splice(a,1);break}e.unselect.apply(e,h);return!0}}else if(e.last.sel_type="key",1<h.length)return h.splice(h.indexOf(e.records[e.last.sel_ind].recid),1),e.unselect.apply(e,h),!0;return!1}var e=this;if(!0===e.keyboard){var f=e.trigger({phase:"before",type:"keydown",target:e.name,originalEvent:c});if(!0!==f.isCancelled){var d=
!1,k=$("#grid_"+e.name+"_records"),h=e.getSelection();0==h.length&&(d=!0);var l=h[0]||null,m=[],n=h[h.length-1];if("object"==typeof l&&null!=l){l=h[0].recid;m=[];for(n=0;h[n]&&h[n].recid==l;)m.push(h[n].column),n++;n=h[h.length-1].recid}var p=e.get(l,!0),r=e.get(n,!0),u=e.get(l),x=$("#grid_"+e.name+"_rec_"+(null!==p?w2utils.escapeId(e.records[p].recid):"none")),t=!1,n=c.keyCode,y=c.shiftKey;9==n&&(n=c.shiftKey?37:39,y=!1,t=!0);switch(n){case 8:case 46:if(this.show.toolbarDelete)e["delete"]();t=!0;
c.stopPropagation();break;case 27:e.selectNone();0<h.length&&"object"==typeof h[0]&&e.select({recid:h[0].recid,column:h[0].column});t=!0;break;case 65:if(!c.metaKey&&!c.ctrlKey)break;e.selectAll();t=!0;break;case 70:if(!c.metaKey&&!c.ctrlKey)break;$("#grid_"+e.name+"_search_all").focus();t=!0;break;case 13:if("row"==this.selectType&&!0===e.show.expandColumn){if(0>=x.length)break;e.toggle(l,c);t=!0}else{for(var v in this.columns)if(this.columns[v].editable){m.push(parseInt(v));break}"row"==this.selectType&&
this.last.edit_col&&(m=[this.last.edit_col]);0<m.length&&(e.editField(l,m[0],null,c),t=!0)}break;case 37:if(d)break;v=$("#grid_"+this.name+"_rec_"+w2utils.escapeId(e.records[p].recid)).parents("tr");if(0<v.length&&-1!=String(v.attr("id")).indexOf("expanded_row")){var l=v.prev().attr("recid"),q=v.parents(".w2ui-grid").attr("name");e.selectNone();w2utils.keyboard.active(q);w2ui[q].set(l,{expanded:!1});w2ui[q].collapse(l);w2ui[q].click(l);t=!0;break}if("row"==this.selectType){if(0>=x.length||!0!==u.expanded)break;
e.set(l,{expanded:!1},!0);e.collapse(l,c)}else if(d=e.prevCell(m[0]),null!=d)if(y&&e.multiSelect){if(b())return;p=[];t=[];v=[];if(0==m.indexOf(this.last.sel_col)&&1<m.length)for(q in h)-1==p.indexOf(h[q].recid)&&p.push(h[q].recid),v.push({recid:h[q].recid,column:m[m.length-1]});else for(q in h)-1==p.indexOf(h[q].recid)&&p.push(h[q].recid),t.push({recid:h[q].recid,column:d});e.unselect.apply(e,v);e.select.apply(e,t)}else c.shiftKey=!1,e.click({recid:l,column:d},c);else if(!y)for(q=1;q<h.length;q++)e.unselect(h[q]);
t=!0;break;case 39:if(d)break;if("row"==this.selectType){if(0>=x.length||!0===u.expanded||!0!==e.show.expandColumn)break;e.expand(l,c)}else if(d=e.nextCell(m[m.length-1]),null!==d)if(y&&39==n&&e.multiSelect){if(b())return;p=[];t=[];v=[];if(m.indexOf(this.last.sel_col)==m.length-1&&1<m.length)for(q in h)-1==p.indexOf(h[q].recid)&&p.push(h[q].recid),v.push({recid:h[q].recid,column:m[0]});else for(q in h)-1==p.indexOf(h[q].recid)&&p.push(h[q].recid),t.push({recid:h[q].recid,column:d});e.unselect.apply(e,
v);e.select.apply(e,t)}else e.click({recid:l,column:d},c);else if(!y)for(q=0;q<h.length-1;q++)e.unselect(h[q]);t=!0;break;case 38:d&&a();if(0>=x.length)break;d=e.prevRow(p);if(null!=d){if(e.records[d].expanded&&(q=$("#grid_"+e.name+"_rec_"+w2utils.escapeId(e.records[d].recid)+"_expanded_row").find(".w2ui-grid"),0<q.length&&w2ui[q.attr("name")])){e.selectNone();q=q.attr("name");t=w2ui[q].records;w2utils.keyboard.active(q);w2ui[q].click(t[t.length-1].recid);t=!0;break}if(y&&e.multiSelect){if(b())return;
if("row"==e.selectType)e.last.sel_ind>d&&e.last.sel_ind!=r?e.unselect(e.records[r].recid):e.select(e.records[d].recid);else if(e.last.sel_ind>d&&e.last.sel_ind!=r){d=r;p=[];for(v in m)p.push({recid:e.records[d].recid,column:m[v]});e.unselect.apply(e,p)}else{p=[];for(v in m)p.push({recid:e.records[d].recid,column:m[v]});e.select.apply(e,p)}}else 300<h.length?this.selectNone():this.unselect.apply(this,h),e.click({recid:e.records[d].recid,column:m[0]},c);e.scrollIntoView(d);c.preventDefault&&c.preventDefault()}else{if(!y)for(q=
1;q<h.length;q++)e.unselect(h[q]);v=$("#grid_"+e.name+"_rec_"+w2utils.escapeId(e.records[p].recid)).parents("tr");if(0<v.length&&-1!=String(v.attr("id")).indexOf("expanded_row")){l=v.prev().attr("recid");q=v.parents(".w2ui-grid").attr("name");e.selectNone();w2utils.keyboard.active(q);w2ui[q].click(l);t=!0;break}}break;case 40:d&&a();if(0>=x.length)break;if(e.records[r].expanded&&(q=$("#grid_"+this.name+"_rec_"+w2utils.escapeId(e.records[r].recid)+"_expanded_row").find(".w2ui-grid"),0<q.length&&w2ui[q.attr("name")])){e.selectNone();
q=q.attr("name");t=w2ui[q].records;w2utils.keyboard.active(q);w2ui[q].click(t[0].recid);t=!0;break}d=e.nextRow(r);if(null!=d){if(y&&e.multiSelect){if(b())return;if("row"==e.selectType)this.last.sel_ind<d&&this.last.sel_ind!=p?e.unselect(e.records[p].recid):e.select(e.records[d].recid);else if(this.last.sel_ind<d&&this.last.sel_ind!=p){d=p;p=[];for(v in m)p.push({recid:e.records[d].recid,column:m[v]});e.unselect.apply(e,p)}else{p=[];for(v in m)p.push({recid:e.records[d].recid,column:m[v]});e.select.apply(e,
p)}}else 300<h.length?this.selectNone():this.unselect.apply(this,h),e.click({recid:e.records[d].recid,column:m[0]},c);e.scrollIntoView(d);t=!0}else{if(!y)for(q=0;q<h.length-1;q++)e.unselect(h[q]);v=$("#grid_"+this.name+"_rec_"+w2utils.escapeId(e.records[r].recid)).parents("tr");if(0<v.length&&-1!=String(v.attr("id")).indexOf("expanded_row")){l=v.next().attr("recid");q=v.parents(".w2ui-grid").attr("name");e.selectNone();w2utils.keyboard.active(q);w2ui[q].click(l);t=!0;break}}break;case 17:case 91:var w=
function(){$("#_tmp_copy_data").remove();$(document).off("keyup",w)};if(d)break;q=e.copy();$("body").append('<textarea id="_tmp_copy_data"    onpaste="var obj = this; setTimeout(function () { w2ui[\''+e.name+"'].paste(obj.value); }, 1);\"    onkeydown=\"w2ui['"+e.name+'\'].keydown(event)"   style="position: absolute; top: -100px; height: 1px; width: 1px">'+q+"</textarea>");$("#_tmp_copy_data").focus().select();$(document).on("keyup",w);break;case 88:if(d)break;(c.ctrlKey||c.metaKey)&&setTimeout(function(){e["delete"](!0)},
100)}p=[187,189,32];for(q=48;90>=q;q++)p.push(q);-1==p.indexOf(n)||c.ctrlKey||c.metaKey||t||(0==m.length&&m.push(0),p=String.fromCharCode(n),187==n&&(p="="),189==n&&(p="-"),y||(p=p.toLowerCase()),e.editField(l,m[0],p,c),t=!0);t&&c.preventDefault&&c.preventDefault();e.trigger($.extend(f,{phase:"after"}))}}},scrollIntoView:function(c){var a=this.records.length;0==this.searchData.length||this.url||(a=this.last.searchIds.length);if("undefined"==typeof c){c=this.getSelection();if(0==c.length)return;c=
this.get(c[0],!0)}var b=$("#grid_"+this.name+"_records");if(0!=a){var e=this.last.searchIds.length;b.height()>this.recordHeight*(0<e?e:a)||(0<e&&(c=this.last.searchIds.indexOf(c)),a=Math.floor(b[0].scrollTop/this.recordHeight),e=a+Math.floor(b.height()/this.recordHeight),c==a&&b.animate({scrollTop:b.scrollTop()-b.height()/1.3},250,"linear"),c==e&&b.animate({scrollTop:b.scrollTop()+b.height()/1.3},250,"linear"),(c<a||c>e)&&b.animate({scrollTop:(c-1)*this.recordHeight}))}},dblClick:function(c,a){var b=
null;"object"==typeof c&&(b=c.column,c=c.recid);"undefined"==typeof a&&(a={});null==b&&a.target&&(b=a.target,"TD"!=b.tagName&&(b=$(b).parents("td")[0]),b=parseInt($(b).attr("col")));var e=this.trigger({phase:"before",target:this.name,type:"dblClick",recid:c,column:b,originalEvent:a});if(!0!==e.isCancelled){this.selectNone();var f=this.columns[b];f&&$.isPlainObject(f.editable)?this.editField(c,b,null,a):this.select({recid:c,column:b});this.trigger($.extend(e,{phase:"after"}))}},contextMenu:function(c,
a){var b=this;"text"!=b.last.userSelect&&("undefined"==typeof a&&(a={offsetX:0,offsetY:0,target:$("#grid_"+b.name+"_rec_"+c)[0]}),"undefined"===typeof a.offsetX&&(a.offsetX=a.layerX-a.target.offsetLeft,a.offsetY=a.layerY-a.target.offsetTop),w2utils.isFloat(c)&&(c=parseFloat(c)),-1==this.getSelection().indexOf(c)&&b.click(c),setTimeout(function(){var e=b.trigger({phase:"before",type:"contextMenu",target:b.name,originalEvent:a,recid:c});!0!==e.isCancelled&&(0<b.menu.length&&$(b.box).find(a.target).w2menu(b.menu,
{left:a.offsetX,onSelect:function(a){b.menuClick(c,parseInt(a.index),a.originalEvent)}}),b.trigger($.extend(e,{phase:"after"})))},150),a.preventDefault&&a.preventDefault())},menuClick:function(c,a,b){c=this.trigger({phase:"before",type:"menuClick",target:this.name,originalEvent:b,recid:c,menuIndex:a,menuItem:this.menu[a]});!0!==c.isCancelled&&this.trigger($.extend(c,{phase:"after"}))},toggle:function(c){return!0===this.get(c).expanded?this.collapse(c):this.expand(c)},expand:function(c){function a(){var a=
$("#grid_"+e.name+"_rec_"+f+"_expanded"),b=$("#grid_"+e.name+"_rec_"+f+"_expanded_row .w2ui-expanded1 > div");5>a.height()||(a.css("opacity",1),b.show().css("opacity",1),$("#grid_"+e.name+"_cell_"+e.get(c,!0)+"_expand div").html("-"))}var b=this.get(c),e=this,f=w2utils.escapeId(c);if(0<$("#grid_"+this.name+"_rec_"+f+"_expanded_row").length||"none"==b.expanded)return!1;var d=1+(this.show.selectColumn?1:0);$("#grid_"+this.name+"_rec_"+f).after('<tr id="grid_'+this.name+"_rec_"+c+'_expanded_row" class="w2ui-expanded-row ">'+
(this.show.lineNumbers?'<td class="w2ui-col-number"></td>':"")+'    <td class="w2ui-grid-data w2ui-expanded1" colspan="'+d+'"><div style="display: none"></div></td>    <td colspan="100" class="w2ui-expanded2">        <div id="grid_'+this.name+"_rec_"+c+'_expanded" style="opacity: 0"></div>    </td></tr>');d=this.trigger({phase:"before",type:"expand",target:this.name,recid:c,box_id:"grid_"+this.name+"_rec_"+c+"_expanded",ready:a});if(!0===d.isCancelled)$("#grid_"+this.name+"_rec_"+f+"_expanded_row").remove();
else return $("#grid_"+this.name+"_rec_"+f).attr("expanded","yes").addClass("w2ui-expanded"),$("#grid_"+this.name+"_rec_"+f+"_expanded_row").show(),$("#grid_"+this.name+"_cell_"+this.get(c,!0)+"_expand div").html('<div class="w2ui-spinner" style="width: 16px; height: 16px; margin: -2px 2px;"></div>'),b.expanded=!0,setTimeout(a,300),this.trigger($.extend(d,{phase:"after"})),this.resizeRecords(),!0},collapse:function(c){var a=this.get(c),b=this,e=w2utils.escapeId(c);if(0==$("#grid_"+this.name+"_rec_"+
e+"_expanded_row").length)return!1;var f=this.trigger({phase:"before",type:"collapse",target:this.name,recid:c,box_id:"grid_"+this.name+"_rec_"+e+"_expanded"});if(!0!==f.isCancelled)return $("#grid_"+this.name+"_rec_"+e).removeAttr("expanded").removeClass("w2ui-expanded"),$("#grid_"+this.name+"_rec_"+e+"_expanded").css("opacity",0),$("#grid_"+this.name+"_cell_"+this.get(c,!0)+"_expand div").html("+"),setTimeout(function(){$("#grid_"+b.name+"_rec_"+e+"_expanded").height("0px");setTimeout(function(){$("#grid_"+
b.name+"_rec_"+e+"_expanded_row").remove();delete a.expanded;b.trigger($.extend(f,{phase:"after"}));b.resizeRecords()},300)},200),!0},sort:function(c,a,b){var e=this.trigger({phase:"before",type:"sort",target:this.name,field:c,direction:a,multiField:b});if(!0!==e.isCancelled){if("undefined"!=typeof c){var f=this.sortData.length,d;for(d in this.sortData)if(this.sortData[d].field==c){f=d;break}if("undefined"==typeof a||null==a)if("undefined"==typeof this.sortData[f])a="asc";else switch(String(this.sortData[f].direction)){case "asc":a=
"desc";break;case "desc":a="asc";break;default:a="asc"}!1===this.multiSort&&(this.sortData=[],f=0);1!=b&&(this.sortData=[],f=0);"undefined"==typeof this.sortData[f]&&(this.sortData[f]={});this.sortData[f].field=c;this.sortData[f].direction=a}else this.sortData=[];this.selectNone();("object"!=typeof this.url?this.url:this.url.get)?(this.trigger($.extend(e,{phase:"after"})),this.last.xhr_offset=0,this.reload()):(this.localSort(),0<this.searchData.length&&this.localSearch(!0),this.trigger($.extend(e,
{phase:"after"})),this.refresh())}},copy:function(){var c=this.getSelection();if(0==c.length)return"";var a="";if("object"==typeof c[0]){var b=c[0].column,e=c[0].column,f=[],d;for(d in c)c[d].column<b&&(b=c[d].column),c[d].column>e&&(e=c[d].column),-1==f.indexOf(c[d].index)&&f.push(c[d].index);f.sort();for(var k in f){for(var h=f[k],l=b;l<=e;l++){var m=this.columns[l];!0!==m.hidden&&(a+=w2utils.stripTags(this.getCellHTML(h,l))+"\t")}a=a.substr(0,a.length-1);a+="\n"}}else{for(l in this.columns)m=this.columns[l],
!0!==m.hidden&&(a+='"'+w2utils.stripTags(m.caption?m.caption:m.field)+'"\t');a=a.substr(0,a.length-1);a+="\n";for(d in c){h=this.get(c[d],!0);for(l in this.columns)m=this.columns[l],!0!==m.hidden&&(a+='"'+w2utils.stripTags(this.getCellHTML(h,l))+'"\t');a=a.substr(0,a.length-1);a+="\n"}}a=a.substr(0,a.length-1);c=this.trigger({phase:"before",type:"copy",target:this.name,text:a});if(!0===c.isCancelled)return"";a=c.text;this.trigger($.extend(c,{phase:"after"}));return a},paste:function(c){var a=this.getSelection(),
b=this.get(a[0].recid,!0),e=a[0].column,f=this.trigger({phase:"before",type:"paste",target:this.name,text:c,index:b,column:e});if(!0!==f.isCancelled){c=f.text;if("row"==this.selectType||0==a.length)console.log("ERROR: You can paste only if grid.selectType = 'cell' and when at least one cell selected.");else{a=[];c=c.split("\n");for(var d in c){var k=c[d].split("\t"),h=0,l=this.records[b],m=[],n;for(n in k)if(this.columns[e+h]){var p=this.columns[e+h].field;l.changes=l.changes||{};l.changes[p]=k[n];
m.push(e+h);h++}for(var r in m)a.push({recid:l.recid,column:m[r]});b++}this.selectNone();this.select.apply(this,a);this.refresh()}this.trigger($.extend(f,{phase:"after"}))}},resize:function(){var c=(new Date).getTime();if(this.box&&$(this.box).attr("name")==this.name){$(this.box).find("> div").css("width",$(this.box).width()).css("height",$(this.box).height());var a=this.trigger({phase:"before",type:"resize",target:this.name});if(!0!==a.isCancelled)return this.resizeBoxes(),this.resizeRecords(),this.trigger($.extend(a,
{phase:"after"})),(new Date).getTime()-c}},refreshCell:function(c,a){var b=this.get(c,!0),e=this.records[b]&&this.records[b].recid==c?!1:!0,f=this.getColumn(a,!0),d=e?this.summary[b]:this.records[b],k=this.columns[f],h=$("#grid_"+this.name+"_rec_"+c+" [col="+f+"]");h.html(this.getCellHTML(b,f,e));d.changes&&"undefined"!=typeof d.changes[k.field]?h.addClass("w2ui-changed"):h.removeClass("w2ui-changed")},refreshRow:function(c){var a=$("#grid_"+this.name+"_rec_"+w2utils.escapeId(c));if(0!=a.length){var b=
this.get(c,!0),e=a.attr("line");c=this.records[b]&&this.records[b].recid==c?!1:!0;var f="object"!=typeof this.url?this.url:this.url.get;if(0<this.searchData.length&&!f)for(var d in this.last.searchIds)this.last.searchIds[d]==b&&(b=d);$(a).replaceWith(this.getRecordHTML(b,e,c));c&&this.resize()}},refresh:function(){var c=this,a=(new Date).getTime(),b="object"!=typeof this.url?this.url:this.url.get;0>=this.total&&!b&&0==this.searchData.length&&(this.total=this.records.length);this.toolbar.disable("w2ui-edit",
"w2ui-delete");if(this.box&&(b=this.trigger({phase:"before",target:this.name,type:"refresh"}),!0!==b.isCancelled)){this.show.header?$("#grid_"+this.name+"_header").html(this.header+"&nbsp;").show():$("#grid_"+this.name+"_header").hide();if(this.show.toolbar){if(!(this.toolbar&&this.toolbar.get("w2ui-column-on-off")&&this.toolbar.get("w2ui-column-on-off").checked)&&($("#grid_"+this.name+"_toolbar").show(),"object"==typeof this.toolbar)){var e=this.toolbar.items,f;for(f in e)"w2ui-search"!=e[f].id&&
"break"!=e[f].type&&this.toolbar.refresh(e[f].id)}}else $("#grid_"+this.name+"_toolbar").hide();this.searchClose();var d=$("#grid_"+c.name+"_search_all");!this.multiSearch&&"all"==this.last.field&&0<this.searches.length&&(this.last.field=this.searches[0].field,this.last.caption=this.searches[0].caption);for(var k in this.searches)this.searches[k].field==this.last.field&&(this.last.caption=this.searches[k].caption);this.last.multi?d.attr("placeholder","["+w2utils.lang("Multiple Fields")+"]"):d.attr("placeholder",
this.last.caption);d.val()!=this.last.search&&(k=this.last.search,(e=d.data("w2field"))&&(k=e.format(k)),d.val(k));e=this.find({summary:!0},!0);if(0<e.length){for(f in e)this.summary.push(this.records[e[f]]);for(f=e.length-1;0<=f;f--)this.records.splice(e[f],1);this.total-=e.length}f=c.find({expanded:!0},!0);for(var h in f)c.records[f[h]].expanded=!1;h=""+('<div id="grid_'+this.name+'_records" class="w2ui-grid-records"    onscroll="var obj = w2ui[\''+this.name+"'];         obj.last.scrollTop = this.scrollTop;         obj.last.scrollLeft = this.scrollLeft;         $('#grid_"+
this.name+"_columns')[0].scrollLeft = this.scrollLeft;        $('#grid_"+this.name+"_summary')[0].scrollLeft = this.scrollLeft;        obj.scroll(event);\">"+this.getRecordsHTML()+'</div><div id="grid_'+this.name+'_columns" class="w2ui-grid-columns">    <table>'+this.getColumnsHTML()+"</table></div>");$("#grid_"+this.name+"_body").html(h);0<this.summary.length?$("#grid_"+this.name+"_summary").html(this.getSummaryHTML()).show():$("#grid_"+this.name+"_summary").hide();this.show.footer?$("#grid_"+this.name+
"_footer").html(this.getFooterHTML()).show():$("#grid_"+this.name+"_footer").hide();0<this.searchData.length?$("#grid_"+this.name+"_searchClear").show():$("#grid_"+this.name+"_searchClear").hide();h=this.last.selection;h.indexes.length==this.records.length||0!==this.searchData.length&&h.indexes.length==this.last.searchIds.length?$("#grid_"+this.name+"_check_all").prop("checked",!0):$("#grid_"+this.name+"_check_all").prop("checked",!1);this.status();setTimeout(function(){var a=$.trim($("#grid_"+c.name+
"_search_all").val());""!=a&&$(c.box).find(".w2ui-grid-data > div").w2marker(a)},50);this.trigger($.extend(b,{phase:"after"}));c.resize();c.addRange("selection");setTimeout(function(){c.resize();c.scroll()},1);c.reorderColumns&&!c.last.columnDrag?c.last.columnDrag=c.initColumnDrag():!c.reorderColumns&&c.last.columnDrag&&c.last.columnDrag.remove();return(new Date).getTime()-a}},render:function(c){function a(a){if(1==a.which&&("text"==f.last.userSelect&&(delete f.last.userSelect,$(f.box).find(".w2ui-grid-body").css("user-select",
"none").css("-webkit-user-select","none").css("-moz-user-select","none").css("-ms-user-select","none"),$(this.box).on("selectstart",function(){return!1})),!($(a.target).parents().hasClass("w2ui-head")||$(a.target).hasClass("w2ui-head")||f.last.move&&"expand"==f.last.move.type))){if(a.altKey)$(f.box).off("selectstart"),$(f.box).find(".w2ui-grid-body").css("user-select","text").css("-webkit-user-select","text").css("-moz-user-select","text").css("-ms-user-select","text"),f.selectNone(),f.last.move=
{type:"text-select"},f.last.userSelect="text";else{if(!f.multiSelect)return;f.last.move={x:a.screenX,y:a.screenY,divX:0,divY:0,recid:$(a.target).parents("tr").attr("recid"),column:"TD"==a.target.tagName?$(a.target).attr("col"):$(a.target).parents("td").attr("col"),type:"select",ghost:!1,start:!0}}$(document).on("mousemove",b);$(document).on("mouseup",e)}}function b(a){var b=f.last.move;if(b&&"select"==b.type&&(b.divX=a.screenX-b.x,b.divY=a.screenY-b.y,!(1>=Math.abs(b.divX)&&1>=Math.abs(b.divY))))if(f.last.cancelClick=
!0,1==f.reorderRows){if(!b.ghost){var c=$("#grid_"+f.name+"_rec_"+b.recid),e=c.parents("table").find("tr:first-child").clone();b.offsetY=a.offsetY;b.from=b.recid;b.pos=c.position();b.ghost=$(c).clone(!0);b.ghost.removeAttr("id");c.find("td:first-child").replaceWith('<td colspan="1000" style="height: '+f.recordHeight+'px; background-color: #ddd"></td>');c=$(f.box).find(".w2ui-grid-records");c.append('<table id="grid_'+f.name+'_ghost" style="position: absolute; z-index: 999999; opacity: 0.8; border-bottom: 2px dashed #aaa; border-top: 2px dashed #aaa; pointer-events: none;"></table>');
$("#grid_"+f.name+"_ghost").append(e).append(b.ghost)}e=$(a.target).parents("tr").attr("recid");if(e!=b.from){var c=$("#grid_"+f.name+"_rec_"+b.recid),d=$("#grid_"+f.name+"_rec_"+e);0>a.screenY-b.lastY?c.after(d):d.after(c);b.lastY=a.screenY;b.to=e}e=$("#grid_"+f.name+"_ghost");c=$(f.box).find(".w2ui-grid-records");e.css({top:b.pos.top+b.divY+c.scrollTop(),left:b.pos.left})}else if(b.start&&b.recid&&(f.selectNone(),b.start=!1),c=[],e="TR"==a.target.tagName?$(a.target).attr("recid"):$(a.target).parents("tr").attr("recid"),
"undefined"!=typeof e){var g=f.get(b.recid,!0);if(null!==g){var k=f.get(e,!0);if(null!==k){var x=parseInt(b.column);a=parseInt("TD"==a.target.tagName?$(a.target).attr("col"):$(a.target).parents("td").attr("col"));g>k&&(e=g,g=k,k=e);e="ind1:"+g+",ind2;"+k+",col1:"+x+",col2:"+a;if(b.range!=e){b.range=e;for(b=g;b<=k;b++)if(!(0<f.last.searchIds.length&&-1==f.last.searchIds.indexOf(b)))if("row"!=f.selectType)for(x>a&&(e=x,x=a,a=e),e=x;e<=a;e++)f.columns[e].hidden||c.push({recid:f.records[b].recid,column:parseInt(e)});
else c.push(f.records[b].recid);if("row"!=f.selectType){b=f.getSelection();e=[];for(d in c){a=!1;for(var t in b)c[d].recid==b[t].recid&&c[d].column==b[t].column&&(a=!0);a||e.push({recid:c[d].recid,column:c[d].column})}f.select.apply(f,e);e=[];for(t in b){a=!1;for(d in c)c[d].recid==b[t].recid&&c[d].column==b[t].column&&(a=!0);a||e.push({recid:b[t].recid,column:b[t].column})}f.unselect.apply(f,e)}else if(f.multiSelect){b=f.getSelection();for(d in c)-1==b.indexOf(c[d])&&f.select(c[d]);for(t in b)-1==
c.indexOf(b[t])&&f.unselect(b[t])}}}}}}function e(a){var c=f.last.move;setTimeout(function(){delete f.last.cancelClick},1);if(!$(a.target).parents().hasClass(".w2ui-head")&&!$(a.target).hasClass(".w2ui-head")){if(c&&"select"==c.type&&1==f.reorderRows){a=f.get(c.from,!0);var d=f.records[a];f.records.splice(a,1);c=f.get(c.to,!0);a>c?f.records.splice(c,0,d):f.records.splice(c+1,0,d);$("#grid_"+f.name+"_ghost").remove();f.refresh()}delete f.last.move;$(document).off("mousemove",b);$(document).off("mouseup",
e)}}var f=this,d=(new Date).getTime();"undefined"!=typeof c&&null!=c&&(0<$(this.box).find("#grid_"+this.name+"_body").length&&$(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-grid").html(""),this.box=c);if(this.box&&(null==this.last.sortData&&(this.last.sortData=this.sortData),c=this.trigger({phase:"before",target:this.name,type:"render",box:c}),!0!==c.isCancelled)){$(this.box).attr("name",this.name).addClass("w2ui-reset w2ui-grid").html('<div>    <div id="grid_'+this.name+'_header" class="w2ui-grid-header"></div>    <div id="grid_'+
this.name+'_toolbar" class="w2ui-grid-toolbar"></div>    <div id="grid_'+this.name+'_body" class="w2ui-grid-body"></div>    <div id="grid_'+this.name+'_summary" class="w2ui-grid-body w2ui-grid-summary"></div>    <div id="grid_'+this.name+'_footer" class="w2ui-grid-footer"></div></div>');"row"!=this.selectType&&$(this.box).addClass("w2ui-ss");0<$(this.box).length&&($(this.box)[0].style.cssText+=this.style);this.initToolbar();null!=this.toolbar&&this.toolbar.render($("#grid_"+this.name+"_toolbar")[0]);
if(this.last.field&&"all"!=this.last.field){var k=this.searchData;this.initAllField(this.last.field,1==k.length?k[0].value:null)}$("#grid_"+this.name+"_footer").html(this.getFooterHTML());this.last.state||(this.last.state=this.stateSave(!0));this.stateRestore();this.url&&this.refresh();this.reload();$(this.box).on("mousedown",a);$(this.box).on("selectstart",function(){return!1});this.trigger($.extend(c,{phase:"after"}));0==$(".w2ui-layout").length&&(this.tmp_resize=function(a){w2ui[f.name].resize()},
$(window).off("resize",this.tmp_resize).on("resize",this.tmp_resize));return(new Date).getTime()-d}},destroy:function(){var c=this.trigger({phase:"before",target:this.name,type:"destroy"});!0!==c.isCancelled&&($(window).off("resize",this.tmp_resize),"object"==typeof this.toolbar&&this.toolbar.destroy&&this.toolbar.destroy(),0<$(this.box).find("#grid_"+this.name+"_body").length&&$(this.box).removeAttr("name").off("selectstart").removeClass("w2ui-reset w2ui-grid").html(""),delete w2ui[this.name],this.trigger($.extend(c,
{phase:"after"})))},initColumnOnOff:function(){if(this.show.toolbarColumns){var c='<div class="w2ui-col-on-off"><table><tr><td style="width: 30px">    <input id="grid_'+this.name+'_column_ln_check" type="checkbox" tabIndex="-1" '+(this.show.lineNumbers?"checked":"")+"        onclick=\"w2ui['"+this.name+"'].columnOnOff(this, event, 'line-numbers');\"></td><td onclick=\"w2ui['"+this.name+"'].columnOnOff(this, event, 'line-numbers'); $('#w2ui-overlay')[0].hide();\">    <label for=\"grid_"+this.name+
'_column_ln_check">'+w2utils.lang("Line #")+"</label></td></tr>",a;for(a in this.columns){var b=this.columns[a],e=this.columns[a].caption;!1!==b.hideable&&(!e&&this.columns[a].hint&&(e=this.columns[a].hint),e||(e="- column "+(parseInt(a)+1)+" -"),c+='<tr><td style="width: 30px">    <input id="grid_'+this.name+"_column_"+a+'_check" type="checkbox" tabIndex="-1" '+(b.hidden?"":"checked")+"        onclick=\"w2ui['"+this.name+"'].columnOnOff(this, event, '"+b.field+'\');"></td><td>    <label for="grid_'+
this.name+"_column_"+a+'_check">'+e+"</label></td></tr>")}c+='<tr><td colspan="2"><div style="border-top: 1px solid #ddd;"></div></td></tr>';("object"!=typeof this.url?this.url:this.url.get)&&this.show.skipRecords&&(c+='<tr><td colspan="2" style="padding: 0px">    <div style="cursor: pointer; padding: 2px 8px; cursor: default">'+w2utils.lang("Skip")+'        <input type="text" style="width: 45px" value="'+this.offset+'"             onkeypress="if (event.keyCode == 13) {                w2ui[\''+this.name+
"'].skip(this.value);                $('#w2ui-overlay')[0].hide();             }\"> "+w2utils.lang("Records")+"    </div></td></tr>");c+='<tr><td colspan="2" onclick="w2ui[\''+this.name+"'].stateSave(); $('#w2ui-overlay')[0].hide();\">    <div style=\"cursor: pointer; padding: 4px 8px; cursor: default\">"+w2utils.lang("Save Grid State")+'</div></td></tr><tr><td colspan="2" onclick="w2ui[\''+this.name+"'].stateReset(); $('#w2ui-overlay')[0].hide();\">    <div style=\"cursor: pointer; padding: 4px 8px; cursor: default\">"+
w2utils.lang("Restore Default State")+"</div></td></tr>";c+="</table></div>";this.toolbar.get("w2ui-column-on-off").html=c}},initColumnDrag:function(c){function a(){h.pressed=!1;clearTimeout(h.timeout)}function b(a){h.timeout&&clearTimeout(h.timeout);var b=this;h.pressed=!0;h.timeout=setTimeout(function(){if(h.pressed){var c,d,g;c=["w2ui-col-number","w2ui-col-expand","w2ui-col-select"].concat(["w2ui-head-last"]);if($(a.originalEvent.target).parents().hasClass("w2ui-head")){g=0;for(var u=c.length;g<
u;g++)if($(a.originalEvent.target).parents().hasClass(c[g]))return;h.numberPreColumnsPresent=$(k.box).find(".w2ui-head.w2ui-col-number, .w2ui-head.w2ui-col-expand, .w2ui-head.w2ui-col-select").length;h.columnHead=c=$(a.originalEvent.target).parents(".w2ui-head");d=parseInt(c.attr("col"),10);c=k.trigger({type:"columnDragStart",phase:"before",originalEvent:a,origColumnNumber:d,target:c[0]});if(!0===c.isCancelled)return!1;d=h.columns=$(k.box).find(".w2ui-head:not(.w2ui-head-last)");$(document).on("mouseup",
f);$(document).on("mousemove",e);h.originalPos=parseInt($(a.originalEvent.target).parent(".w2ui-head").attr("col"),10);h.ghost=$(b).clone(!0);$(h.ghost).find('[col]:not([col="'+h.originalPos+'"]), .w2ui-toolbar, .w2ui-grid-header').remove();$(h.ghost).find(".w2ui-col-number, .w2ui-col-expand, .w2ui-col-select").remove();$(h.ghost).find(".w2ui-grid-body").css({top:0});g=$(h.ghost).find('[col="'+h.originalPos+'"]');$(document.body).append(h.ghost);$(h.ghost).css({width:0,height:0,margin:0,position:"fixed",
zIndex:999999,opacity:0}).addClass(".w2ui-grid-ghost").animate({width:g.width(),height:$(k.box).find(".w2ui-grid-body:first").height(),left:a.pageX,top:a.pageY,opacity:.8},0);h.offsets=[];g=0;for(u=d.length;g<u;g++)h.offsets.push($(d[g]).offset().left);k.trigger($.extend(c,{phase:"after"}))}}},150)}function e(a){if(h.pressed){var b=a.originalEvent.pageX;a=a.originalEvent.pageY;var c=h.offsets,e=$(".w2ui-head:not(.w2ui-head-last)").width();h.targetInt=Math.max(h.numberPreColumnsPresent,d(b,c,e));c=
h.targetInt;h.marker||h.markerLeft||(h.marker=$('<div class="col-intersection-marker"><div class="top-marker"></div><div class="bottom-marker"></div></div>'),h.markerLeft=$('<div class="col-intersection-marker"><div class="top-marker"></div><div class="bottom-marker"></div></div>'));h.lastInt&&h.lastInt===c||(h.lastInt=c,h.marker.remove(),h.markerLeft.remove(),$(".w2ui-head").removeClass("w2ui-col-intersection"),c>=h.columns.length?($(h.columns[h.columns.length-1]).children("div:last").append(h.marker.addClass("right").removeClass("left")),
$(h.columns[h.columns.length-1]).addClass("w2ui-col-intersection")):c<=h.numberPreColumnsPresent?($(h.columns[h.numberPreColumnsPresent]).prepend(h.marker.addClass("left").removeClass("right")).css({position:"relative"}),$(h.columns[h.numberPreColumnsPresent]).prev().addClass("w2ui-col-intersection")):($(h.columns[c]).children("div:last").prepend(h.marker.addClass("left").removeClass("right")),$(h.columns[c]).prev().children("div:last").append(h.markerLeft.addClass("right").removeClass("left")).css({position:"relative"}),
$(h.columns[c-1]).addClass("w2ui-col-intersection")));$(h.ghost).css({left:b-10,top:a-10})}}function f(a){h.pressed=!1;var b,c,d,g,u=$(".w2ui-grid-ghost");a=k.trigger({type:"columnDragEnd",phase:"before",originalEvent:a,target:h.columnHead[0]});if(!0===a.isCancelled)return!1;c=k.columns[h.originalPos];d=k.columns;g=$(h.columns[Math.min(h.lastInt,h.columns.length-1)]);b=h.lastInt<h.columns.length?parseInt(g.attr("col")):d.length;b!==h.originalPos+1&&b!==h.originalPos&&g&&g.length?($(h.ghost).animate({top:$(k.box).offset().top,
left:g.offset().left,width:0,height:0,opacity:.2},300,function(){$(this).remove();u.remove()}),d.splice(b,0,$.extend({},c)),d.splice(d.indexOf(c),1)):($(h.ghost).remove(),u.remove());$(document).off("mouseup",f);$(document).off("mousemove",e);h.marker&&h.marker.remove();h={};k.refresh();k.trigger($.extend(a,{phase:"after",targetColumnNumber:b-1}))}function d(a,b,c){if(a<=b[0])return 0;if(a>=b[b.length-1]+c)return b.length;for(var e=0,f=b.length;e<f;e++){var g=b[e+1]||b[e]+c,h=(g-b[e])/2+b[e];if(a>
b[e]&&a<=h)return e;if(a>h&&a<=g)return e+1}return intersection}if(this.columnGroups&&this.columnGroups.length)throw"Draggable columns are not currently supported with column groups.";var k=this,h={lastInt:null,pressed:!1,timeout:null,columnHead:null};$(k.box).on("mousedown",b);$(k.box).on("mouseup",a);return{remove:function(){$(k.box).off("mousedown",b);$(k.box).off("mouseup",a);$(k.box).find(".w2ui-head").removeAttr("draggable");k.last.columnDrag=!1}}},columnOnOff:function(c,a,b){a=this.trigger({phase:"before",
target:this.name,type:"columnOnOff",checkbox:c,field:b,originalEvent:a});if(!0!==a.isCancelled){var e=this,f;for(f in this.records)!0===this.records[f].expanded&&(this.records[f].expanded=!1);f=!0;"line-numbers"==b?(this.show.lineNumbers=!this.show.lineNumbers,this.refresh()):(b=this.getColumn(b),b.hidden?($(c).prop("checked",!0),this.showColumn(b.field)):($(c).prop("checked",!1),this.hideColumn(b.field)),f=!1);f&&setTimeout(function(){$().w2overlay("",{name:"searches-"+this.name});e.toolbar.uncheck("column-on-off")},
100);this.trigger($.extend(a,{phase:"after"}))}},initToolbar:function(){if("undefined"==typeof this.toolbar.render){var c=this.toolbar.items;this.toolbar.items=[];this.toolbar=$().w2toolbar($.extend(!0,{},this.toolbar,{name:this.name+"_toolbar",owner:this}));this.show.toolbarReload&&this.toolbar.items.push($.extend(!0,{},this.buttons.reload));this.show.toolbarColumns&&this.toolbar.items.push($.extend(!0,{},this.buttons.columns));(this.show.toolbarReload||this.show.toolbarColumn)&&this.toolbar.items.push({type:"break",
id:"w2ui-break0"});if(this.show.toolbarSearch){var a='<div class="w2ui-toolbar-search"><table cellpadding="0" cellspacing="0"><tr>    <td>'+this.buttons.search.html+'</td>    <td>        <input id="grid_'+this.name+'_search_all" class="w2ui-search-all"             placeholder="'+this.last.caption+'" value="'+this.last.search+"\"            onkeydown=\"if (event.keyCode == 13 && w2utils.isIE) this.onchange();\"            onchange=\"                var val = this.value;                 var fld = $(this).data('w2field');                 var dat = $(this).data('selected');                 if (fld) val = fld.clean(val);                if (dat != null && $.isPlainObject(dat)) val = dat.id;                w2ui['"+
this.name+"'].search(w2ui['"+this.name+'\'].last.field, val);             ">    </td>    <td>        <div title="'+w2utils.lang("Clear Search")+'" class="w2ui-search-clear" id="grid_'+this.name+'_searchClear"               onclick="var obj = w2ui[\''+this.name+"']; obj.searchReset();\"         >&nbsp;&nbsp;</div>    </td></tr></table></div>";this.toolbar.items.push({type:"html",id:"w2ui-search",html:a});this.multiSearch&&0<this.searches.length&&this.toolbar.items.push($.extend(!0,{},this.buttons["search-go"]))}this.show.toolbarSearch&&
(this.show.toolbarAdd||this.show.toolbarEdit||this.show.toolbarDelete||this.show.toolbarSave)&&this.toolbar.items.push({type:"break",id:"w2ui-break1"});this.show.toolbarAdd&&this.toolbar.items.push($.extend(!0,{},this.buttons.add));this.show.toolbarEdit&&this.toolbar.items.push($.extend(!0,{},this.buttons.edit));this.show.toolbarDelete&&this.toolbar.items.push($.extend(!0,{},this.buttons["delete"]));this.show.toolbarSave&&((this.show.toolbarAdd||this.show.toolbarDelete||this.show.toolbarEdit)&&this.toolbar.items.push({type:"break",
id:"w2ui-break2"}),this.toolbar.items.push($.extend(!0,{},this.buttons.save)));for(var b in c)this.toolbar.items.push(c[b]);var e=this;this.toolbar.on("click",function(a){var b=e.trigger({phase:"before",type:"toolbar",target:a.target,originalEvent:a});if(!0!==b.isCancelled){var c=a.target;switch(c){case "w2ui-reload":a=e.trigger({phase:"before",type:"reload",target:e.name});if(!0===a.isCancelled)return!1;e.reload();e.trigger($.extend(a,{phase:"after"}));break;case "w2ui-column-on-off":e.initColumnOnOff();
e.initResize();e.resize();break;case "w2ui-search-advanced":var d=this;if(this.get(c).checked)e.searchClose(),setTimeout(function(){d.uncheck(c)},1);else{var l=function(){!0!==$("#w2ui-overlay-searches-"+e.name).data("keepOpen")&&(d.uncheck(c),$(document).off("click","body",l))};e.searchOpen();a.originalEvent.stopPropagation();$(document).on("click","body",l)}break;case "w2ui-add":b=e.trigger({phase:"before",target:e.name,type:"add",recid:null});e.trigger($.extend(b,{phase:"after"}));break;case "w2ui-edit":b=
e.getSelection();a=null;1==b.length&&(a=b[0]);b=e.trigger({phase:"before",target:e.name,type:"edit",recid:a});e.trigger($.extend(b,{phase:"after"}));break;case "w2ui-delete":e["delete"]();break;case "w2ui-save":e.save()}e.trigger($.extend(b,{phase:"after"}))}})}},initResize:function(){var c=this;$(this.box).find(".w2ui-resizer").off("click").on("click",function(a){a.stopPropagation?a.stopPropagation():a.cancelBubble=!0;a.preventDefault&&a.preventDefault()}).off("mousedown").on("mousedown",function(a){a||
(a=window.event);window.addEventListener||window.document.attachEvent("onselectstart",function(){return!1});c.resizing=!0;c.last.tmp={x:a.screenX,y:a.screenY,gx:a.screenX,gy:a.screenY,col:parseInt($(this).attr("name"))};a.stopPropagation?a.stopPropagation():a.cancelBubble=!0;a.preventDefault&&a.preventDefault();for(var b in c.columns)c.columns[b].hidden||("undefined"==typeof c.columns[b].sizeOriginal&&(c.columns[b].sizeOriginal=c.columns[b].size),c.columns[b].size=c.columns[b].sizeCalculated);var e=
{phase:"before",type:"columnResize",target:c.name,column:c.last.tmp.col,field:c.columns[c.last.tmp.col].field},e=c.trigger($.extend(e,{resizeBy:0,originalEvent:a}));$(document).on("mousemove","body",function(a){1==c.resizing&&(a||(a=window.event),e=c.trigger($.extend(e,{resizeBy:a.screenX-c.last.tmp.gx,originalEvent:a})),!0===e.isCancelled?e.isCancelled=!1:(c.last.tmp.x=a.screenX-c.last.tmp.x,c.last.tmp.y=a.screenY-c.last.tmp.y,c.columns[c.last.tmp.col].size=parseInt(c.columns[c.last.tmp.col].size)+
c.last.tmp.x+"px",c.resizeRecords(),c.last.tmp.x=a.screenX,c.last.tmp.y=a.screenY))});$(document).on("mouseup","body",function(a){delete c.resizing;$(document).off("mousemove","body");$(document).off("mouseup","body");c.resizeRecords();c.trigger($.extend(e,{phase:"after",originalEvent:a}))})}).each(function(a,b){var c=$(b).parent();$(b).css({height:"25px","margin-left":c.width()-3+"px"})})},resizeBoxes:function(){$(this.box).find("> div");var c=$("#grid_"+this.name+"_header"),a=$("#grid_"+this.name+
"_toolbar"),b=$("#grid_"+this.name+"_summary"),e=$("#grid_"+this.name+"_footer"),f=$("#grid_"+this.name+"_body");$("#grid_"+this.name+"_columns");$("#grid_"+this.name+"_records");this.show.header&&c.css({top:"0px",left:"0px",right:"0px"});this.show.toolbar&&a.css({top:0+(this.show.header?w2utils.getSize(c,"height"):0)+"px",left:"0px",right:"0px"});this.show.footer&&e.css({bottom:"0px",left:"0px",right:"0px"});0<this.summary.length&&b.css({bottom:0+(this.show.footer?w2utils.getSize(e,"height"):0)+
"px",left:"0px",right:"0px"});f.css({top:0+(this.show.header?w2utils.getSize(c,"height"):0)+(this.show.toolbar?w2utils.getSize(a,"height"):0)+"px",bottom:0+(this.show.footer?w2utils.getSize(e,"height"):0)+(0<this.summary.length?w2utils.getSize(b,"height"):0)+"px",left:"0px",right:"0px"})},resizeRecords:function(){var c=this;$(this.box).find(".w2ui-empty-record").remove();var a=$(this.box),b=$(this.box).find("> div"),e=$("#grid_"+this.name+"_header"),f=$("#grid_"+this.name+"_toolbar"),d=$("#grid_"+
this.name+"_summary"),k=$("#grid_"+this.name+"_footer"),h=$("#grid_"+this.name+"_body"),l=$("#grid_"+this.name+"_columns"),m=$("#grid_"+this.name+"_records");if(this.fixedBody)n=b.height()-(this.show.header?w2utils.getSize(e,"height"):0)-(this.show.toolbar?w2utils.getSize(f,"height"):0)-("none"!=d.css("display")?w2utils.getSize(d,"height"):0)-(this.show.footer?w2utils.getSize(k,"height"):0),h.css("height",n);else{var n=w2utils.getSize(l,"height")+w2utils.getSize($("#grid_"+c.name+"_records table"),
"height");c.height=n+w2utils.getSize(b,"+height")+(c.show.header?w2utils.getSize(e,"height"):0)+(c.show.toolbar?w2utils.getSize(f,"height"):0)+("none"!=d.css("display")?w2utils.getSize(d,"height"):0)+(c.show.footer?w2utils.getSize(k,"height"):0);b.css("height",c.height);h.css("height",n);a.css("height",w2utils.getSize(b,"height")+w2utils.getSize(a,"+height"))}a=this.records.length;0==this.searchData.length||this.url||(a=this.last.searchIds.length);b=e=!1;h.width()<$(m).find(">table").width()&&(e=
!0);h.height()-l.height()<$(m).find(">table").height()+(e?w2utils.scrollBarSize():0)&&(b=!0);this.fixedBody||(b=!1);e||b?(l.find("> table > tbody > tr:nth-child(1) td.w2ui-head-last").css("width",w2utils.scrollBarSize()).show(),m.css({top:(0<this.columnGroups.length&&this.show.columns?1:0)+w2utils.getSize(l,"height")+"px","-webkit-overflow-scrolling":"touch","overflow-x":e?"auto":"hidden","overflow-y":b?"auto":"hidden"})):(l.find("> table > tbody > tr:nth-child(1) td.w2ui-head-last").hide(),m.css({top:(0<
this.columnGroups.length&&this.show.columns?1:0)+w2utils.getSize(l,"height")+"px",overflow:"hidden"}),0<m.length&&(this.last.scrollTop=0,this.last.scrollLeft=0));if(this.show.emptyRecords&&!b&&(e=Math.floor(m.height()/this.recordHeight)+1,this.fixedBody))for(f=a;f<=e;f++){k="";k+='<tr class="'+(f%2?"w2ui-even":"w2ui-odd")+' w2ui-empty-record" style="height: '+this.recordHeight+'px">';this.show.lineNumbers&&(k+='<td class="w2ui-col-number"></td>');this.show.selectColumn&&(k+='<td class="w2ui-grid-data w2ui-col-select"></td>');
this.show.expandColumn&&(k+='<td class="w2ui-grid-data w2ui-col-expand"></td>');for(n=0;0<this.columns.length;){a=this.columns[n];if(a.hidden)if(n++,"undefined"==typeof this.columns[n])break;else continue;k+='<td class="w2ui-grid-data" '+("undefined"!=typeof a.attr?a.attr:"")+' col="'+n+'"></td>';n++;if("undefined"==typeof this.columns[n])break}k+='<td class="w2ui-grid-data-last"></td>';k+="</tr>";$("#grid_"+this.name+"_records > table").append(k)}if(0<h.length){for(var p=b=parseInt(h.width())-(b?
w2utils.scrollBarSize():0)-(this.show.lineNumbers?34:0)-(this.show.selectColumn?26:0)-(this.show.expandColumn?26:0),r=0,e=!1,h=0;h<this.columns.length;h++)a=this.columns[h],0<a.gridMinWidth&&(a.gridMinWidth>p&&!0!==a.hidden&&(e=a.hidden=!0),a.gridMinWidth<p&&!0===a.hidden&&(a.hidden=!1,e=!0));if(!0===e){this.refresh();return}for(h=0;h<this.columns.length;h++)a=this.columns[h],a.hidden||("px"==String(a.size).substr(String(a.size).length-2).toLowerCase()?(b-=parseFloat(a.size),this.columns[h].sizeCalculated=
a.size,this.columns[h].sizeType="px"):(r+=parseFloat(a.size),this.columns[h].sizeType="%",delete a.sizeCorrected));if(100!=r&&0<r)for(h=0;h<this.columns.length;h++)a=this.columns[h],a.hidden||"%"!=a.sizeType||(a.sizeCorrected=Math.round(1E4*parseFloat(a.size)/r)/100+"%");for(h=0;h<this.columns.length;h++)a=this.columns[h],a.hidden||"%"!=a.sizeType||(this.columns[h].sizeCalculated="undefined"!=typeof this.columns[h].sizeCorrected?Math.floor(b*parseFloat(a.sizeCorrected)/100)-1+"px":Math.floor(b*parseFloat(a.size)/
100)-1+"px")}for(h=b=0;h<this.columns.length;h++)a=this.columns[h],a.hidden||("undefined"==typeof a.min&&(a.min=20),parseInt(a.sizeCalculated)<parseInt(a.min)&&(a.sizeCalculated=a.min+"px"),parseInt(a.sizeCalculated)>parseInt(a.max)&&(a.sizeCalculated=a.max+"px"),b+=parseInt(a.sizeCalculated));var u=parseInt(p)-parseInt(b);if(0<u&&0<r)for(h=0;;)if(a=this.columns[h],"undefined"==typeof a)h=0;else{if(!a.hidden&&"px"!=a.sizeType&&(a.sizeCalculated=parseInt(a.sizeCalculated)+1+"px",u--,0==u))break;h++}else 0<
u&&l.find("> table > tbody > tr:nth-child(1) td.w2ui-head-last").css("width",w2utils.scrollBarSize()).show();l.find("> table > tbody > tr:nth-child(1) td").each(function(a,b){var e=$(b).attr("col");"undefined"!=typeof e&&c.columns[e]&&$(b).css("width",c.columns[e].sizeCalculated);$(b).hasClass("w2ui-head-last")&&$(b).css("width",w2utils.scrollBarSize()+(0<u&&0==r?u:0)+"px")});3==l.find("> table > tbody > tr").length&&l.find("> table > tbody > tr:nth-child(1) td").html("").css({height:"0px",border:"0px",
padding:"0px",margin:"0px"});m.find("> table > tbody > tr:nth-child(1) td").each(function(a,b){var e=$(b).attr("col");"undefined"!=typeof e&&c.columns[e]&&$(b).css("width",c.columns[e].sizeCalculated);$(b).hasClass("w2ui-grid-data-last")&&$(b).css("width",(0<u&&0==r?u:0)+"px")});d.find("> table > tbody > tr:nth-child(1) td").each(function(a,b){var e=$(b).attr("col");"undefined"!=typeof e&&c.columns[e]&&$(b).css("width",c.columns[e].sizeCalculated);$(b).hasClass("w2ui-grid-data-last")&&$(b).css("width",
w2utils.scrollBarSize()+(0<u&&0==r?u:0)+"px")});this.initResize();this.refreshRanges();(this.last.scrollTop||this.last.scrollLeft)&&0<m.length&&(l.prop("scrollLeft",this.last.scrollLeft),m.prop("scrollTop",this.last.scrollTop),m.prop("scrollLeft",this.last.scrollLeft))},getSearchesHTML:function(){for(var c='<table cellspacing="0">',a=!1,b=0;b<this.searches.length;b++){var e=this.searches[b];e.type=String(e.type).toLowerCase();if(!e.hidden){var f="";0==a&&(f='<button class="btn close-btn" onclick="obj = w2ui[\''+
this.name+"']; if (obj) { obj.searchClose(); }\">X</button",a=!0);"undefined"==typeof e.inTag&&(e.inTag="");"undefined"==typeof e.outTag&&(e.outTag="");"undefined"==typeof e.type&&(e.type="text");if(-1!=["text","alphanumeric","combo"].indexOf(e.type))var d='<select id="grid_'+this.name+"_operator_"+b+'" onclick="event.stopPropagation();">    <option value="is">'+w2utils.lang("is")+'</option>    <option value="begins">'+w2utils.lang("begins")+'</option>    <option value="contains">'+w2utils.lang("contains")+
'</option>    <option value="ends">'+w2utils.lang("ends")+"</option></select>";-1!="int float money currency percent date time".split(" ").indexOf(e.type)&&(d='<select id="grid_'+this.name+"_operator_"+b+'"         onchange="w2ui[\''+this.name+"'].initOperator(this, "+b+');" onclick="event.stopPropagation();">    <option value="is">'+w2utils.lang("is")+"</option>"+(-1!=["int"].indexOf(e.type)?'<option value="in">'+w2utils.lang("in")+"</option>":"")+(-1!=["int"].indexOf(e.type)?'<option value="not in">'+
w2utils.lang("not in")+"</option>":"")+'<option value="between">'+w2utils.lang("between")+"</option></select>");-1!=["select","list","hex"].indexOf(e.type)&&(d='<select id="grid_'+this.name+"_operator_"+b+'" onclick="event.stopPropagation();">    <option value="is">'+w2utils.lang("is")+"</option></select>");-1!=["enum"].indexOf(e.type)&&(d='<select id="grid_'+this.name+"_operator_"+b+'" onclick="event.stopPropagation();">    <option value="in">'+w2utils.lang("in")+'</option>    <option value="not in">'+
w2utils.lang("not in")+"</option></select>");c+='<tr>    <td class="close-btn">'+f+'</td>    <td class="caption">'+e.caption+'</td>    <td class="operator">'+d+'</td>    <td class="value">';switch(e.type){case "text":case "alphanumeric":case "hex":case "list":case "combo":case "enum":c+='<input rel="search" type="text" style="width: 300px;" id="grid_'+this.name+"_field_"+b+'" name="'+e.field+'" '+e.inTag+">";break;case "int":case "float":case "money":case "currency":case "percent":case "date":case "time":c+=
'<input rel="search" type="text" size="12" id="grid_'+this.name+"_field_"+b+'" name="'+e.field+'" '+e.inTag+'><span id="grid_'+this.name+"_range_"+b+'" style="display: none">&nbsp;-&nbsp;&nbsp;<input rel="search" type="text" style="width: 90px" id="grid_'+this.name+"_field2_"+b+'" name="'+e.field+'" '+e.inTag+"></span>";break;case "select":c+='<select rel="search" id="grid_'+this.name+"_field_"+b+'" name="'+e.field+'" '+e.inTag+'  onclick="event.stopPropagation();"></select>'}c+=e.outTag+"    </td></tr>"}}return c+=
'<tr>    <td colspan="4" class="actions">        <div>        <button class="btn" onclick="obj = w2ui[\''+this.name+"']; if (obj) { obj.searchReset(); }\">"+w2utils.lang("Reset")+'</button>        <button class="btn btn-blue" onclick="obj = w2ui[\''+this.name+"']; if (obj) { obj.search(); }\">"+w2utils.lang("Search")+"</button>        </div>    </td></tr></table>"},initOperator:function(c,a){var b=this.searches[a],e=$("#grid_"+this.name+"_range_"+a),f=$("#grid_"+this.name+"_field_"+a),d=f.parent().find("span input");
"in"==$(c).val()||"not in"==$(c).val()?f.w2field("clear"):f.w2field(b.type);"between"==$(c).val()?(e.show(),d.w2field(b.type)):e.hide()},initSearches:function(){var c=this,a;for(a in this.searches){var b=this.searches[a],e=this.getSearchData(b.field);b.type=String(b.type).toLowerCase();"object"!=typeof b.options&&(b.options={});switch(b.type){case "text":case "alphanumeric":$("#grid_"+this.name+"_operator_"+a).val("begins");-1!=["alphanumeric","hex"].indexOf(b.type)&&$("#grid_"+this.name+"_field_"+
a).w2field(b.type,b.options);break;case "int":case "float":case "money":case "currency":case "percent":case "date":case "time":if(e&&"int"==e.type&&-1!=["in","not in"].indexOf(e.operator))break;$("#grid_"+this.name+"_field_"+a).w2field(b.type,b.options);$("#grid_"+this.name+"_field2_"+a).w2field(b.type,b.options);setTimeout(function(){$("#grid_"+c.name+"_field_"+a).keydown();$("#grid_"+c.name+"_field2_"+a).keydown()},1);break;case "list":case "combo":case "enum":var f=b.options;"list"==b.type&&(f.selected=
{});"enum"==b.type&&(f.selected=[]);e&&(f.selected=e.value);$("#grid_"+this.name+"_field_"+a).w2field(b.type,f);"combo"==b.type&&$("#grid_"+this.name+"_operator_"+a).val("begins");break;case "select":var f='<option value="">--</option>',d;for(d in b.options.items){var k=b.options.items[d];if($.isPlainObject(b.options.items[d])){var h=k.id,l=k.text;"undefined"==typeof h&&"undefined"!=typeof k.value&&(h=k.value);"undefined"==typeof l&&"undefined"!=typeof k.caption&&(l=k.caption);null==h&&(h="");f+=
'<option value="'+h+'">'+l+"</option>"}else f+='<option value="'+k+'">'+k+"</option>"}$("#grid_"+this.name+"_field_"+a).html(f)}null!=e&&("int"==e.type&&-1!=["in","not in"].indexOf(e.operator)&&$("#grid_"+this.name+"_field_"+a).w2field("clear").val(e.value),$("#grid_"+this.name+"_operator_"+a).val(e.operator).trigger("change"),$.isArray(e.value)?-1!=["in","not in"].indexOf(e.operator)?$("#grid_"+this.name+"_field_"+a).val(e.value).trigger("change"):($("#grid_"+this.name+"_field_"+a).val(e.value[0]).trigger("change"),
$("#grid_"+this.name+"_field2_"+a).val(e.value[1]).trigger("change")):"udefined"!=typeof e.value&&$("#grid_"+this.name+"_field_"+a).val(e.value).trigger("change"))}$("#w2ui-overlay-searches-"+this.name+" .w2ui-grid-searches *[rel=search]").on("keypress",function(a){13==a.keyCode&&(c.search(),$().w2overlay())})},getColumnsHTML:function(){function c(){var a="<tr>";""!=b.columnGroups[b.columnGroups.length-1].caption&&b.columnGroups.push({caption:""});b.show.lineNumbers&&(a+='<td class="w2ui-head w2ui-col-number">    <div>&nbsp;</div></td>');
b.show.selectColumn&&(a+='<td class="w2ui-head w2ui-col-select">    <div>&nbsp;</div></td>');b.show.expandColumn&&(a+='<td class="w2ui-head w2ui-col-expand">    <div>&nbsp;</div></td>');for(var c=0,e=0;e<b.columnGroups.length;e++){var d=b.columnGroups[e],l=b.columns[c];if("undefined"==typeof d.span||d.span!=parseInt(d.span))d.span=1;"undefined"!=typeof d.colspan&&(d.span=d.colspan);if(!0===d.master){var m="",n;for(n in b.sortData)b.sortData[n].field==l.field&&(/asc/i.test(b.sortData[n].direction)&&
(m="w2ui-sort-up"),/desc/i.test(b.sortData[n].direction)&&(m="w2ui-sort-down"));var p="";!1!==l.resizable&&(p='<div class="w2ui-resizer" name="'+c+'"></div>');a+='<td class="w2ui-head '+m+'" col="'+c+'" rowspan="2" colspan="'+(d.span+(e==b.columnGroups.length-1?1:0))+'"     onclick="w2ui[\''+b.name+"'].columnClick('"+l.field+"', event);\">"+p+'    <div class="w2ui-col-group w2ui-col-header '+(m?"w2ui-col-sorted":"")+'">        <div class="'+m+'"></div>'+(l.caption?l.caption:"&nbsp;")+"    </div></td>"}else a+=
'<td class="w2ui-head" col="'+c+'"         colspan="'+(d.span+(e==b.columnGroups.length-1?1:0))+'">    <div class="w2ui-col-group">'+(d.caption?d.caption:"&nbsp;")+"    </div></td>";c+=d.span}return a+"</tr>"}function a(a){var c="<tr>",e=!b.reorderColumns||b.columnGroups&&b.columnGroups.length?"":" w2ui-reorder-cols-head ";b.show.lineNumbers&&(c+='<td class="w2ui-head w2ui-col-number" onclick="w2ui[\''+b.name+"'].columnClick('line-number', event);\">    <div>#</div></td>");b.show.selectColumn&&(c+=
'<td class="w2ui-head w2ui-col-select"         onclick="if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true;">    <div>        <input type="checkbox" id="grid_'+b.name+'_check_all" tabIndex="-1"            style="'+(0==b.multiSelect?"display: none;":"")+'"            onclick="if (this.checked) w2ui[\''+b.name+"'].selectAll();                      else w2ui['"+b.name+"'].selectNone();                      if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true;\">    </div></td>");
b.show.expandColumn&&(c+='<td class="w2ui-head w2ui-col-expand">    <div>&nbsp;</div></td>');for(var d=0,l=0,m=0;m<b.columns.length;m++){var n=b.columns[m],p={};m==l&&(l+="undefined"!=typeof b.columnGroups[d]?parseInt(b.columnGroups[d].span):0,d++);"undefined"!=typeof b.columnGroups[d-1]&&(p=b.columnGroups[d-1]);if(!n.hidden){var r="",u;for(u in b.sortData)b.sortData[u].field==n.field&&(/asc/i.test(b.sortData[u].direction)&&(r="w2ui-sort-up"),/desc/i.test(b.sortData[u].direction)&&(r="w2ui-sort-down"));
if(!0!==p.master||a)p="",!1!==n.resizable&&(p='<div class="w2ui-resizer" name="'+m+'"></div>'),c+='<td col="'+m+'" class="w2ui-head '+r+e+'"     onclick="w2ui[\''+b.name+"'].columnClick('"+n.field+"', event);\">"+p+'    <div class="w2ui-col-header '+(r?"w2ui-col-sorted":"")+'">        <div class="'+r+'"></div>'+(n.caption?n.caption:"&nbsp;")+"    </div></td>"}}return c+='<td class="w2ui-head w2ui-head-last"><div>&nbsp;</div></td></tr>'}var b=this,e="";this.show.columnHeaders&&(e=0<this.columnGroups.length?
a(!0)+c()+a(!1):a(!0));return e},getRecordsHTML:function(){var c=this.records.length;0==this.searchData.length||this.url||(c=this.last.searchIds.length);this.show_extra=300<c?30:300;var a=$("#grid_"+this.name+"_records"),a=Math.floor(a.height()/this.recordHeight)+this.show_extra+1;if(!this.fixedBody||a>c)a=c;for(var b="<table>"+this.getRecordHTML(-1,0),b=b+('<tr id="grid_'+this.name+'_rec_top" line="top" style="height: 0px">    <td colspan="200"></td></tr>'),e=0;e<a;e++)b+=this.getRecordHTML(e,e+
1);b+='<tr id="grid_'+this.name+'_rec_bottom" line="bottom" style="height: '+(c-a)*this.recordHeight+'px">    <td colspan="200"></td></tr><tr id="grid_'+this.name+'_rec_more" style="display: none">    <td colspan="200" class="w2ui-load-more"></td></tr></table>';this.last.range_start=0;this.last.range_end=a;return b},getSummaryHTML:function(){if(0!=this.summary.length){for(var c="<table>",a=0;a<this.summary.length;a++)c+=this.getRecordHTML(a,a+1,!0);return c+"</table>"}},scroll:function(c){function a(){!1!==
b.markSearch&&(clearTimeout(b.last.marker_timer),b.last.marker_timer=setTimeout(function(){var a=[],c;for(c in b.searchData){var e=b.searchData[c];-1==$.inArray(e.value,a)&&a.push(e.value)}0<a.length&&$(b.box).find(".w2ui-grid-data > div").w2marker(a)},50))}(new Date).getTime();var b=this,e=$("#grid_"+this.name+"_records");c=this.records.length;0==this.searchData.length||this.url||(c=this.last.searchIds.length);if(0!=c&&0!=e.length&&0!=e.height())if(this.show_extra=300<c?30:300,e.height()<c*this.recordHeight&&
"hidden"==e.css("overflow-y"))0<this.total&&this.refresh();else{var f=Math.round(e[0].scrollTop/this.recordHeight+1),d=f+(Math.round(e.height()/this.recordHeight)-1);f>c&&(f=c);d>c&&(d=c);var k="object"!=typeof this.url?this.url:this.url.get;$("#grid_"+this.name+"_footer .w2ui-footer-right").html(w2utils.formatNumber(this.offset+f)+"-"+w2utils.formatNumber(this.offset+d)+" "+w2utils.lang("of")+" "+w2utils.formatNumber(this.total)+(k?" ("+w2utils.lang("buffered")+" "+w2utils.formatNumber(c)+(0<this.offset?
", skip "+w2utils.formatNumber(this.offset):"")+")":""));if(k||this.fixedBody&&!(300>=this.total)){f=Math.floor(e[0].scrollTop/this.recordHeight)-this.show_extra;d=f+Math.floor(e.height()/this.recordHeight)+2*this.show_extra+1;1>f&&(f=1);d>this.total&&(d=this.total);var k=e.find("#grid_"+this.name+"_rec_top"),h=e.find("#grid_"+this.name+"_rec_bottom");-1!=String(k.next().prop("id")).indexOf("_expanded_row")&&k.next().remove();this.total>d&&-1!=String(h.prev().prop("id")).indexOf("_expanded_row")&&
h.prev().remove();var l=parseInt(k.next().attr("line")),m=parseInt(h.prev().attr("line"));if(l<f||1==l||this.last.pull_refresh){if(d<=m+this.show_extra-2&&d!=this.total)return;for(this.last.pull_refresh=!1;;){l=e.find("#grid_"+this.name+"_rec_top").next();if("bottom"==l.attr("line"))break;if(parseInt(l.attr("line"))<f)l.remove();else break}l=e.find("#grid_"+this.name+"_rec_bottom").prev();l=l.attr("line");"top"==l&&(l=f);for(l=parseInt(l)+1;l<=d;l++)this.records[l-1]&&(!0===this.records[l-1].expanded&&
(this.records[l-1].expanded=!1),h.before(this.getRecordHTML(l-1,l)))}else{if(f>=l-this.show_extra+2&&1<f)return;for(;;){l=e.find("#grid_"+this.name+"_rec_bottom").prev();if("top"==l.attr("line"))break;if(parseInt(l.attr("line"))>d)l.remove();else break}l=e.find("#grid_"+this.name+"_rec_top").next();l=l.attr("line");"bottom"==l&&(l=d);for(l=parseInt(l)-1;l>=f;l--)this.records[l-1]&&(!0===this.records[l-1].expanded&&(this.records[l-1].expanded=!1),k.after(this.getRecordHTML(l-1,l)))}a();setTimeout(function(){b.refreshRanges()},
0);l=(f-1)*b.recordHeight;m=(c-d)*b.recordHeight;0>m&&(m=0);k.css("height",l+"px");h.css("height",m+"px");b.last.range_start=f;b.last.range_end=d;if(Math.floor(e[0].scrollTop/this.recordHeight)+Math.floor(e.height()/this.recordHeight)+10>c&&!0!==this.last.pull_more&&c<this.total-this.offset)if(!0===this.autoLoad)this.last.pull_more=!0,this.last.xhr_offset+=this.limit,this.request("get-records");else{e=$("#grid_"+this.name+"_rec_more");if("none"==e.css("display"))e.show().on("click",function(){b.last.pull_more=
!0;b.last.xhr_offset+=b.limit;b.request("get-records");$(this).find("td").html('<div><div style="width: 20px; height: 20px;" class="w2ui-spinner"></div></div>')});-1==e.find("td").text().indexOf("Load")&&e.find("td").html("<div>"+w2utils.lang("Load")+" "+b.limit+" "+w2utils.lang("More")+"...</div>")}c>=this.total-this.offset&&$("#grid_"+this.name+"_rec_more").hide()}}},getRecordHTML:function(c,a,b){var e="",f=this.last.selection,d;if(-1==c){e+='<tr line="0">';this.show.lineNumbers&&(e+='<td class="w2ui-col-number" style="height: 0px;"></td>');
this.show.selectColumn&&(e+='<td class="w2ui-col-select" style="height: 0px;"></td>');this.show.expandColumn&&(e+='<td class="w2ui-col-expand" style="height: 0px;"></td>');for(d in this.columns)this.columns[d].hidden||(e+='<td class="w2ui-grid-data" col="'+d+'" style="height: 0px;"></td>');return e+='<td class="w2ui-grid-data-last" style="height: 0px;"></td></tr>'}d="object"!=typeof this.url?this.url:this.url.get;if(!0!==b){if(0<this.searchData.length&&!d){if(c>=this.last.searchIds.length)return"";
c=this.last.searchIds[c]}else if(c>=this.records.length)return"";d=this.records[c]}else{if(c>=this.summary.length)return"";d=this.summary[c]}if(!d)return"";w2utils.escapeId(d.recid);var k=!1;-1!=f.indexes.indexOf(c)&&(k=!0);e+='<tr id="grid_'+this.name+"_rec_"+d.recid+'" recid="'+d.recid+'" line="'+a+'"  class="'+(0==a%2?"w2ui-even":"w2ui-odd")+(k&&"row"==this.selectType?" w2ui-selected":"")+(!1===d.editable?" w2ui-no-edit":"")+(!0===d.expanded?" w2ui-expanded":"")+'" '+(!0!==b?w2utils.isIOS?"    onclick  = \"w2ui['"+
this.name+"'].dblClick('"+d.recid+"', event);\"":"    onclick  = \"w2ui['"+this.name+"'].click('"+d.recid+"', event);\"    oncontextmenu = \"w2ui['"+this.name+"'].contextMenu('"+d.recid+"', event);\"":"")+' style="height: '+this.recordHeight+"px; "+(k||"string"!=typeof d.style?"":d.style)+'" '+("string"==typeof d.style?'custom_style="'+d.style+'"':"")+">";this.show.lineNumbers&&(e+='<td id="grid_'+this.name+"_cell_"+c+"_number"+(b?"_s":"")+'" class="w2ui-col-number">'+(!0!==b?"<div>"+a+"</div>":"")+
"</td>");this.show.selectColumn&&(e+='<td id="grid_'+this.name+"_cell_"+c+"_select"+(b?"_s":"")+'" class="w2ui-grid-data w2ui-col-select"         onclick="if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true;">'+(!0!==b?'    <div>        <input class="w2ui-grid-select-check" type="checkbox" tabIndex="-1"            '+(k?'checked="checked"':"")+"            onclick=\"var obj = w2ui['"+this.name+"'];                 if (!obj.multiSelect) { obj.selectNone(); }                if (this.checked) obj.select('"+
d.recid+"'); else obj.unselect('"+d.recid+"');                 if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true;\">    </div>":"")+"</td>");this.show.expandColumn&&(a="",a=!0===d.expanded?"-":"+","none"==d.expanded&&(a=""),"spinner"==d.expanded&&(a='<div class="w2ui-spinner" style="width: 16px; margin: -2px 2px;"></div>'),e+='<td id="grid_'+this.name+"_cell_"+c+"_expand"+(b?"_s":"")+'" class="w2ui-grid-data w2ui-col-expand">'+(!0!==b?'    <div ondblclick="if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true;"             onclick="w2ui[\''+
this.name+"'].toggle('"+d.recid+"', event);                 if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true;\">        "+a+" </div>":"")+"</td>");for(a=0;;){var h=this.columns[a];if(h.hidden)if(a++,"undefined"==typeof this.columns[a])break;else continue;var l=!b&&d.changes&&"undefined"!=typeof d.changes[h.field],m=this.getCellHTML(c,a,b),n="";if("string"==typeof h.render){var p=h.render.toLowerCase().split(":");-1!="number int float money currency percent".split(" ").indexOf(p[0])&&
(n+="text-align: right;")}"object"==typeof d.style&&"string"==typeof d.style[a]&&(n+=d.style[a]+";");p=!1;k&&-1!=$.inArray(a,f.columns[c])&&(p=!0);e+='<td class="w2ui-grid-data'+(p?" w2ui-selected":"")+(l?" w2ui-changed":"")+'" col="'+a+'"     style="'+n+("undefined"!=typeof h.style?h.style:"")+'" '+("undefined"!=typeof h.attr?h.attr:"")+">"+m+"</td>";a++;if("undefined"==typeof this.columns[a])break}e+='<td class="w2ui-grid-data-last"></td>';return e+="</tr>"},getCellHTML:function(c,a,b){var e=this.columns[a],
d=!0!==b?this.records[c]:this.summary[c],g=this.getCellValue(c,a,b),k=e.editable;if(null!=e.render){if("function"==typeof e.render&&(g=$.trim(e.render.call(this,d,c,a)),4>g.length||"<div"!=g.substr(0,4).toLowerCase())&&(g="<div>"+g+"</div>"),"object"==typeof e.render&&(g="<div>"+(e.render[g]||"")+"</div>"),"string"==typeof e.render){c=e.render.toLowerCase().split(":");e=a="";-1!="number int float money currency percent".split(" ").indexOf(c[0])&&("undefined"!=typeof c[1]&&w2utils.isInt(c[1])||(c[1]=
0),20<c[1]&&(c[1]=20),0>c[1]&&(c[1]=0),-1!=["money","currency"].indexOf(c[0])&&(c[1]=w2utils.settings.currencyPrecision,a=w2utils.settings.currencyPrefix,e=w2utils.settings.currencySuffix),"percent"==c[0]&&(e="%","0"!==c[1]&&(c[1]=1)),"int"==c[0]&&(c[1]=0),g="<div>"+(""!==g?a+w2utils.formatNumber(Number(g).toFixed(c[1]))+e:"")+"</div>");if("time"==c[0]){if("undefined"==typeof c[1]||""==c[1])c[1]=w2utils.settings.time_format;g="<div>"+a+w2utils.formatTime(g,"h12"==c[1]?"hh:mi pm":"h24:min")+e+"</div>"}if("date"==
c[0]){if("undefined"==typeof c[1]||""==c[1])c[1]=w2utils.settings.date_display;g="<div>"+a+w2utils.formatDate(g,c[1])+e+"</div>"}"age"==c[0]&&(g="<div>"+a+w2utils.age(g)+e+"</div>");"toggle"==c[0]&&(g="<div>"+a+(g?"Yes":"")+e+"</div>")}}else{var h="";k&&-1!=["checkbox","check"].indexOf(k.type)&&(h="text-align: center",g='<input type="checkbox" '+(g?"checked":"")+" onclick=\"    var obj = w2ui['"+this.name+"'];     obj.editChange.call(obj, this, "+(b?-(c+1):c)+", "+a+', event); ">');this.show.recordTitles?
(b=String(g).replace(/"/g,"''"),"undefined"!=typeof e.title&&("function"==typeof e.title&&(b=e.title.call(this,d,c,a)),"string"==typeof e.title&&(b=e.title)),g='<div title="'+w2utils.stripTags(b)+'" style="'+h+'">'+g+"</div>"):g='<div style="'+h+'">'+g+"</div>"}if(null==g||"undefined"==typeof g)g="";return g},getCellValue:function(c,a,b){a=this.columns[a];c=!0!==b?this.records[c]:this.summary[c];b=this.parseField(c,a.field);c.changes&&"undefined"!=typeof c.changes[a.field]&&(b=c.changes[a.field]);
if(null==b||"undefined"==typeof b)b="";return b},getFooterHTML:function(){return'<div>    <div class="w2ui-footer-left"></div>    <div class="w2ui-footer-right"></div>    <div class="w2ui-footer-center"></div></div>'},status:function(c){if("undefined"!=typeof c)$("#grid_"+this.name+"_footer").find(".w2ui-footer-left").html(c);else{c="";var a=this.getSelection();if(0<a.length){c=String(a.length).replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,")+" "+w2utils.lang("selected");var b=a[0];"object"==typeof b&&(b=
b.recid+", "+w2utils.lang("Column")+": "+b.column);1==a.length&&(c=w2utils.lang("Record ID")+": "+b+" ")}$("#grid_"+this.name+"_footer .w2ui-footer-left").html(c);1==a.length?this.toolbar.enable("w2ui-edit"):this.toolbar.disable("w2ui-edit");1<=a.length?this.toolbar.enable("w2ui-delete"):this.toolbar.disable("w2ui-delete")}},lock:function(c,a){var b=$(this.box).find("> div:first-child"),e=Array.prototype.slice.call(arguments,0);e.unshift(b);setTimeout(function(){w2utils.lock.apply(window,e)},10)},
unlock:function(){var c=this.box;setTimeout(function(){w2utils.unlock(c)},25)},stateSave:function(c){if(!localStorage)return null;var a={columns:[],show:$.extend({},this.show),last:{search:this.last.search,multi:this.last.multi,logic:this.last.logic,caption:this.last.caption,field:this.last.field,scrollTop:this.last.scrollTop,scrollLeft:this.last.scrollLeft},sortData:[],searchData:[]},b;for(b in this.columns){var e=this.columns[b];a.columns.push({field:e.field,hidden:e.hidden,size:e.size,sizeCalculated:e.sizeCalculated,
sizeOriginal:e.sizeOriginal,sizeType:e.sizeType})}for(b in this.sortData)a.sortData.push($.extend({},this.sortData[b]));for(b in this.searchData)a.searchData.push($.extend({},this.searchData[b]));if(!0!==c){c=this.trigger({phase:"before",type:"stateSave",target:this.name,state:a});if(!0===c.isCancelled){"function"==typeof callBack&&callBack({status:"error",message:"Request aborted."});return}try{var d=$.parseJSON(localStorage.w2ui||"{}");d||(d={});d.states||(d.states={});d.states[this.name]=a;localStorage.w2ui=
JSON.stringify(d)}catch(g){return delete localStorage.w2ui,null}this.trigger($.extend(c,{phase:"after"}))}return a},stateRestore:function(c){var a=this;if(!c)try{if(!localStorage)return!1;var b=$.parseJSON(localStorage.w2ui||"{}");b||(b={});b.states||(b.states={});c=b.states[this.name]}catch(d){return delete localStorage.w2ui,null}var e=this.trigger({phase:"before",type:"stateRestore",target:this.name,state:c});if(!0===e.isCancelled)"function"==typeof callBack&&callBack({status:"error",message:"Request aborted."});
else{if($.isPlainObject(c)){$.extend(this.show,c.show);$.extend(this.last,c.last);var f=this.last.scrollTop,g=this.last.scrollLeft,k;for(k in c.columns){var b=c.columns[k],h=this.getColumn(b.field);h&&$.extend(h,b)}this.sortData.splice(0,this.sortData.length);for(k in c.sortData)this.sortData.push(c.sortData[k]);this.searchData.splice(0,this.searchData.length);for(k in c.searchData)this.searchData.push(c.searchData[k]);setTimeout(function(){0<a.sortData.length&&a.localSort();0<a.searchData.length&&
a.localSearch();a.last.scrollTop=f;a.last.scrollLeft=g;a.refresh()},1)}this.trigger($.extend(e,{phase:"after"}));return!0}},stateReset:function(){this.stateRestore(this.last.state);if(localStorage)try{var c=$.parseJSON(localStorage.w2ui||"{}");c.states&&c.states[this.name]&&delete c.states[this.name];localStorage.w2ui=JSON.stringify(c)}catch(a){return delete localStorage.w2ui,null}},parseField:function(c,a){var b="";try{var b=c,e=String(a).split("."),d;for(d in e)b=b[e[d]]}catch(g){b=""}return b},
prepareData:function(){for(var c in this.records){var a=this.records[c],b;for(b in this.columns){var e=this.columns[b];if(null!=a[e.field]&&"string"==typeof e.render){-1!="number int float money currency percent".split(" ").indexOf(e.render.split(":")[0])&&"number"!=typeof a[e.field]&&(a[e.field]=parseFloat(a[e.field]));if(-1!=["date","age"].indexOf(e.render.split(":")[0])&&!a[e.field+"_"]){var d=a[e.field];w2utils.isInt(d)&&(d=parseInt(d));a[e.field+"_"]=new Date(d)}if(-1!=["time"].indexOf(e.render)){if(w2utils.isTime(a[e.field])){var g=
w2utils.isTime(a[e.field],!0),d=new Date;d.setHours(g.hours,g.minutes,g.seconds?g.seconds:0,0)}else g=a[e.field],w2utils.isInt(g)&&(g=parseInt(g)),g=null!=g?new Date(g):new Date,d=new Date,d.setHours(g.getHours(),g.getMinutes(),g.getSeconds(),0);a[e.field+"_"]||(a[e.field+"_"]=d)}}}}},nextCell:function(c,a){var b=c+1;if(this.columns.length==b)return null;if(!0===a){var e=this.columns[b].editable;if(this.columns[b].hidden||"undefined"==typeof e||e&&-1!=["checkbox","check"].indexOf(e.type))return this.nextCell(b,
a)}return b},prevCell:function(c,a){var b=c-1;if(0>b)return null;if(!0===a){var e=this.columns[b].editable;if(this.columns[b].hidden||"undefined"==typeof e||e&&-1!=["checkbox","check"].indexOf(e.type))return this.prevCell(b,a)}return b},nextRow:function(c){if(c+1<this.records.length&&0==this.last.searchIds.length||0<this.last.searchIds.length&&c<this.last.searchIds[this.last.searchIds.length-1]){c++;if(0<this.last.searchIds.length)for(;!(-1!=$.inArray(c,this.last.searchIds)||c>this.records.length);)c++;
return c}return null},prevRow:function(c){if(0<c&&0==this.last.searchIds.length||0<this.last.searchIds.length&&c>this.last.searchIds[0]){c--;if(0<this.last.searchIds.length)for(;!(-1!=$.inArray(c,this.last.searchIds)||0>c);)c--;return c}return null}};$.extend(d.prototype,w2utils.event);w2obj.grid=d})();
(function(){var d=function(a){this.name=this.box=null;this.panels=[];this.tmp={};this.padding=1;this.resizer=4;this.style="";this.onDestroy=this.onResize=this.onRefresh=this.onRender=this.onResizerClick=this.onResizing=this.onHide=this.onShow=null;$.extend(!0,this,w2obj.layout,a)},c="top left main preview right bottom".split(" ");$.fn.w2layout=function(a){function b(a,b,c){var e=a.get(b);null!==e&&"undefined"==typeof c&&(c=e.tabs);if(null===e||null===c)return!1;$.isArray(c)&&(c={tabs:c});$().w2destroy(a.name+
"_"+b+"_tabs");e.tabs=$().w2tabs($.extend({},c,{owner:a,name:a.name+"_"+b+"_tabs"}));return e.show.tabs=!0}function e(a,b,c){var e=a.get(b);null!==e&&"undefined"==typeof c&&(c=e.toolbar);if(null===e||null===c)return!1;$.isArray(c)&&(c={items:c});$().w2destroy(a.name+"_"+b+"_toolbar");e.toolbar=$().w2toolbar($.extend({},c,{owner:a,name:a.name+"_"+b+"_toolbar"}));return e.show.toolbar=!0}if("object"!==typeof a&&a){if(w2ui[$(this).attr("name")]){var f=w2ui[$(this).attr("name")];f[a].apply(f,Array.prototype.slice.call(arguments,
1));return this}console.log("ERROR: Method "+a+" does not exist on jQuery.w2layout")}else if(w2utils.checkName(a,"w2layout")){var f=a.panels||[],g=new d(a);$.extend(g,{handlers:[],panels:[]});for(var k=0,h=f.length;k<h;k++)g.panels[k]=$.extend(!0,{},d.prototype.panel,f[k]),($.isPlainObject(g.panels[k].tabs)||$.isArray(g.panels[k].tabs))&&b(g,f[k].type),($.isPlainObject(g.panels[k].toolbar)||$.isArray(g.panels[k].toolbar))&&e(g,f[k].type);for(var l in c)l=c[l],null===g.get(l)&&g.panels.push($.extend(!0,
{},d.prototype.panel,{type:l,hidden:"main"!==l,size:50}));0<$(this).length&&g.render($(this)[0]);return w2ui[g.name]=g}};d.prototype={panel:{type:null,title:"",size:100,minSize:20,maxSize:!1,hidden:!1,resizable:!1,overflow:"auto",style:"",content:"",tabs:null,toolbar:null,width:null,height:null,show:{toolbar:!1,tabs:!1},onRefresh:null,onShow:null,onHide:null},html:function(a,b,c){return this.content(a,b,c)},content:function(a,b,c){var d=this,g=this.get(a);if("css"==a)return $("#layout_"+d.name+"_panel_css").html("<style>"+
b+"</style>"),!0;if(null===g)return!1;if("undefined"==typeof b||null===b)return g.content;if(b instanceof jQuery)return console.log("ERROR: You can not pass jQuery object to w2layout.content() method"),!1;var k="#layout_"+this.name+"_panel_"+g.type,h=$(k+"> .w2ui-panel-content"),l=0;0<h.length&&($(k).scrollTop(0),l=$(h).position().top);if(""===g.content)g.content=b;else if(g.content=b,!g.hidden&&null!==c&&""!==c&&"undefined"!=typeof c){var m=$(k+"> .w2ui-panel-content");m.after('<div class="w2ui-panel-content new-panel" style="'+
m[0].style.cssText+'"></div>');var n=$(k+"> .w2ui-panel-content.new-panel");m.css("top",l);n.css("top",l);"object"==typeof b?(b.box=n[0],b.render()):n.html(b);w2utils.transition(m[0],n[0],c,function(){m.remove();n.removeClass("new-panel");n.css("overflow",g.overflow);d.resize();-1!=window.navigator.userAgent.indexOf("MSIE")&&setTimeout(function(){d.resize()},100)})}this.refresh(a);d.resize();-1!=window.navigator.userAgent.indexOf("MSIE")&&setTimeout(function(){d.resize()},100);return!0},load:function(a,
b,c,d){var g=this;return"css"==a?($.get(b,function(b,c,e){g.content(a,e.responseText);d&&d()}),!0):null!==this.get(a)?($.get(b,function(b,h,l){g.content(a,l.responseText,c);d&&d();g.resize();-1!=window.navigator.userAgent.indexOf("MSIE")&&setTimeout(function(){g.resize()},100)}),!0):!1},sizeTo:function(a,b){var c=this;if(null===c.get(a))return!1;$(c.box).find(" > div > .w2ui-panel").css({"-webkit-transition":".2s","-moz-transition":".2s","-ms-transition":".2s","-o-transition":".2s"});setTimeout(function(){c.set(a,
{size:b})},1);setTimeout(function(){$(c.box).find(" > div > .w2ui-panel").css({"-webkit-transition":"0s","-moz-transition":"0s","-ms-transition":"0s","-o-transition":"0s"});c.resize()},500);return!0},show:function(a,b){var c=this,d=this.trigger({phase:"before",type:"show",target:a,object:this.get(a),immediate:b});if(!0!==d.isCancelled){var g=c.get(a);if(null===g)return!1;g.hidden=!1;!0===b?($("#layout_"+c.name+"_panel_"+a).css({opacity:"1"}),g.resizable&&$("#layout_"+c.name+"_resizer_"+a).show(),
c.trigger($.extend(d,{phase:"after"})),c.resize()):(g.resizable&&$("#layout_"+c.name+"_resizer_"+a).show(),$("#layout_"+c.name+"_panel_"+a).css({opacity:"0"}),$(c.box).find(" > div > .w2ui-panel").css({"-webkit-transition":".2s","-moz-transition":".2s","-ms-transition":".2s","-o-transition":".2s"}),setTimeout(function(){c.resize()},1),setTimeout(function(){$("#layout_"+c.name+"_panel_"+a).css({opacity:"1"})},250),setTimeout(function(){$(c.box).find(" > div > .w2ui-panel").css({"-webkit-transition":"0s",
"-moz-transition":"0s","-ms-transition":"0s","-o-transition":"0s"});c.trigger($.extend(d,{phase:"after"}));c.resize()},500));return!0}},hide:function(a,b){var c=this,d=this.trigger({phase:"before",type:"hide",target:a,object:this.get(a),immediate:b});if(!0!==d.isCancelled){var g=c.get(a);if(null===g)return!1;g.hidden=!0;!0===b?($("#layout_"+c.name+"_panel_"+a).css({opacity:"0"}),$("#layout_"+c.name+"_resizer_"+a).hide(),c.trigger($.extend(d,{phase:"after"})),c.resize()):($("#layout_"+c.name+"_resizer_"+
a).hide(),$(c.box).find(" > div > .w2ui-panel").css({"-webkit-transition":".2s","-moz-transition":".2s","-ms-transition":".2s","-o-transition":".2s"}),$("#layout_"+c.name+"_panel_"+a).css({opacity:"0"}),setTimeout(function(){c.resize()},1),setTimeout(function(){$(c.box).find(" > div > .w2ui-panel").css({"-webkit-transition":"0s","-moz-transition":"0s","-ms-transition":"0s","-o-transition":"0s"});c.trigger($.extend(d,{phase:"after"}));c.resize()},500));return!0}},toggle:function(a,b){var c=this.get(a);
return null===c?!1:c.hidden?this.show(a,b):this.hide(a,b)},set:function(a,b){var c=this.get(a,!0);if(null===c)return!1;$.extend(this.panels[c],b);"undefined"!=typeof b.content&&this.refresh(a);this.resize();return!0},get:function(a,b){for(var c in this.panels)if(this.panels[c].type==a)return!0===b?c:this.panels[c];return null},el:function(a){a=$("#layout_"+this.name+"_panel_"+a+"> .w2ui-panel-content");return 1!=a.length?null:a[0]},hideToolbar:function(a){var b=this.get(a);b&&(b.show.toolbar=!1,$("#layout_"+
this.name+"_panel_"+a+"> .w2ui-panel-toolbar").hide(),this.resize())},showToolbar:function(a){var b=this.get(a);b&&(b.show.toolbar=!0,$("#layout_"+this.name+"_panel_"+a+"> .w2ui-panel-toolbar").show(),this.resize())},toggleToolbar:function(a){var b=this.get(a);b&&(b.show.toolbar?this.hideToolbar(a):this.showToolbar(a))},hideTabs:function(a){var b=this.get(a);b&&(b.show.tabs=!1,$("#layout_"+this.name+"_panel_"+a+"> .w2ui-panel-tabs").hide(),this.resize())},showTabs:function(a){var b=this.get(a);b&&
(b.show.tabs=!0,$("#layout_"+this.name+"_panel_"+a+"> .w2ui-panel-tabs").show(),this.resize())},toggleTabs:function(a){var b=this.get(a);b&&(b.show.tabs?this.hideTabs(a):this.showTabs(a))},render:function(a){function b(){k.tmp.events={resize:function(a){w2ui[k.name].resize()},resizeStart:e,mouseMove:g,mouseUp:d};$(window).on("resize",k.tmp.events.resize)}function e(a,b){if(k.box){b||(b=window.event);window.addEventListener||window.document.attachEvent("onselectstart",function(){return!1});$(document).off("mousemove",
k.tmp.events.mouseMove).on("mousemove",k.tmp.events.mouseMove);$(document).off("mouseup",k.tmp.events.mouseUp).on("mouseup",k.tmp.events.mouseUp);k.tmp.resize={type:a,x:b.screenX,y:b.screenY,diff_x:0,diff_y:0,value:0};for(var e in c)e=c[e],k.lock(e,{opacity:0});if("left"==a||"right"==a)k.tmp.resize.value=parseInt($("#layout_"+k.name+"_resizer_"+a)[0].style.left);if("top"==a||"preview"==a||"bottom"==a)k.tmp.resize.value=parseInt($("#layout_"+k.name+"_resizer_"+a)[0].style.top)}}function d(a){if(k.box&&
(a||(a=window.event),window.addEventListener||window.document.attachEvent("onselectstart",function(){return!1}),$(document).off("mousemove",k.tmp.events.mouseMove),$(document).off("mouseup",k.tmp.events.mouseUp),"undefined"!=typeof k.tmp.resize)){for(var b in c)k.unlock(c[b]);if(0!==k.tmp.diff_x||0!==k.tmp.resize.diff_y){a=k.get("top");b=k.get("bottom");var e=k.get(k.tmp.resize.type),f=parseInt($(k.box).height()),g=parseInt($(k.box).width()),h=String(e.size),m,l;switch(k.tmp.resize.type){case "top":m=
parseInt(e.sizeCalculated)+k.tmp.resize.diff_y;l=0;break;case "bottom":m=parseInt(e.sizeCalculated)-k.tmp.resize.diff_y;l=0;break;case "preview":m=parseInt(e.sizeCalculated)-k.tmp.resize.diff_y;l=(a&&!a.hidden?a.sizeCalculated:0)+(b&&!b.hidden?b.sizeCalculated:0);break;case "left":m=parseInt(e.sizeCalculated)+k.tmp.resize.diff_x;l=0;break;case "right":m=parseInt(e.sizeCalculated)-k.tmp.resize.diff_x,l=0}"%"==h.substr(h.length-1)?e.size=Math.floor(100*m/("left"==e.type||"right"==e.type?g:f-l)*100)/
100+"%":e.size=m;k.resize()}$("#layout_"+k.name+"_resizer_"+k.tmp.resize.type).removeClass("active");delete k.tmp.resize}}function g(a){if(k.box&&(a||(a=window.event),"undefined"!=typeof k.tmp.resize)){var b=k.get(k.tmp.resize.type),c=k.tmp.resize,e=k.trigger({phase:"before",type:"resizing",target:k.name,object:b,originalEvent:a,panel:c?c.type:"all",diff_x:c?c.diff_x:0,diff_y:c?c.diff_y:0});if(!0!==e.isCancelled){var d=$("#layout_"+k.name+"_resizer_"+c.type),f=a.screenX-c.x;a=a.screenY-c.y;var g=
k.get("main");d.hasClass("active")||d.addClass("active");switch(c.type){case "left":b.minSize-f>b.width&&(f=b.minSize-b.width);b.maxSize&&b.width+f>b.maxSize&&(f=b.maxSize-b.width);g.minSize+f>g.width&&(f=g.width-g.minSize);break;case "right":b.minSize+f>b.width&&(f=b.width-b.minSize);b.maxSize&&b.width-f>b.maxSize&&(f=b.width-b.maxSize);g.minSize-f>g.width&&(f=g.minSize-g.width);break;case "top":b.minSize-a>b.height&&(a=b.minSize-b.height);b.maxSize&&b.height+a>b.maxSize&&(a=b.maxSize-b.height);
g.minSize+a>g.height&&(a=g.height-g.minSize);break;case "preview":case "bottom":b.minSize+a>b.height&&(a=b.height-b.minSize),b.maxSize&&b.height-a>b.maxSize&&(a=b.height-b.maxSize),g.minSize-a>g.height&&(a=g.minSize-g.height)}c.diff_x=f;c.diff_y=a;switch(c.type){case "top":case "preview":case "bottom":c.diff_x=0;0<d.length&&(d[0].style.top=c.value+c.diff_y+"px");break;case "left":case "right":c.diff_y=0,0<d.length&&(d[0].style.left=c.value+c.diff_x+"px")}k.trigger($.extend(e,{phase:"after"}))}}}var k=
this,h=(new Date).getTime(),l=k.trigger({phase:"before",type:"render",target:k.name,box:a});if(!0!==l.isCancelled){"undefined"!=typeof a&&null!==a&&(0<$(k.box).find("#layout_"+k.name+"_panel_main").length&&$(k.box).removeAttr("name").removeClass("w2ui-layout").html(""),k.box=a);if(!k.box)return!1;$(k.box).attr("name",k.name).addClass("w2ui-layout").html("<div></div>");0<$(k.box).length&&($(k.box)[0].style.cssText+=k.style);for(var m in c)m=c[m],k.get(m),a='<div id="layout_'+k.name+"_panel_"+m+'" class="w2ui-panel">    <div class="w2ui-panel-title"></div>    <div class="w2ui-panel-tabs"></div>    <div class="w2ui-panel-toolbar"></div>    <div class="w2ui-panel-content"></div></div><div id="layout_'+
k.name+"_resizer_"+m+'" class="w2ui-resizer"></div>',$(k.box).find(" > div").append(a);$(k.box).find(" > div").append('<div id="layout_'+k.name+'_panel_css" style="position: absolute; top: 10000px;"></div');k.refresh();k.trigger($.extend(l,{phase:"after"}));setTimeout(function(){b();k.resize()},0);return(new Date).getTime()-h}},refresh:function(a){"undefined"==typeof a&&(a=null);var b=(new Date).getTime(),c=this.trigger({phase:"before",type:"refresh",target:"undefined"!=typeof a?a:this.name,object:this.get(a)});
if(!0!==c.isCancelled){if("string"==typeof a){var d=this.get(a);if(null===d)return;var g="#layout_"+this.name+"_panel_"+d.type;a="#layout_"+this.name+"_resizer_"+d.type;$(g).css({display:d.hidden?"none":"block"});d.resizable?$(a).show():$(a).hide();"object"==typeof d.content&&"function"===typeof d.content.render?(d.content.box=$(g+"> .w2ui-panel-content")[0],setTimeout(function(){0<$(g+"> .w2ui-panel-content").length&&($(g+"> .w2ui-panel-content").removeClass().removeAttr("name").off("selectstart").addClass("w2ui-panel-content").css("overflow",
d.overflow)[0].style.cssText+=";"+d.style);d.content.render()},1)):0<$(g+"> .w2ui-panel-content").length&&($(g+"> .w2ui-panel-content").removeClass().removeAttr("name").off("selectstart").addClass("w2ui-panel-content").html(d.content).css("overflow",d.overflow)[0].style.cssText+=";"+d.style);a=$(this.box).find(g+"> .w2ui-panel-tabs");d.show.tabs?0===a.find("[name="+d.tabs.name+"]").length&&null!==d.tabs?a.w2render(d.tabs):d.tabs.refresh():a.html("").removeClass("w2ui-tabs").hide();a=$(this.box).find(g+
"> .w2ui-panel-toolbar");d.show.toolbar?0===a.find("[name="+d.toolbar.name+"]").length&&null!==d.toolbar?a.w2render(d.toolbar):d.toolbar.refresh():a.html("").removeClass("w2ui-toolbar").hide();a=$(this.box).find(g+"> .w2ui-panel-title");d.title?a.html(d.title).show():a.html("").hide()}else{if(0==$("#layout_"+this.name+"_panel_main").length){this.render();return}this.resize();for(var k in this.panels)this.refresh(this.panels[k].type)}this.trigger($.extend(c,{phase:"after"}));return(new Date).getTime()-
b}},resize:function(){if(!this.box)return!1;var a=(new Date).getTime(),b=this.tmp.resize,e=this.trigger({phase:"before",type:"resize",target:this.name,panel:b?b.type:"all",diff_x:b?b.diff_x:0,diff_y:b?b.diff_y:0});if(!0!==e.isCancelled){0>this.padding&&(this.padding=0);var d=parseInt($(this.box).width()),g=parseInt($(this.box).height());$(this.box).find(" > div").css({width:d+"px",height:g+"px"});var k=this,h=this.get("main"),l=this.get("preview"),m=this.get("left"),n=this.get("right"),p=this.get("top"),
r=this.get("bottom"),u=null!==l&&!0!==l.hidden?!0:!1,x=null!==m&&!0!==m.hidden?!0:!1,t=null!==n&&!0!==n.hidden?!0:!1,y=null!==p&&!0!==p.hidden?!0:!1,v=null!==r&&!0!==r.hidden?!0:!1,q,w,z,A;for(q in c)if(q=c[q],"main"!==q&&(b=this.get(q)))w=String(b.size||0),"%"==w.substr(w.length-1)?(w=g,"preview"==b.type&&(w=w-(p&&!p.hidden?p.sizeCalculated:0)-(r&&!r.hidden?r.sizeCalculated:0)),b.sizeCalculated=parseInt(("left"==b.type||"right"==b.type?d:w)*parseFloat(b.size)/100)):b.sizeCalculated=parseInt(b.size),
b.sizeCalculated=Math.max(b.sizeCalculated,parseInt(b.minSize));null!==p&&!0!==p.hidden?(q=b=0,w=d,z=p.sizeCalculated,$("#layout_"+this.name+"_panel_top").css({display:"block",left:b+"px",top:q+"px",width:w+"px",height:z+"px"}).show(),p.width=w,p.height=z,p.resizable&&(q=p.sizeCalculated-(0===this.padding?this.resizer:0),z=this.resizer>this.padding?this.resizer:this.padding,$("#layout_"+this.name+"_resizer_top").show().css({display:"block",left:b+"px",top:q+"px",width:w+"px",height:z+"px",cursor:"ns-resize"}).off("mousedown").on("mousedown",
function(a){var b=k.trigger({phase:"before",type:"resizerClick",target:"top",originalEvent:a});if(!0!==b.isCancelled)return w2ui[k.name].tmp.events.resizeStart("top",a),k.trigger($.extend(b,{phase:"after"})),!1}))):$("#layout_"+this.name+"_panel_top").hide();null!==m&&!0!==m.hidden?(b=0,q=0+(y?p.sizeCalculated+this.padding:0),w=m.sizeCalculated,z=g-(y?p.sizeCalculated+this.padding:0)-(v?r.sizeCalculated+this.padding:0),A=$("#layout_"+this.name+"_panel_left"),-1!=window.navigator.userAgent.indexOf("MSIE")&&
0<A.length&&A[0].clientHeight<A[0].scrollHeight&&(w+=17),A.css({display:"block",left:b+"px",top:q+"px",width:w+"px",height:z+"px"}).show(),m.width=w,m.height=z,m.resizable&&(b=m.sizeCalculated-(0===this.padding?this.resizer:0),w=this.resizer>this.padding?this.resizer:this.padding,$("#layout_"+this.name+"_resizer_left").show().css({display:"block",left:b+"px",top:q+"px",width:w+"px",height:z+"px",cursor:"ew-resize"}).off("mousedown").on("mousedown",function(a){var b=k.trigger({phase:"before",type:"resizerClick",
target:"left",originalEvent:a});if(!0!==b.isCancelled)return w2ui[k.name].tmp.events.resizeStart("left",a),k.trigger($.extend(b,{phase:"after"})),!1}))):($("#layout_"+this.name+"_panel_left").hide(),$("#layout_"+this.name+"_resizer_left").hide());null!==n&&!0!==n.hidden?(b=d-n.sizeCalculated,q=0+(y?p.sizeCalculated+this.padding:0),w=n.sizeCalculated,z=g-(y?p.sizeCalculated+this.padding:0)-(v?r.sizeCalculated+this.padding:0),$("#layout_"+this.name+"_panel_right").css({display:"block",left:b+"px",top:q+
"px",width:w+"px",height:z+"px"}).show(),n.width=w,n.height=z,n.resizable&&(b-=this.padding,w=this.resizer>this.padding?this.resizer:this.padding,$("#layout_"+this.name+"_resizer_right").show().css({display:"block",left:b+"px",top:q+"px",width:w+"px",height:z+"px",cursor:"ew-resize"}).off("mousedown").on("mousedown",function(a){var b=k.trigger({phase:"before",type:"resizerClick",target:"right",originalEvent:a});if(!0!==b.isCancelled)return w2ui[k.name].tmp.events.resizeStart("right",a),k.trigger($.extend(b,
{phase:"after"})),!1}))):$("#layout_"+this.name+"_panel_right").hide();null!==r&&!0!==r.hidden?(b=0,q=g-r.sizeCalculated,w=d,z=r.sizeCalculated,$("#layout_"+this.name+"_panel_bottom").css({display:"block",left:b+"px",top:q+"px",width:w+"px",height:z+"px"}).show(),r.width=w,r.height=z,r.resizable&&(q-=0===this.padding?0:this.padding,z=this.resizer>this.padding?this.resizer:this.padding,$("#layout_"+this.name+"_resizer_bottom").show().css({display:"block",left:b+"px",top:q+"px",width:w+"px",height:z+
"px",cursor:"ns-resize"}).off("mousedown").on("mousedown",function(a){var b=k.trigger({phase:"before",type:"resizerClick",target:"bottom",originalEvent:a});if(!0!==b.isCancelled)return w2ui[k.name].tmp.events.resizeStart("bottom",a),k.trigger($.extend(b,{phase:"after"})),!1}))):$("#layout_"+this.name+"_panel_bottom").hide();b=0+(x?m.sizeCalculated+this.padding:0);q=0+(y?p.sizeCalculated+this.padding:0);w=d-(x?m.sizeCalculated+this.padding:0)-(t?n.sizeCalculated+this.padding:0);z=g-(y?p.sizeCalculated+
this.padding:0)-(v?r.sizeCalculated+this.padding:0)-(u?l.sizeCalculated+this.padding:0);A=$("#layout_"+this.name+"_panel_main");-1!=window.navigator.userAgent.indexOf("MSIE")&&0<A.length&&A[0].clientHeight<A[0].scrollHeight&&(w+=17);A.css({display:"block",left:b+"px",top:q+"px",width:w+"px",height:z+"px"});h.width=w;h.height=z;null!==l&&!0!==l.hidden?(b=0+(x?m.sizeCalculated+this.padding:0),q=g-(v?r.sizeCalculated+this.padding:0)-l.sizeCalculated,w=d-(x?m.sizeCalculated+this.padding:0)-(t?n.sizeCalculated+
this.padding:0),z=l.sizeCalculated,A=$("#layout_"+this.name+"_panel_preview"),-1!=window.navigator.userAgent.indexOf("MSIE")&&0<A.length&&A[0].clientHeight<A[0].scrollHeight&&(w+=17),A.css({display:"block",left:b+"px",top:q+"px",width:w+"px",height:z+"px"}).show(),l.width=w,l.height=z,l.resizable&&(q-=0===this.padding?0:this.padding,z=this.resizer>this.padding?this.resizer:this.padding,$("#layout_"+this.name+"_resizer_preview").show().css({display:"block",left:b+"px",top:q+"px",width:w+"px",height:z+
"px",cursor:"ns-resize"}).off("mousedown").on("mousedown",function(a){var b=k.trigger({phase:"before",type:"resizerClick",target:"preview",originalEvent:a});if(!0!==b.isCancelled)return w2ui[k.name].tmp.events.resizeStart("preview",a),k.trigger($.extend(b,{phase:"after"})),!1}))):$("#layout_"+this.name+"_panel_preview").hide();for(var B in c)B=c[B],d=this.get(B),g="#layout_"+this.name+"_panel_"+B+" > .w2ui-panel-",h=0,d&&(d.title&&(h+=w2utils.getSize($(g+"title").css({top:h+"px",display:"block"}),
"height")),d.show.tabs&&(null!==d.tabs&&w2ui[this.name+"_"+B+"_tabs"]&&w2ui[this.name+"_"+B+"_tabs"].resize(),h+=w2utils.getSize($(g+"tabs").css({top:h+"px",display:"block"}),"height")),d.show.toolbar&&(null!==d.toolbar&&w2ui[this.name+"_"+B+"_toolbar"]&&w2ui[this.name+"_"+B+"_toolbar"].resize(),h+=w2utils.getSize($(g+"toolbar").css({top:h+"px",display:"block"}),"height"))),$(g+"content").css({display:"block"}).css({top:h+"px"});clearTimeout(this._resize_timer);this._resize_timer=setTimeout(function(){for(var a in w2ui)if("function"==
typeof w2ui[a].resize){"undefined"==w2ui[a].panels&&w2ui[a].resize();var b=$(w2ui[a].box).parents(".w2ui-layout");0<b.length&&b.attr("name")==k.name&&w2ui[a].resize()}},100);this.trigger($.extend(e,{phase:"after"}));return(new Date).getTime()-a}},destroy:function(){var a=this.trigger({phase:"before",type:"destroy",target:this.name});if(!0!==a.isCancelled){if("undefined"==typeof w2ui[this.name])return!1;0<$(this.box).find("#layout_"+this.name+"_panel_main").length&&$(this.box).removeAttr("name").removeClass("w2ui-layout").html("");
delete w2ui[this.name];this.trigger($.extend(a,{phase:"after"}));this.tmp.events&&this.tmp.events.resize&&$(window).off("resize",this.tmp.events.resize);return!0}},lock:function(a,b,e){if(-1==c.indexOf(a))console.log("ERROR: First parameter needs to be the a valid panel name.");else{var d=Array.prototype.slice.call(arguments,0);d[0]="#layout_"+this.name+"_panel_"+a;w2utils.lock.apply(window,d)}},unlock:function(a){-1==c.indexOf(a)?console.log("ERROR: First parameter needs to be the a valid panel name."):
w2utils.unlock("#layout_"+this.name+"_panel_"+a)}};$.extend(d.prototype,w2utils.event);w2obj.layout=d})();var w2popup={};
(function(){$.fn.w2popup=function(d,c){"undefined"===typeof d&&(c={},d="open");$.isPlainObject(d)&&(c=d,d="open");d=d.toLowerCase();"load"===d&&"string"===typeof c&&(c=$.extend({url:c},2<arguments.length?arguments[2]:{}));"open"===d&&null!=c.url&&(d="load");c=c||{};var a={};0<$(this).length&&(0<$(this).find("div[rel=title], div[rel=body], div[rel=buttons]").length?(0<$(this).find("div[rel=title]").length&&(a.title=$(this).find("div[rel=title]").html()),0<$(this).find("div[rel=body]").length&&(a.body=
$(this).find("div[rel=body]").html(),a.style=$(this).find("div[rel=body]")[0].style.cssText),0<$(this).find("div[rel=buttons]").length&&(a.buttons=$(this).find("div[rel=buttons]").html())):(a.title="&nbsp;",a.body=$(this).html()),0!=parseInt($(this).css("width"))&&(a.width=parseInt($(this).css("width"))),0!=parseInt($(this).css("height"))&&(a.height=parseInt($(this).css("height"))));return w2popup[d]($.extend({},a,c))};w2popup={defaults:{title:"",body:"",buttons:"",style:"",color:"#000",opacity:.4,
speed:.3,modal:!1,maximized:!1,keyboard:!0,width:500,height:300,showClose:!0,showMax:!1,transition:null},status:"closed",handlers:[],onOpen:null,onClose:null,onMax:null,onMin:null,onToggle:null,onKeydown:null,open:function(d){function c(a){a||(a=window.event);window.addEventListener||window.document.attachEvent("onselectstart",function(){return!1});w2popup.status="moving";l.resizing=!0;l.x=a.screenX;l.y=a.screenY;l.pos_x=$("#w2ui-popup").position().left;l.pos_y=$("#w2ui-popup").position().top;w2popup.lock({opacity:0});
$(document).on("mousemove",l.mvMove);$(document).on("mouseup",l.mvStop);a.stopPropagation?a.stopPropagation():a.cancelBubble=!0;if(a.preventDefault)a.preventDefault();else return!1}function a(a){1==l.resizing&&(a||(a=window.event),l.div_x=a.screenX-l.x,l.div_y=a.screenY-l.y,$("#w2ui-popup").css({"-webkit-transition":"none","-webkit-transform":"translate3d("+l.div_x+"px, "+l.div_y+"px, 0px)","-moz-transition":"none","-moz-transform":"translate("+l.div_x+"px, "+l.div_y+"px)","-ms-transition":"none",
"-ms-transform":"translate("+l.div_x+"px, "+l.div_y+"px)","-o-transition":"none","-o-transform":"translate("+l.div_x+"px, "+l.div_y+"px)"}))}function b(a){1==l.resizing&&(a||(a=window.event),w2popup.status="open",l.div_x=a.screenX-l.x,l.div_y=a.screenY-l.y,$("#w2ui-popup").css({left:l.pos_x+l.div_x+"px",top:l.pos_y+l.div_y+"px","-webkit-transition":"none","-webkit-transform":"translate3d(0px, 0px, 0px)","-moz-transition":"none","-moz-transform":"translate(0px, 0px)","-ms-transition":"none","-ms-transform":"translate(0px, 0px)",
"-o-transition":"none","-o-transform":"translate(0px, 0px)"}),l.resizing=!1,$(document).off("mousemove",l.mvMove),$(document).off("mouseup",l.mvStop),w2popup.unlock())}var e=this;if("closing"==w2popup.status)setTimeout(function(){e.open.call(e,d)},100);else{var f=$("#w2ui-popup").data("options");d=$.extend({},this.defaults,f,{title:"",body:"",buttons:""},d,{maximized:!1});setTimeout(function(){$("#w2ui-popup").data("options",d)},100);0==$("#w2ui-popup").length&&(w2popup.handlers=[],w2popup.onMax=
null,w2popup.onMin=null,w2popup.onToggle=null,w2popup.onOpen=null,w2popup.onClose=null,w2popup.onKeydown=null);d.onOpen&&(w2popup.onOpen=d.onOpen);d.onClose&&(w2popup.onClose=d.onClose);d.onMax&&(w2popup.onMax=d.onMax);d.onMin&&(w2popup.onMin=d.onMin);d.onToggle&&(w2popup.onToggle=d.onToggle);d.onKeydown&&(w2popup.onKeydown=d.onKeydown);if(void 0==window.innerHeight){var g=document.documentElement.offsetWidth,k=document.documentElement.offsetHeight;"IE7"===w2utils.engine&&(g+=21,k+=4)}else g=window.innerWidth,
k=window.innerHeight;parseInt(g)-10<parseInt(d.width)&&(d.width=parseInt(g)-10);parseInt(k)-10<parseInt(d.height)&&(d.height=parseInt(k)-10);k=parseInt((parseInt(k)-parseInt(d.height))/2*.6);g=parseInt((parseInt(g)-parseInt(d.width))/2);if(0==$("#w2ui-popup").length){var h=this.trigger({phase:"before",type:"open",target:"popup",options:d,present:!1});if(!0===h.isCancelled)return;w2popup.status="opening";w2popup.lockScreen(d);f="";d.showClose&&(f+='<div class="w2ui-msg-button w2ui-msg-close" onmousedown="event.stopPropagation()" onclick="w2popup.close()">Close</div>');
d.showMax&&(f+='<div class="w2ui-msg-button w2ui-msg-max" onmousedown="event.stopPropagation()" onclick="w2popup.toggle()">Max</div>');f='<div id="w2ui-popup" class="w2ui-popup" style="opacity: 0; left: '+g+"px; top: "+k+"px;     width: "+parseInt(d.width)+"px; height: "+parseInt(d.height)+'px;     -webkit-transform: scale(0.8); -moz-transform: scale(0.8); -ms-transform: scale(0.8); -o-transform: scale(0.8); ">   <div class="w2ui-msg-title" style="'+(""==d.title?"display: none":"")+'">'+f+d.title+
'</div>   <div class="w2ui-box1" style="'+(""==d.title?"top: 0px !important;":"")+(""==d.buttons?"bottom: 0px !important;":"")+'">       <div class="w2ui-msg-body'+(""!=!d.title?" w2ui-msg-no-title":"")+(""!=!d.buttons?" w2ui-msg-no-buttons":"")+'" style="'+d.style+'">'+d.body+'</div>   </div>   <div class="w2ui-box2" style="'+(""==d.title?"top: 0px !important;":"")+(""==d.buttons?"bottom: 0px !important;":"")+'">       <div class="w2ui-msg-body'+(""!=!d.title?" w2ui-msg-no-title":"")+(""!=!d.buttons?
" w2ui-msg-no-buttons":"")+'" style="'+d.style+'"></div>       </div>   <div class="w2ui-msg-buttons" style="'+(""==d.buttons?"display: none":"")+'">'+d.buttons+"</div></div>";$("body").append(f);setTimeout(function(){$("#w2ui-popup .w2ui-box2").hide();$("#w2ui-popup").css({"-webkit-transition":d.speed+"s opacity, "+d.speed+"s -webkit-transform","-webkit-transform":"scale(1)","-moz-transition":d.speed+"s opacity, "+d.speed+"s -moz-transform","-moz-transform":"scale(1)","-ms-transition":d.speed+"s opacity, "+
d.speed+"s -ms-transform","-ms-transform":"scale(1)","-o-transition":d.speed+"s opacity, "+d.speed+"s -o-transform","-o-transform":"scale(1)",opacity:"1"})},1);setTimeout(function(){$("#w2ui-popup").css({"-webkit-transform":"","-moz-transform":"","-ms-transform":"","-o-transform":""});w2popup.status="open";setTimeout(function(){e.trigger($.extend(h,{phase:"after"}))},100)},1E3*d.speed)}else{h=this.trigger({phase:"before",type:"open",target:"popup",options:d,present:!0});if(!0===h.isCancelled)return;
w2popup.status="opening";"undefined"!=typeof f&&f.width==d.width&&f.height==d.height||w2popup.resize(d.width,d.height);"undefined"!=typeof f&&(d.prevSize=d.width+":"+d.height,d.maximized=f.maximized);f=$("#w2ui-popup .w2ui-box2 > .w2ui-msg-body").html(d.body);0<f.length&&(f[0].style.cssText=d.style);""!=d.buttons?($("#w2ui-popup .w2ui-msg-buttons").show().html(d.buttons),$("#w2ui-popup .w2ui-msg-body").removeClass("w2ui-msg-no-buttons"),$("#w2ui-popup .w2ui-box1, #w2ui-popup .w2ui-box2").css("bottom",
"")):($("#w2ui-popup .w2ui-msg-buttons").hide().html(""),$("#w2ui-popup .w2ui-msg-body").addClass("w2ui-msg-no-buttons"),$("#w2ui-popup .w2ui-box1, #w2ui-popup .w2ui-box2").css("bottom","0px"));""!=d.title?($("#w2ui-popup .w2ui-msg-title").show().html((d.showClose?'<div class="w2ui-msg-button w2ui-msg-close" onmousedown="event.stopPropagation()" onclick="w2popup.close()">Close</div>':"")+(d.showMax?'<div class="w2ui-msg-button w2ui-msg-max" onmousedown="event.stopPropagation()" onclick="w2popup.toggle()">Max</div>':
"")+d.title),$("#w2ui-popup .w2ui-msg-body").removeClass("w2ui-msg-no-title"),$("#w2ui-popup .w2ui-box1, #w2ui-popup .w2ui-box2").css("top","")):($("#w2ui-popup .w2ui-msg-title").hide().html(""),$("#w2ui-popup .w2ui-msg-body").addClass("w2ui-msg-no-title"),$("#w2ui-popup .w2ui-box1, #w2ui-popup .w2ui-box2").css("top","0px"));f=$("#w2ui-popup .w2ui-box1")[0];k=$("#w2ui-popup .w2ui-box2")[0];w2utils.transition(f,k,d.transition);k.className="w2ui-box1";f.className="w2ui-box2";$(k).addClass("w2ui-current-box");
$("#w2ui-popup").data("prev-size",null);setTimeout(function(){w2popup.status="open";e.trigger($.extend(h,{phase:"after"}))},100)}d._last_w2ui_name=w2utils.keyboard.active();w2utils.keyboard.active(null);if(d.keyboard)$(document).on("keydown",this.keydown);var l={resizing:!1,mvMove:a,mvStop:b};$("#w2ui-popup .w2ui-msg-title").on("mousedown",function(a){c(a)});return this}},keydown:function(d){var c=$("#w2ui-popup").data("options");if(c&&c.keyboard&&(c=w2popup.trigger({phase:"before",type:"keydown",
target:"popup",options:c,originalEvent:d}),!0!==c.isCancelled)){switch(d.keyCode){case 27:d.preventDefault(),0<$("#w2ui-popup .w2ui-popup-message").length?w2popup.message():w2popup.close()}w2popup.trigger($.extend(c,{phase:"after"}))}},close:function(d){var c=this;d=$.extend({},$("#w2ui-popup").data("options"),d);if(0!=$("#w2ui-popup").length){var a=this.trigger({phase:"before",type:"close",target:"popup",options:d});!0!==a.isCancelled&&(w2popup.status="closing",$("#w2ui-popup").css({"-webkit-transition":d.speed+
"s opacity, "+d.speed+"s -webkit-transform","-webkit-transform":"scale(0.9)","-moz-transition":d.speed+"s opacity, "+d.speed+"s -moz-transform","-moz-transform":"scale(0.9)","-ms-transition":d.speed+"s opacity, "+d.speed+"s -ms-transform","-ms-transform":"scale(0.9)","-o-transition":d.speed+"s opacity, "+d.speed+"s -o-transform","-o-transform":"scale(0.9)",opacity:"0"}),w2popup.unlockScreen(d),setTimeout(function(){$("#w2ui-popup").remove();w2popup.status="closed";c.trigger($.extend(a,{phase:"after"}))},
1E3*d.speed),w2utils.keyboard.active(d._last_w2ui_name),d.keyboard&&$(document).off("keydown",this.keydown))}},toggle:function(){var d=this,c=$("#w2ui-popup").data("options"),a=this.trigger({phase:"before",type:"toggle",target:"popup",options:c});!0!==a.isCancelled&&(!0===c.maximized?w2popup.min():w2popup.max(),setTimeout(function(){d.trigger($.extend(a,{phase:"after"}))},1E3*c.speed+50))},max:function(){var d=this,c=$("#w2ui-popup").data("options");if(!0!==c.maximized){var a=this.trigger({phase:"before",
type:"max",target:"popup",options:c});!0!==a.isCancelled&&(w2popup.status="resizing",c.prevSize=$("#w2ui-popup").css("width")+":"+$("#w2ui-popup").css("height"),w2popup.resize(1E4,1E4,function(){w2popup.status="open";c.maximized=!0;d.trigger($.extend(a,{phase:"after"}))}))}},min:function(){var d=this,c=$("#w2ui-popup").data("options");if(!0===c.maximized){var a=c.prevSize.split(":"),b=this.trigger({phase:"before",type:"min",target:"popup",options:c});!0!==b.isCancelled&&(w2popup.status="resizing",
w2popup.resize(a[0],a[1],function(){w2popup.status="open";c.maximized=!1;c.prevSize=null;d.trigger($.extend(b,{phase:"after"}))}))}},get:function(){return $("#w2ui-popup").data("options")},set:function(d){w2popup.open(d)},clear:function(){$("#w2ui-popup .w2ui-msg-title").html("");$("#w2ui-popup .w2ui-msg-body").html("");$("#w2ui-popup .w2ui-msg-buttons").html("")},reset:function(){w2popup.open(w2popup.defaults)},load:function(d){function c(a,b){delete d.url;$("body").append('<div id="w2ui-tmp" style="display: none">'+
a+"</div>");"undefined"!=typeof b&&0<$("#w2ui-tmp #"+b).length?$("#w2ui-tmp #"+b).w2popup(d):$("#w2ui-tmp > div").w2popup(d);if(0<$("#w2ui-tmp > style").length){var c=$("<div>").append($("#w2ui-tmp > style").clone()).html();0==$("#w2ui-popup #div-style").length&&$("#w2ui-popup").append('<div id="div-style" style="position: absolute; left: -100; width: 1px"></div>');$("#w2ui-popup #div-style").html(c)}$("#w2ui-tmp").remove()}w2popup.status="loading";if("undefined"==String(d.url))console.log("ERROR: The url parameter is empty.");
else{var a=String(d.url).split("#"),b=a[0],e=a[1];"undefined"==String(d)&&(d={});a=$("#w2ui-popup").data(b);"undefined"!=typeof a&&null!=a?c(a,e):$.get(b,function(a,d,k){c(k.responseText,e);$("#w2ui-popup").data(b,k.responseText)})}},message:function(d){$().w2tag();d||(d={width:200,height:100});10>parseInt(d.width)&&(d.width=10);10>parseInt(d.height)&&(d.height=10);"undefined"==typeof d.hideOnClick&&(d.hideOnClick=!1);var c=$("#w2ui-popup").data("options")||{};if("undefined"==typeof d.width||d.width>
c.width-10)d.width=c.width-10;if("undefined"==typeof d.height||d.height>c.height-40)d.height=c.height-40;var c=$("#w2ui-popup .w2ui-msg-title"),a=parseInt($("#w2ui-popup").width()),b=$("#w2ui-popup .w2ui-popup-message").length;if(""==$.trim(d.html)){$("#w2ui-popup #w2ui-message"+(b-1)).css("z-Index",250);d=$("#w2ui-popup #w2ui-message"+(b-1)).data("options")||{};$("#w2ui-popup #w2ui-message"+(b-1)).remove();if("function"==typeof d.onClose)d.onClose();1==b?w2popup.unlock():$("#w2ui-popup #w2ui-message"+
(b-2)).show()}else{$("#w2ui-popup .w2ui-popup-message").hide();$("#w2ui-popup .w2ui-box1").before('<div id="w2ui-message'+b+'" class="w2ui-popup-message" style="display: none; '+(0==c.length?"top: 0px;":"top: "+w2utils.getSize(c,"height")+"px;")+("undefined"!=typeof d.width?"width: "+d.width+"px; left: "+(a-d.width)/2+"px;":"left: 10px; right: 10px;")+("undefined"!=typeof d.height?"height: "+d.height+"px;":"bottom: 6px;")+'-webkit-transition: .3s; -moz-transition: .3s; -ms-transition: .3s; -o-transition: .3s;"'+
(!0===d.hideOnClick?'onclick="w2popup.message();"':"")+"></div>");$("#w2ui-popup #w2ui-message"+b).data("options",d);var e=$("#w2ui-popup #w2ui-message"+b).css("display");$("#w2ui-popup #w2ui-message"+b).css({"-webkit-transform":"none"==e?"translateY(-"+d.height+"px)":"translateY(0px)","-moz-transform":"none"==e?"translateY(-"+d.height+"px)":"translateY(0px)","-ms-transform":"none"==e?"translateY(-"+d.height+"px)":"translateY(0px)","-o-transform":"none"==e?"translateY(-"+d.height+"px)":"translateY(0px)"});
"none"==e&&($("#w2ui-popup #w2ui-message"+b).show().html(d.html),setTimeout(function(){$("#w2ui-popup #w2ui-message"+b).css({"-webkit-transform":"none"==e?"translateY(0px)":"translateY(-"+d.height+"px)","-moz-transform":"none"==e?"translateY(0px)":"translateY(-"+d.height+"px)","-ms-transform":"none"==e?"translateY(0px)":"translateY(-"+d.height+"px)","-o-transform":"none"==e?"translateY(0px)":"translateY(-"+d.height+"px)"})},1),setTimeout(function(){$("#w2ui-popup #w2ui-message"+b).css({"-webkit-transition":"0s",
"-moz-transition":"0s","-ms-transition":"0s","-o-transition":"0s","z-Index":1500});0==b&&w2popup.lock();if("function"==typeof d.onOpen)d.onOpen()},300))}},lock:function(d,c){var a=Array.prototype.slice.call(arguments,0);a.unshift($("#w2ui-popup"));w2utils.lock.apply(window,a)},unlock:function(){w2utils.unlock($("#w2ui-popup"))},lockScreen:function(d){if(0<$("#w2ui-lock").length)return!1;"undefined"==typeof d&&(d=$("#w2ui-popup").data("options"));"undefined"==typeof d&&(d={});d=$.extend({},w2popup.defaults,
d);$("body").append('<div id="w2ui-lock"     onmousewheel="if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true; if (event.preventDefault) event.preventDefault(); else return false;"    style="position: '+("IE5"==w2utils.engine?"absolute":"fixed")+"; z-Index: 1199; left: 0px; top: 0px;            padding: 0px; margin: 0px; background-color: "+d.color+'; width: 100%; height: 100%; opacity: 0;"></div>');setTimeout(function(){$("#w2ui-lock").css({"-webkit-transition":d.speed+
"s opacity","-moz-transition":d.speed+"s opacity","-ms-transition":d.speed+"s opacity","-o-transition":d.speed+"s opacity",opacity:d.opacity})},1);if(1==d.modal)$("#w2ui-lock").on("mousedown",function(){$("#w2ui-lock").css({"-webkit-transition":".1s","-moz-transition":".1s","-ms-transition":".1s","-o-transition":".1s",opacity:"0.6"})}),$("#w2ui-lock").on("mouseup",function(){setTimeout(function(){$("#w2ui-lock").css({"-webkit-transition":".1s","-moz-transition":".1s","-ms-transition":".1s","-o-transition":".1s",
opacity:d.opacity})},100)});else $("#w2ui-lock").on("mouseup",function(){w2popup.close()});return!0},unlockScreen:function(d){if(0==$("#w2ui-lock").length)return!1;"undefined"==typeof d&&(d=$("#w2ui-popup").data("options"));"undefined"==typeof d&&(d={});d=$.extend({},w2popup.defaults,d);$("#w2ui-lock").css({"-webkit-transition":d.speed+"s opacity","-moz-transition":d.speed+"s opacity","-ms-transition":d.speed+"s opacity","-o-transition":d.speed+"s opacity",opacity:0});setTimeout(function(){$("#w2ui-lock").remove()},
1E3*d.speed);return!0},resize:function(d,c,a){var b=$("#w2ui-popup").data("options");parseInt($(window).width())-10<parseInt(d)&&(d=parseInt($(window).width())-10);parseInt($(window).height())-10<parseInt(c)&&(c=parseInt($(window).height())-10);var e=(parseInt($(window).height())-parseInt(c))/2*.8,f=(parseInt($(window).width())-parseInt(d))/2;$("#w2ui-popup").css({"-webkit-transition":b.speed+"s width, "+b.speed+"s height, "+b.speed+"s left, "+b.speed+"s top","-moz-transition":b.speed+"s width, "+
b.speed+"s height, "+b.speed+"s left, "+b.speed+"s top","-ms-transition":b.speed+"s width, "+b.speed+"s height, "+b.speed+"s left, "+b.speed+"s top","-o-transition":b.speed+"s width, "+b.speed+"s height, "+b.speed+"s left, "+b.speed+"s top",top:e,left:f,width:d,height:c});setTimeout(function(){b.width=d;b.height=c;"function"==typeof a&&a()},1E3*b.speed+50)}};$.extend(w2popup,w2utils.event)})();
var w2alert=function(d,c,a){null==c&&(c=w2utils.lang("Notification"));0<$("#w2ui-popup").length&&"closing"!=w2popup.status?w2popup.message({width:400,height:170,html:'<div style="position: absolute; top: 0px; left: 0px; right: 0px; bottom: 45px; overflow: auto">        <div class="w2ui-centered" style="font-size: 13px;">'+d+'</div></div><div style="position: absolute; bottom: 7px; left: 0px; right: 0px; text-align: center; padding: 5px">        <button onclick="w2popup.message();" class="w2ui-popup-btn btn">'+
w2utils.lang("Ok")+"</button></div>",onClose:function(){"function"==typeof a&&a()}}):w2popup.open({width:450,height:220,showMax:!1,showClose:!1,title:c,body:'<div class="w2ui-centered" style="font-size: 13px;">'+d+"</div>",buttons:'<button onclick="w2popup.close();" class="w2ui-popup-btn btn">'+w2utils.lang("Ok")+"</button>",onClose:function(){"function"==typeof a&&a()}})},w2confirm=function(d,c,a){var b={},e={msg:"",title:w2utils.lang("Confirmation"),width:0<$("#w2ui-popup").length?400:450,height:0<
$("#w2ui-popup").length?170:220,yes_text:"Yes",yes_class:"",yes_style:"",yes_callBack:null,no_text:"No",no_class:"",no_style:"",no_callBack:null,callBack:null};1==arguments.length&&"object"==typeof d?$.extend(b,e,d):"function"==typeof c?$.extend(b,e,{msg:d,callBack:c}):$.extend(b,e,{msg:d,title:c,callBack:a});0<$("#w2ui-popup").length&&"closing"!=w2popup.status?(b.width>w2popup.get().width&&(b.width=w2popup.get().width),b.height>w2popup.get().height-50&&(b.height=w2popup.get().height-50),w2popup.message({width:b.width,
height:b.height,html:'<div style="position: absolute; top: 0px; left: 0px; right: 0px; bottom: 40px; overflow: auto">        <div class="w2ui-centered" style="font-size: 13px;">'+b.msg+'</div></div><div style="position: absolute; bottom: 7px; left: 0px; right: 0px; text-align: center; padding: 5px">        <button id="Yes" class="w2ui-popup-btn btn '+b.yes_class+'" style="'+b.yes_style+'">'+w2utils.lang(b.yes_text)+'</button>        <button id="No" class="w2ui-popup-btn btn '+b.no_class+'" style="'+
b.no_style+'">'+w2utils.lang(b.no_text)+"</button></div>",onOpen:function(){$("#w2ui-popup .w2ui-popup-message .btn").on("click",function(a){w2popup.message();"function"==typeof b.callBack&&b.callBack(a.target.id);"Yes"==a.target.id&&"function"==typeof b.yes_callBack&&b.yes_callBack();"No"==a.target.id&&"function"==typeof b.no_callBack&&b.no_callBack()})},onKeydown:function(a){switch(a.originalEvent.keyCode){case 13:"function"==typeof b.callBack&&b.callBack("Yes");"function"==typeof b.yes_callBack&&
b.yes_callBack();w2popup.message();break;case 27:"function"==typeof b.callBack&&b.callBack("No"),"function"==typeof b.no_callBack&&b.no_callBack(),w2popup.message()}}})):(w2utils.isInt(b.height)||(b.height+=50),w2popup.open({width:b.width,height:b.height,title:b.title,modal:!0,showClose:!1,body:'<div class="w2ui-centered" style="font-size: 13px;">'+b.msg+"</div>",buttons:'<button id="Yes" class="w2ui-popup-btn btn '+b.yes_class+'" style="'+b.yes_style+'">'+w2utils.lang(b.yes_text)+'</button><button id="No" class="w2ui-popup-btn btn '+
b.no_class+'" style="'+b.no_style+'">'+w2utils.lang(b.no_text)+"</button>",onOpen:function(a){a.onComplete=function(){$("#w2ui-popup .w2ui-popup-btn").on("click",function(a){w2popup.close();"function"==typeof b.callBack&&b.callBack(a.target.id);"Yes"==a.target.id&&"function"==typeof b.yes_callBack&&b.yes_callBack();"No"==a.target.id&&"function"==typeof b.no_callBack&&b.no_callBack()})}},onKeydown:function(a){switch(a.originalEvent.keyCode){case 13:"function"==typeof b.callBack&&b.callBack("Yes");
"function"==typeof b.yes_callBack&&b.yes_callBack();w2popup.close();break;case 27:"function"==typeof b.callBack&&b.callBack("No"),"function"==typeof b.no_callBack&&b.no_callBack(),w2popup.close()}}}));return{yes:function(a){b.yes_callBack=a;return this},no:function(a){b.no_callBack=a;return this}}};
(function(){var d=function(c){this.active=this.name=this.box=null;this.tabs=[];this.routeData={};this.style=this.right="";this.onDestroy=this.onResize=this.onRefresh=this.onRender=this.onClose=this.onClick=null;$.extend(this,{handlers:[]});$.extend(!0,this,w2obj.tabs,c)};$.fn.w2tabs=function(c){if("object"!==typeof c&&c){if(w2ui[$(this).attr("name")]){var a=w2ui[$(this).attr("name")];a[c].apply(a,Array.prototype.slice.call(arguments,1));return this}console.log("ERROR: Method "+c+" does not exist on jQuery.w2tabs")}else if(w2utils.checkName(c,
"w2tabs")){for(var a=c.tabs||[],b=new d(c),e=0;e<a.length;e++)b.tabs[e]=$.extend({},d.prototype.tab,a[e]);0!==$(this).length&&b.render($(this)[0]);return w2ui[b.name]=b}};d.prototype={tab:{id:null,text:"",route:null,hidden:!1,disabled:!1,closable:!1,hint:"",onClick:null,onRefresh:null,onClose:null},add:function(c){return this.insert(null,c)},insert:function(c,a){$.isArray(a)||(a=[a]);for(var b=0;b<a.length;b++){if("undefined"===typeof a[b].id){console.log('ERROR: The parameter "id" is required but not supplied. (obj: '+
this.name+")");break}if(!w2utils.checkUniqueId(a[b].id,this.tabs,"tabs",this.name))break;var e=$.extend({},d.prototype.tab,a[b]);if(null===c||"undefined"===typeof c)this.tabs.push(e);else{var f=this.get(c,!0);this.tabs=this.tabs.slice(0,f).concat([e],this.tabs.slice(f))}this.refresh(a[b].id)}},remove:function(){for(var c=0,a=0;a<arguments.length;a++){var b=this.get(arguments[a]);if(!b)return!1;c++;this.tabs.splice(this.get(b.id,!0),1);$(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(b.id)).remove()}return c},
select:function(c){if(this.active==c||null===this.get(c))return!1;this.active=c;this.refresh();return!0},set:function(c,a){var b=this.get(c,!0);if(null===b)return!1;$.extend(this.tabs[b],a);this.refresh(c);return!0},get:function(c,a){if(0===arguments.length){for(var b=[],e=0;e<this.tabs.length;e++)null!=this.tabs[e].id&&b.push(this.tabs[e].id);return b}for(b=0;b<this.tabs.length;b++)if(this.tabs[b].id==c)return!0===a?b:this.tabs[b];return null},show:function(){for(var c=this,a=0,b=[],e=0;e<arguments.length;e++){var d=
this.get(arguments[e]);d&&!1!==d.hidden&&(a++,d.hidden=!1,b.push(d.id))}setTimeout(function(){for(var a in b)c.refresh(b[a])},15);return a},hide:function(){for(var c=this,a=0,b=[],e=0;e<arguments.length;e++){var d=this.get(arguments[e]);d&&!0!==d.hidden&&(a++,d.hidden=!0,b.push(d.id))}setTimeout(function(){for(var a in b)c.refresh(b[a])},15);return a},enable:function(){for(var c=this,a=0,b=[],e=0;e<arguments.length;e++){var d=this.get(arguments[e]);d&&!1!==d.disabled&&(a++,d.disabled=!1,b.push(d.id))}setTimeout(function(){for(var a in b)c.refresh(b[a])},
15);return a},disable:function(){for(var c=this,a=0,b=[],e=0;e<arguments.length;e++){var d=this.get(arguments[e]);d&&!0!==d.disabled&&(a++,d.disabled=!0,b.push(d.id))}setTimeout(function(){for(var a in b)c.refresh(b[a])},15);return a},refresh:function(c){var a=(new Date).getTime(),b=this.trigger({phase:"before",type:"refresh",target:"undefined"!==typeof c?c:this.name,object:this.get(c)});if(!0!==b.isCancelled){if("undefined"===typeof c)for(c=0;c<this.tabs.length;c++)this.refresh(this.tabs[c].id);
else{var e=this.get(c);if(null===e)return!1;"undefined"!==typeof e.caption&&(e.text=e.caption);var d=$(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(e.id)),g=(e.closable?'<div class="w2ui-tab-close" onclick="w2ui[\''+this.name+"'].animateClose('"+e.id+"', event);\"></div>":"")+'    <div class="w2ui-tab'+(this.active===e.id?" active":"")+(e.closable?" closable":"")+'"         title="'+("undefined"!==typeof e.hint?e.hint:"")+'"        onclick="w2ui[\''+this.name+"'].click('"+e.id+"', event);\">"+
e.text+"</div>";0===d.length?(d="",e.hidden&&(d+="display: none;"),e.disabled&&(d+="opacity: 0.2; -moz-opacity: 0.2; -webkit-opacity: 0.2; -o-opacity: 0.2; filter:alpha(opacity=20);"),e='<td id="tabs_'+this.name+"_tab_"+e.id+'" style="'+d+'" valign="middle">'+g+"</td>",this.get(c,!0)!==this.tabs.length-1&&0<$(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(this.tabs[parseInt(this.get(c,!0))+1].id)).length?$(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(this.tabs[parseInt(this.get(c,
!0))+1].id)).before(e):$(this.box).find("#tabs_"+this.name+"_right").before(e)):(d.html(g),e.hidden?d.css("display","none"):d.css("display",""),e.disabled?d.css({opacity:"0.2","-moz-opacity":"0.2","-webkit-opacity":"0.2","-o-opacity":"0.2",filter:"alpha(opacity=20)"}):d.css({opacity:"1","-moz-opacity":"1","-webkit-opacity":"1","-o-opacity":"1",filter:"alpha(opacity=100)"}))}$("#tabs_"+this.name+"_right").html(this.right);this.trigger($.extend(b,{phase:"after"}));return(new Date).getTime()-a}},render:function(c){var a=
(new Date).getTime(),b=this.trigger({phase:"before",type:"render",target:this.name,box:c});if(!0!==b.isCancelled){"undefined"!==typeof c&&null!==c&&(0<$(this.box).find("> table #tabs_"+this.name+"_right").length&&$(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-tabs").html(""),this.box=c);if(!this.box)return!1;c='<table cellspacing="0" cellpadding="1" width="100%">    <tr><td width="100%" id="tabs_'+this.name+'_right" align="right">'+this.right+"</td></tr></table>";$(this.box).attr("name",
this.name).addClass("w2ui-reset w2ui-tabs").html(c);0<$(this.box).length&&($(this.box)[0].style.cssText+=this.style);this.trigger($.extend(b,{phase:"after"}));this.refresh();return(new Date).getTime()-a}},resize:function(){var c=(new Date).getTime(),a=this.trigger({phase:"before",type:"resize",target:this.name});if(!0!==a.isCancelled)return this.trigger($.extend(a,{phase:"after"})),(new Date).getTime()-c},destroy:function(){var c=this.trigger({phase:"before",type:"destroy",target:this.name});!0!==
c.isCancelled&&(0<$(this.box).find("> table #tabs_"+this.name+"_right").length&&$(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-tabs").html(""),delete w2ui[this.name],this.trigger($.extend(c,{phase:"after"})))},click:function(c,a){var b=this.get(c);if(null===b||b.disabled)return!1;var e=this.trigger({phase:"before",type:"click",target:c,tab:b,object:b,originalEvent:a});if(!0!==e.isCancelled){$(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(this.active)+" .w2ui-tab").removeClass("active");
this.active=b.id;if(b.route){var d=String("/"+b.route).replace(/\/{2,}/g,"/"),b=w2utils.parseRoute(d);if(0<b.keys.length)for(var g=0;g<b.keys.length;g++)null!=this.routeData[b.keys[g].name]&&(d=d.replace(new RegExp(":"+b.keys[g].name,"g"),this.routeData[b.keys[g].name]));setTimeout(function(){window.location.hash=d},1)}this.trigger($.extend(e,{phase:"after"}));this.refresh(c)}},animateClose:function(c,a){var b=this.get(c);if(null===b||b.disabled)return!1;var e=this.trigger({phase:"before",type:"close",
target:c,object:this.get(c),originalEvent:a});if(!0!==e.isCancelled){var d=this;$(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(b.id)).css({"-webkit-transition":".2s","-moz-transition":"2s","-ms-transition":".2s","-o-transition":".2s",opacity:"0"});setTimeout(function(){var a=$(d.box).find("#tabs_"+d.name+"_tab_"+w2utils.escapeId(b.id)).width();$(d.box).find("#tabs_"+d.name+"_tab_"+w2utils.escapeId(b.id)).html('<div style="width: '+a+'px; -webkit-transition: .2s; -moz-transition: .2s; -ms-transition: .2s; -o-transition: .2s"></div>');
setTimeout(function(){$(d.box).find("#tabs_"+d.name+"_tab_"+w2utils.escapeId(b.id)).find(":first-child").css({width:"0px"})},50)},200);setTimeout(function(){d.remove(c)},450);this.trigger($.extend(e,{phase:"after"}));this.refresh()}},animateInsert:function(c,a){if(null!==this.get(c)&&$.isPlainObject(a)&&w2utils.checkUniqueId(a.id,this.tabs,"tabs",this.name)&&0===$(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(a.id)).length){"undefined"!==typeof a.caption&&(a.text=a.caption);var b='<div id="_tmp_tabs" class="w2ui-reset w2ui-tabs" style="position: absolute; top: -1000px;"><table cellspacing="0" cellpadding="1" width="100%"><tr><td id="_tmp_simple_tab" style="" valign="middle">'+
(a.closable?'<div class="w2ui-tab-close"></div>':"")+'    <div class="w2ui-tab '+(this.active===a.id?"active":"")+'">'+a.text+"</div></td></tr></table></div>";$("body").append(b);b="";a.hidden&&(b+="display: none;");a.disabled&&(b+="opacity: 0.2; -moz-opacity: 0.2; -webkit-opacity: 0.2; -o-opacity: 0.2; filter:alpha(opacity=20);");b='<td id="tabs_'+this.name+"_tab_"+a.id+'" style="'+b+'" valign="middle"><div style="width: 1px; -webkit-transition: 0.2s; -moz-transition: 0.2s; -ms-transition: 0.2s; -o-transition: 0.2s;">&nbsp;</div></td>';
this.get(c,!0)!==this.tabs.length&&0<$(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(this.tabs[parseInt(this.get(c,!0))].id)).length?$(this.box).find("#tabs_"+this.name+"_tab_"+w2utils.escapeId(this.tabs[parseInt(this.get(c,!0))].id)).before(b):$(this.box).find("#tabs_"+this.name+"_right").before(b);var e=this;setTimeout(function(){var b=$("#_tmp_simple_tab").width();$("#_tmp_tabs").remove();$("#tabs_"+e.name+"_tab_"+w2utils.escapeId(a.id)+" > div").css("width",b+"px")},1);setTimeout(function(){e.insert(c,
a)},200)}}};$.extend(d.prototype,w2utils.event);w2obj.tabs=d})();
(function(){var d=function(c){this.name=this.box=null;this.routeData={};this.items=[];this.right="";this.onDestroy=this.onResize=this.onRefresh=this.onRender=this.onClick=null;$.extend(!0,this,w2obj.toolbar,c)};$.fn.w2toolbar=function(c){if("object"!==typeof c&&c){if(w2ui[$(this).attr("name")]){var a=w2ui[$(this).attr("name")];a[c].apply(a,Array.prototype.slice.call(arguments,1));return this}console.log("ERROR: Method "+c+" does not exist on jQuery.w2toolbar")}else if(w2utils.checkName(c,"w2toolbar")){var a=
c.items||[],b=new d(c);$.extend(b,{items:[],handlers:[]});for(var e=0;e<a.length;e++)b.items[e]=$.extend({},d.prototype.item,a[e]);0!==$(this).length&&b.render($(this)[0]);return w2ui[b.name]=b}};d.prototype={item:{id:null,type:"button",text:"",route:null,html:"",img:null,icon:null,count:null,hidden:!1,disabled:!1,checked:!1,arrow:!0,hint:"",group:null,items:null,overlay:{},onClick:null},add:function(c){this.insert(null,c)},insert:function(c,a){$.isArray(a)||(a=[a]);for(var b=0;b<a.length;b++){if("undefined"===
typeof a[b].type){console.log('ERROR: The parameter "type" is required but not supplied in w2toolbar.add() method.');break}if(-1===$.inArray(String(a[b].type),"button check radio drop menu break html spacer".split(" "))){console.log('ERROR: The parameter "type" should be one of the following [button, check, radio, drop, menu, break, html, spacer] in w2toolbar.add() method.');break}if("undefined"===typeof a[b].id){console.log('ERROR: The parameter "id" is required but not supplied in w2toolbar.add() method.');
break}if(!w2utils.checkUniqueId(a[b].id,this.items,"toolbar items",this.name))break;var e=$.extend({},d.prototype.item,a[b]);if(null==c)this.items.push(e);else{var f=this.get(c,!0);this.items=this.items.slice(0,f).concat([e],this.items.slice(f))}this.refresh(e.id)}},remove:function(){for(var c=0,a=0;a<arguments.length;a++){var b=this.get(arguments[a]);b&&(c++,$(this.box).find("#tb_"+this.name+"_item_"+w2utils.escapeId(b.id)).remove(),(b=this.get(b.id,!0))&&this.items.splice(b,1))}return c},set:function(c,
a){var b=this.get(c,!0);if(null===b)return!1;$.extend(this.items[b],a);this.refresh(c);return!0},get:function(c,a){if(0===arguments.length){for(var b=[],e=0;e<this.items.length;e++)null!==this.items[e].id&&b.push(this.items[e].id);return b}for(b=0;b<this.items.length;b++)if(this.items[b].id===c)return!0===a?b:this.items[b];return null},show:function(){for(var c=this,a=0,b=[],e=0;e<arguments.length;e++){var d=this.get(arguments[e]);d&&(a++,d.hidden=!1,b.push(d.id))}setTimeout(function(){for(var a in b)c.refresh(b[a])},
15);return a},hide:function(){for(var c=this,a=0,b=[],e=0;e<arguments.length;e++){var d=this.get(arguments[e]);d&&(a++,d.hidden=!0,b.push(d.id))}setTimeout(function(){for(var a in b)c.refresh(b[a])},15);return a},enable:function(){for(var c=this,a=0,b=[],e=0;e<arguments.length;e++){var d=this.get(arguments[e]);d&&(a++,d.disabled=!1,b.push(d.id))}setTimeout(function(){for(var a in b)c.refresh(b[a])},15);return a},disable:function(){for(var c=this,a=0,b=[],e=0;e<arguments.length;e++){var d=this.get(arguments[e]);
d&&(a++,d.disabled=!0,b.push(d.id))}setTimeout(function(){for(var a in b)c.refresh(b[a])},15);return a},check:function(){for(var c=this,a=0,b=[],e=0;e<arguments.length;e++){var d=this.get(arguments[e]);d&&(a++,d.checked=!0,b.push(d.id))}setTimeout(function(){for(var a in b)c.refresh(b[a])},15);return a},uncheck:function(){for(var c=this,a=0,b=[],e=0;e<arguments.length;e++){var d=this.get(arguments[e]);d&&(a++,d.checked=!1,b.push(d.id))}setTimeout(function(){for(var a in b)c.refresh(b[a])},15);return a},
render:function(c){var a=(new Date).getTime(),b=this.trigger({phase:"before",type:"render",target:this.name,box:c});if(!0!==b.isCancelled&&(null!=c&&(0<$(this.box).find("> table #tb_"+this.name+"_right").length&&$(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-toolbar").html(""),this.box=c),this.box)){c='<table cellspacing="0" cellpadding="0" width="100%"><tr>';for(var e=0;e<this.items.length;e++){var d=this.items[e];null==d.id&&(d.id="item_"+e);null!==d&&(c="spacer"===d.type?c+('<td width="100%" id="tb_'+
this.name+"_item_"+d.id+'" align="right"></td>'):c+('<td id="tb_'+this.name+"_item_"+d.id+'" style="'+(d.hidden?"display: none":"")+'"     class="'+(d.disabled?"disabled":"")+'" valign="middle">'+this.getItemHTML(d)+"</td>"))}c+='<td width="100%" id="tb_'+this.name+'_right" align="right">'+this.right+"</td>";c+="</tr></table>";$(this.box).attr("name",this.name).addClass("w2ui-reset w2ui-toolbar").html(c);0<$(this.box).length&&($(this.box)[0].style.cssText+=this.style);this.trigger($.extend(b,{phase:"after"}));
return(new Date).getTime()-a}},refresh:function(c){var a=(new Date).getTime(),b=this.trigger({phase:"before",type:"refresh",target:"undefined"!==typeof c?c:this.name,item:this.get(c)});if(!0!==b.isCancelled){if(null==c)for(var e=0;e<this.items.length;e++){var d=this.items[e];null==d.id&&(d.id="item_"+e);this.refresh(d.id)}e=this.get(c);if(null===e)return!1;var d=$(this.box).find("#tb_"+this.name+"_item_"+w2utils.escapeId(e.id)),g=this.getItemHTML(e);0===d.length?(g="spacer"===e.type?'<td width="100%" id="tb_'+
this.name+"_item_"+e.id+'" align="right"></td>':'<td id="tb_'+this.name+"_item_"+e.id+'" style="'+(e.hidden?"display: none":"")+'"     class="'+(e.disabled?"disabled":"")+'" valign="middle">'+g+"</td>",this.get(c,!0)===this.items.length-1?$(this.box).find("#tb_"+this.name+"_right").before(g):$(this.box).find("#tb_"+this.name+"_item_"+w2utils.escapeId(this.items[parseInt(this.get(c,!0))+1].id)).before(g)):(d.html(g),e.hidden?d.css("display","none"):d.css("display",""),e.disabled?d.addClass("disabled"):
d.removeClass("disabled"));this.trigger($.extend(b,{phase:"after"}));return(new Date).getTime()-a}},resize:function(){var c=(new Date).getTime(),a=this.trigger({phase:"before",type:"resize",target:this.name});if(!0!==a.isCancelled)return this.trigger($.extend(a,{phase:"after"})),(new Date).getTime()-c},destroy:function(){var c=this.trigger({phase:"before",type:"destroy",target:this.name});!0!==c.isCancelled&&(0<$(this.box).find("> table #tb_"+this.name+"_right").length&&$(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-toolbar").html(""),
$(this.box).html(""),delete w2ui[this.name],this.trigger($.extend(c,{phase:"after"})))},getItemHTML:function(c){var a="";"undefined"!==typeof c.caption&&(c.text=c.caption);"undefined"===typeof c.hint&&(c.hint="");"undefined"===typeof c.text&&(c.text="");switch(c.type){case "menu":case "button":case "check":case "radio":case "drop":var b="<td>&nbsp;</td>";c.img&&(b='<td><div class="w2ui-tb-image w2ui-icon '+c.img+'"></div></td>');c.icon&&(b='<td><div class="w2ui-tb-image"><span class="'+c.icon+'"></span></div></td>');
a+='<table cellpadding="0" cellspacing="0" title="'+c.hint+'" class="w2ui-button '+(c.checked?"checked":"")+'"        onclick     = "var el=w2ui[\''+this.name+"']; if (el) el.click('"+c.id+'\', event);"        onmouseover = "'+(c.disabled?"":"$(this).addClass('over');")+'"       onmouseout  = "'+(c.disabled?"":"$(this).removeClass('over').removeClass('down');")+'"       onmousedown = "'+(c.disabled?"":"$(this).addClass('down');")+'"       onmouseup   = "'+(c.disabled?"":"$(this).removeClass('down');")+
'"><tr><td>  <table cellpadding="1" cellspacing="0">  <tr>'+b+(""!==c.text?'<td class="w2ui-tb-caption" nowrap>'+c.text+"</td>":"")+(null!=c.count?'<td class="w2ui-tb-count" nowrap><span>'+c.count+"</span></td>":"")+("drop"!==c.type&&"menu"!==c.type||!1===c.arrow?"":'<td class="w2ui-tb-down" nowrap><div></div></td>')+"  </tr></table></td></tr></table>";break;case "break":a+='<table cellpadding="0" cellspacing="0"><tr>    <td><div class="w2ui-break">&nbsp;</div></td></tr></table>';break;case "html":a+=
'<table cellpadding="0" cellspacing="0"><tr>    <td nowrap>'+c.html+"</td></tr></table>"}b="";"function"===typeof c.onRender&&(b=c.onRender.call(this,c.id,a));"function"===typeof this.onRender&&(b=this.onRender(c.id,a));""!==b&&null!=b&&(a=b);return a},menuClick:function(c){if(c.item&&!c.item.disabled){var a=this.trigger({phase:"before",type:"click",target:c.item.id+":"+c.subItem.id,item:c.item,subItem:c.subItem,originalEvent:c.originalEvent});if(!0!==a.isCancelled){c=c.subItem;if(c.route){var b=
String("/"+c.route).replace(/\/{2,}/g,"/");c=w2utils.parseRoute(b);if(0<c.keys.length)for(var e=0;e<c.keys.length;e++)null!=this.routeData[c.keys[e].name]&&(b=b.replace(new RegExp(":"+c.keys[e].name,"g"),this.routeData[c.keys[e].name]));setTimeout(function(){window.location.hash=b},1)}this.trigger($.extend(a,{phase:"after"}))}}},click:function(c,a){var b=this,e=this.get(c);if(e&&!e.disabled){var d=this.trigger({phase:"before",type:"click",target:"undefined"!==typeof c?c:this.name,item:e,object:e,
originalEvent:a});if(!0!==d.isCancelled){var g=$("#tb_"+this.name+"_item_"+w2utils.escapeId(e.id)+" table.w2ui-button");g.removeClass("down");if("radio"===e.type){for(var k=0;k<this.items.length;k++){var h=this.items[k];null!=h&&h.id!==e.id&&"radio"===h.type&&h.group===e.group&&h.checked&&(h.checked=!1,this.refresh(h.id))}e.checked=!0;g.addClass("checked")}if("drop"===e.type||"menu"===e.type)e.checked?e.checked=!1:setTimeout(function(){function a(){$(document).off("click",a);e.checked=!1;g.removeClass("checked")}
var c=$("#tb_"+b.name+"_item_"+w2utils.escapeId(e.id));$.isPlainObject(e.overlay)||(e.overlay={});var d=(c.width()-50)/2;19<d&&(d=19);"drop"===e.type&&c.w2overlay(e.html,$.extend({left:d,top:3},e.overlay));"menu"===e.type&&c.w2menu(e.items,$.extend({left:d,top:3},e.overlay,{select:function(c){b.menuClick({item:e,subItem:c.item,originalEvent:c.originalEvent});a()}}));$(document).on("click",a)},1);if("check"===e.type||"drop"===e.type||"menu"===e.type)e.checked=!e.checked,e.checked?g.addClass("checked"):
g.removeClass("checked");if(e.route){var l=String("/"+e.route).replace(/\/{2,}/g,"/"),k=w2utils.parseRoute(l);if(0<k.keys.length)for(h=0;h<k.keys.length;h++)l=l.replace(new RegExp(":"+k.keys[h].name,"g"),this.routeData[k.keys[h].name]);setTimeout(function(){window.location.hash=l},1)}this.trigger($.extend(d,{phase:"after"}))}}}};$.extend(d.prototype,w2utils.event);w2obj.toolbar=d})();
(function(){var d=function(c){this.parent=this.sidebar=this.box=this.name=null;this.nodes=[];this.menu=[];this.routeData={};this.icon=this.img=this.selected=null;this.bottomHTML=this.topHTML=this.style="";this.keyboard=!0;this.onDestroy=this.onResize=this.onRefresh=this.onRender=this.onKeydown=this.onCollapse=this.onExpand=this.onMenuClick=this.onContextMenu=this.onDblClick=this.onClick=null;$.extend(!0,this,w2obj.sidebar,c)};$.fn.w2sidebar=function(c){if("object"!==typeof c&&c){if(w2ui[$(this).attr("name")]){var a=
w2ui[$(this).attr("name")];a[c].apply(a,Array.prototype.slice.call(arguments,1));return this}console.log("ERROR: Method "+c+" does not exist on jQuery.w2sidebar")}else if(w2utils.checkName(c,"w2sidebar")){var a=c.nodes,b=new d(c);$.extend(b,{handlers:[],nodes:[]});"undefined"!=typeof a&&b.add(b,a);0!==$(this).length&&b.render($(this)[0]);b.sidebar=b;return w2ui[b.name]=b}};d.prototype={node:{id:null,text:"",count:null,img:null,icon:null,nodes:[],style:"",route:null,selected:!1,expanded:!1,hidden:!1,
disabled:!1,group:!1,groupShowHide:!0,plus:!1,onClick:null,onDblClick:null,onContextMenu:null,onExpand:null,onCollapse:null,parent:null,sidebar:null},add:function(c,a){1==arguments.length&&(a=arguments[0],c=this);"string"==typeof c&&(c=this.get(c));return this.insert(c,null,a)},insert:function(c,a,b){var e,f,g,k;if(2==arguments.length){b=arguments[1];a=arguments[0];e=this.get(a);if(null===e)return $.isArray(b)||(b=[b]),e=null!=b[0].caption?b[0].caption:b[0].text,console.log('ERROR: Cannot insert node "'+
e+'" because cannot find node "'+a+'" to insert before.'),null;c=this.get(a).parent}"string"==typeof c&&(c=this.get(c));$.isArray(b)||(b=[b]);for(var h in b)if(g=b[h],null==typeof g.id)e=null!=g.caption?g.caption:g.text,console.log('ERROR: Cannot insert node "'+e+'" because it has no id.');else if(null!==this.get(this,g.id))e=null!=g.caption?g.caption:g.text,console.log("ERROR: Cannot insert node with id="+g.id+" (text: "+e+") because another node with the same id already exists.");else{f=$.extend({},
d.prototype.node,g);f.sidebar=this;f.parent=c;k=f.nodes||[];f.nodes=[];if(null===a)c.nodes.push(f);else{e=this.get(c,a,!0);if(null===e)return e=null!=g.caption?g.caption:g.text,console.log('ERROR: Cannot insert node "'+e+'" because cannot find node "'+a+'" to insert before.'),null;c.nodes.splice(e,0,f)}0<k.length&&this.insert(f,null,k)}this.refresh(c.id);return f},remove:function(){for(var c=0,a,b=0;b<arguments.length;b++)if(a=this.get(arguments[b]),null!==a){null!==this.selected&&this.selected===
a.id&&(this.selected=null);var e=this.get(a.parent,arguments[b],!0);null!==e&&(a.parent.nodes[e].selected&&a.sidebar.unselect(a.id),a.parent.nodes.splice(e,1),c++)}0<c&&1==arguments.length?this.refresh(a.parent.id):this.refresh();return c},set:function(c,a,b){2==arguments.length&&(b=a,a=c,c=this);"string"==typeof c&&(c=this.get(c));if(null==c.nodes)return null;for(var e=0;e<c.nodes.length;e++){if(c.nodes[e].id===a){var d=b.nodes;$.extend(c.nodes[e],b,{nodes:[]});null!=d&&this.add(c.nodes[e],d);this.refresh(a);
return!0}if(this.set(c.nodes[e],a,b))return!0}return!1},get:function(c,a,b){if(0===arguments.length){for(var e=[],d=this.find({}),g=0;g<d.length;g++)null!=d[g].id&&e.push(d[g].id);return e}if(1==arguments.length||2==arguments.length&&!0===a)b=a,a=c,c=this;"string"==typeof c&&(c=this.get(c));if(null==c.nodes)return null;for(e=0;e<c.nodes.length;e++){if(c.nodes[e].id==a)return!0===b?e:c.nodes[e];if((d=this.get(c.nodes[e],a,b))||0===d)return d}return null},find:function(c,a,b){1==arguments.length&&(a=
c,c=this);b||(b=[]);"string"==typeof c&&(c=this.get(c));if(null==c.nodes)return b;for(var e=0;e<c.nodes.length;e++){var d=!0,g;for(g in a)c.nodes[e][g]!=a[g]&&(d=!1);d&&b.push(c.nodes[e]);0<c.nodes[e].nodes.length&&(b=this.find(c.nodes[e],a,b))}return b},hide:function(){for(var c=0,a=0;a<arguments.length;a++){var b=this.get(arguments[a]);null!==b&&(b.hidden=!0,c++)}1==arguments.length?this.refresh(arguments[0]):this.refresh();return c},show:function(){for(var c=0,a=0;a<arguments.length;a++){var b=
this.get(arguments[a]);null!==b&&(b.hidden=!1,c++)}1==arguments.length?this.refresh(arguments[0]):this.refresh();return c},disable:function(){for(var c=0,a=0;a<arguments.length;a++){var b=this.get(arguments[a]);null!==b&&(b.disabled=!0,b.selected&&this.unselect(b.id),c++)}1==arguments.length?this.refresh(arguments[0]):this.refresh();return c},enable:function(){for(var c=0,a=0;a<arguments.length;a++){var b=this.get(arguments[a]);null!==b&&(b.disabled=!1,c++)}1==arguments.length?this.refresh(arguments[0]):
this.refresh();return c},select:function(c){var a=this.get(c);if(!a||this.selected==c&&a.selected)return!1;this.unselect(this.selected);$(this.box).find("#node_"+w2utils.escapeId(c)).addClass("w2ui-selected").find(".w2ui-icon").addClass("w2ui-icon-selected");a.selected=!0;this.selected=c;return!0},unselect:function(c){var a=this.get(c);if(!a)return!1;a.selected=!1;$(this.box).find("#node_"+w2utils.escapeId(c)).removeClass("w2ui-selected").find(".w2ui-icon").removeClass("w2ui-icon-selected");this.selected==
c&&(this.selected=null);return!0},toggle:function(c){var a=this.get(c);if(null===a)return!1;if(a.plus)this.set(c,{plus:!1}),this.expand(c),this.refresh(c);else return 0===a.nodes.length?!1:this.get(c).expanded?this.collapse(c):this.expand(c)},collapse:function(c){var a=this,b=this.get(c),e=this.trigger({phase:"before",type:"collapse",target:c,object:b});if(!0!==e.isCancelled)return $(this.box).find("#node_"+w2utils.escapeId(c)+"_sub").slideUp(200),$(this.box).find("#node_"+w2utils.escapeId(c)+" .w2ui-node-dots:first-child").html('<div class="w2ui-expand">+</div>'),
b.expanded=!1,this.trigger($.extend(e,{phase:"after"})),setTimeout(function(){a.refresh(c)},200),!0},collapseAll:function(c){"undefined"==typeof c&&(c=this);"string"==typeof c&&(c=this.get(c));if(null==c.nodes)return!1;for(var a=0;a<c.nodes.length;a++)!0===c.nodes[a].expanded&&(c.nodes[a].expanded=!1),c.nodes[a].nodes&&0<c.nodes[a].nodes.length&&this.collapseAll(c.nodes[a]);this.refresh(c.id);return!0},expand:function(c){var a=this,b=this.get(c),e=this.trigger({phase:"before",type:"expand",target:c,
object:b});if(!0!==e.isCancelled)return $(this.box).find("#node_"+w2utils.escapeId(c)+"_sub").slideDown(200),$(this.box).find("#node_"+w2utils.escapeId(c)+" .w2ui-node-dots:first-child").html('<div class="w2ui-expand">-</div>'),b.expanded=!0,this.trigger($.extend(e,{phase:"after"})),setTimeout(function(){a.refresh(c)},200),!0},expandAll:function(c){"undefined"==typeof c&&(c=this);"string"==typeof c&&(c=this.get(c));if(null==c.nodes)return!1;for(var a=0;a<c.nodes.length;a++)!1===c.nodes[a].expanded&&
(c.nodes[a].expanded=!0),c.nodes[a].nodes&&0<c.nodes[a].nodes.length&&this.collapseAll(c.nodes[a]);this.refresh(c.id)},expandParents:function(c){var a=this.get(c);if(null===a)return!1;a.parent&&(a.parent.expanded=!0,this.expandParents(a.parent.id));this.refresh(c);return!0},click:function(c,a){var b=this,e=this.get(c);if(null!==e&&!e.disabled&&!e.group){$(b.box).find(".w2ui-node.w2ui-selected").each(function(a,c){var e=$(c).attr("id").replace("node_",""),e=b.get(e);null!=e&&(e.selected=!1);$(c).removeClass("w2ui-selected").find(".w2ui-icon").removeClass("w2ui-icon-selected")});
var d=$(b.box).find("#node_"+w2utils.escapeId(c)),g=$(b.box).find("#node_"+w2utils.escapeId(b.selected));d.addClass("w2ui-selected").find(".w2ui-icon").addClass("w2ui-icon-selected");setTimeout(function(){var k=b.trigger({phase:"before",type:"click",target:c,originalEvent:a,node:e,object:e});if(!0===k.isCancelled)d.removeClass("w2ui-selected").find(".w2ui-icon").removeClass("w2ui-icon-selected"),g.addClass("w2ui-selected").find(".w2ui-icon").addClass("w2ui-icon-selected");else{null!==g&&(g.selected=
!1);b.get(c).selected=!0;b.selected=c;if(e.route){var h=String("/"+e.route).replace(/\/{2,}/g,"/"),l=w2utils.parseRoute(h);if(0<l.keys.length)for(var m=0;m<l.keys.length;m++)null!=b.routeData[l.keys[m].name]&&(h=h.replace(new RegExp(":"+l.keys[m].name,"g"),b.routeData[l.keys[m].name]));setTimeout(function(){window.location.hash=h},1)}b.trigger($.extend(k,{phase:"after"}))}},1)}},keydown:function(c){function a(a,b){null===a||a.hidden||a.disabled||a.group||(k.click(a.id,b),setTimeout(function(){k.scrollIntoView()},
50))}function b(a,b){for(a=b(a);null!==a&&(a.hidden||a.disabled)&&!a.group;)a=b(a);return a}function e(a,b){if(null===a)return null;var c=a.parent,d=k.get(a.id,!0),f=null;a.expanded&&0<a.nodes.length&&!0!==b?(c=a.nodes[0],f=c.hidden||c.disabled||c.group?e(c):c):f=c&&d+1<c.nodes.length?c.nodes[d+1]:e(c,!0);null!==f&&(f.hidden||f.disabled||f.group)&&(f=e(f));return f}function d(a){if(null===a)return null;var b=a.parent;a=k.get(a.id,!0);b=0<a?g(b.nodes[a-1]):b;null!==b&&(b.hidden||b.disabled||b.group)&&
(b=d(b));return b}function g(a){return a.expanded&&0<a.nodes.length?(a=a.nodes[a.nodes.length-1],a.hidden||a.disabled||a.group?d(a):g(a)):a}var k=this,h=k.get(k.selected);if(h&&!0===k.keyboard){var l=k.trigger({phase:"before",type:"keydown",target:k.name,originalEvent:c});!0!==l.isCancelled&&((13==c.keyCode||32==c.keyCode)&&0<h.nodes.length&&k.toggle(k.selected),37==c.keyCode&&(0<h.nodes.length&&h.expanded?k.collapse(k.selected):(a(h.parent),h.parent.group||k.collapse(h.parent.id))),39==c.keyCode&&
(0<h.nodes.length||h.plus)&&!h.expanded&&k.expand(k.selected),38==c.keyCode&&a(b(h,d)),40==c.keyCode&&a(b(h,e)),-1!=$.inArray(c.keyCode,[13,32,37,38,39,40])&&(c.preventDefault&&c.preventDefault(),c.stopPropagation&&c.stopPropagation()),k.trigger($.extend(l,{phase:"after"})))}},scrollIntoView:function(c){"undefined"==typeof c&&(c=this.selected);if(null!==this.get(c)){var a=$(this.box).find(".w2ui-sidebar-div");c=$(this.box).find("#node_"+w2utils.escapeId(c));var b=c.offset().top-a.offset().top;b+c.height()>
a.height()&&a.animate({scrollTop:a.scrollTop()+a.height()/1.3},250,"linear");0>=b&&a.animate({scrollTop:a.scrollTop()-a.height()/1.3},250,"linear")}},dblClick:function(c,a){var b=this.get(c),b=this.trigger({phase:"before",type:"dblClick",target:c,originalEvent:a,object:b});!0!==b.isCancelled&&(this.toggle(c),this.trigger($.extend(b,{phase:"after"})))},contextMenu:function(c,a){var b=this,e=b.get(c);c!=b.selected&&b.click(c);setTimeout(function(){var d=b.trigger({phase:"before",type:"contextMenu",
target:c,originalEvent:a,object:e});!0===d.isCancelled||e.group||e.disabled||(0<b.menu.length&&$(b.box).find("#node_"+w2utils.escapeId(c)).w2menu(b.menu,{left:(a?a.offsetX||a.pageX:50)-25,onSelect:function(a){b.menuClick(c,parseInt(a.index),a.originalEvent)}}),b.trigger($.extend(d,{phase:"after"})))},150)},menuClick:function(c,a,b){c=this.trigger({phase:"before",type:"menuClick",target:c,originalEvent:b,menuIndex:a,menuItem:this.menu[a]});!0!==c.isCancelled&&this.trigger($.extend(c,{phase:"after"}))},
render:function(c){var a=(new Date).getTime(),b=this.trigger({phase:"before",type:"render",target:this.name,box:c});if(!0!==b.isCancelled&&("undefined"!=typeof c&&null!==c&&(0<$(this.box).find("> div > div.w2ui-sidebar-div").length&&$(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-sidebar").html(""),this.box=c),this.box))return $(this.box).attr("name",this.name).addClass("w2ui-reset w2ui-sidebar").html('<div><div class="w2ui-sidebar-top"></div><div class="w2ui-sidebar-div"></div><div class="w2ui-sidebar-bottom"></div></div>'),
$(this.box).find("> div").css({width:$(this.box).width()+"px",height:$(this.box).height()+"px"}),0<$(this.box).length&&($(this.box)[0].style.cssText+=this.style),""!==this.topHTML&&($(this.box).find(".w2ui-sidebar-top").html(this.topHTML),$(this.box).find(".w2ui-sidebar-div").css("top",$(this.box).find(".w2ui-sidebar-top").height()+"px")),""!==this.bottomHTML&&($(this.box).find(".w2ui-sidebar-bottom").html(this.bottomHTML),$(this.box).find(".w2ui-sidebar-div").css("bottom",$(this.box).find(".w2ui-sidebar-bottom").height()+
"px")),this.trigger($.extend(b,{phase:"after"})),this.refresh(),(new Date).getTime()-a},refresh:function(c){function a(a){var b="",b=a.img;null===b&&(b=this.img);var c=a.icon;null===c&&(c=this.icon);for(var e=a.parent,g=0;e&&null!==e.parent;)e.group&&g--,e=e.parent,g++;"undefined"!=typeof a.caption&&(a.text=a.caption);a.group?b='<div class="w2ui-node-group"  id="node_'+a.id+'"        onclick="w2ui[\''+d.name+"'].toggle('"+a.id+"')\"        onmouseout=\"$(this).find('span:nth-child(1)').css('color', 'transparent')\"         onmouseover=\"$(this).find('span:nth-child(1)').css('color', 'inherit')\">"+
(a.groupShowHide?"<span>"+(!a.hidden&&a.expanded?w2utils.lang("Hide"):w2utils.lang("Show"))+"</span>":"<span></span>")+"    <span>"+a.text+'</span></div><div class="w2ui-node-sub" id="node_'+a.id+'_sub" style="'+a.style+";"+(!a.hidden&&a.expanded?"":"display: none;")+'"></div>':(a.selected&&!a.disabled&&(d.selected=a.id),e="",b&&(e='<div class="w2ui-node-image w2ui-icon '+b+(a.selected&&!a.disabled?" w2ui-icon-selected":"")+'"></div>'),c&&(e='<div class="w2ui-node-image"><span class="'+c+'"></span></div>'),
b='<div class="w2ui-node '+(a.selected?"w2ui-selected":"")+" "+(a.disabled?"w2ui-disabled":"")+'" id="node_'+a.id+'" style="'+(a.hidden?"display: none;":"")+'"    onClick="w2ui[\''+d.name+"'].dblClick('"+a.id+"', event);w2ui['"+d.name+"'].click('"+a.id+"', event);\"    oncontextmenu=\"w2ui['"+d.name+"'].contextMenu('"+a.id+'\', event);         if (event.preventDefault) event.preventDefault();"     "><table cellpadding="0" cellspacing="0" style="margin-left:'+18*g+"px; padding-right:"+18*g+'px"><tr><td class="w2ui-node-dots" nowrap onclick="w2ui[\''+
d.name+"'].toggle('"+a.id+'\');         if (event.stopPropagation) event.stopPropagation(); else event.cancelBubble = true;">    <div class="w2ui-expand">'+(0<a.nodes.length?a.expanded?"-":"+":a.plus?"+":"")+'</div></td><td class="w2ui-node-data" nowrap>'+e+(a.count||0===a.count?'<div class="w2ui-node-count">'+a.count+"</div>":"")+'<div class="w2ui-node-caption">'+a.text+'</div></td></tr></table></div><div class="w2ui-node-sub" id="node_'+a.id+'_sub" style="'+a.style+";"+(!a.hidden&&a.expanded?"":
"display: none;")+'"></div>');return b}var b=(new Date).getTime(),e=this.trigger({phase:"before",type:"refresh",target:"undefined"!=typeof c?c:this.name});if(!0!==e.isCancelled){""!==this.topHTML&&($(this.box).find(".w2ui-sidebar-top").html(this.topHTML),$(this.box).find(".w2ui-sidebar-div").css("top",$(this.box).find(".w2ui-sidebar-top").height()+"px"));""!==this.bottomHTML&&($(this.box).find(".w2ui-sidebar-bottom").html(this.bottomHTML),$(this.box).find(".w2ui-sidebar-div").css("bottom",$(this.box).find(".w2ui-sidebar-bottom").height()+
"px"));$(this.box).find("> div").css({width:$(this.box).width()+"px",height:$(this.box).height()+"px"});var d=this,g,k;if("undefined"==typeof c)c=this,k=".w2ui-sidebar-div";else{c=this.get(c);if(null===c)return;k="#node_"+w2utils.escapeId(c.id)+"_sub"}var h;c!==this&&(g="#node_"+w2utils.escapeId(c.id),h=a(c),$(this.box).find(g).before('<div id="sidebar_'+this.name+'_tmp"></div>'),$(this.box).find(g).remove(),$(this.box).find(k).remove(),$("#sidebar_"+this.name+"_tmp").before(h),$("#sidebar_"+this.name+
"_tmp").remove());$(this.box).find(k).html("");for(var l=0;l<c.nodes.length;l++)g=c.nodes[l],h=a(g),$(this.box).find(k).append(h),0!==g.nodes.length&&this.refresh(g.id);this.trigger($.extend(e,{phase:"after"}));return(new Date).getTime()-b}},resize:function(){var c=(new Date).getTime(),a=this.trigger({phase:"before",type:"resize",target:this.name});if(!0!==a.isCancelled)return $(this.box).css("overflow","hidden"),$(this.box).find("> div").css({width:$(this.box).width()+"px",height:$(this.box).height()+
"px"}),this.trigger($.extend(a,{phase:"after"})),(new Date).getTime()-c},destroy:function(){var c=this.trigger({phase:"before",type:"destroy",target:this.name});!0!==c.isCancelled&&(0<$(this.box).find("> div > div.w2ui-sidebar-div").length&&$(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-sidebar").html(""),delete w2ui[this.name],this.trigger($.extend(c,{phase:"after"})))},lock:function(c,a){var b=$(this.box).find("> div:first-child"),e=Array.prototype.slice.call(arguments,0);e.unshift(b);
w2utils.lock.apply(window,e)},unlock:function(){w2utils.unlock(this.box)}};$.extend(d.prototype,w2utils.event);w2obj.sidebar=d})();
(function(d){var c=function(a){this.el=null;this.helpers={};this.type=a.type||"text";this.options=d.extend(!0,{},a);this.onSearch=a.onSearch||null;this.onRequest=a.onRequest||null;this.onLoad=a.onLoad||null;this.onError=a.onError||null;this.onClick=a.onClick||null;this.onAdd=a.onAdd||null;this.onNew=a.onNew||null;this.onRemove=a.onRemove||null;this.onMouseOver=a.onMouseOver||null;this.onMouseOut=a.onMouseOut||null;this.onIconClick=a.onIconClick||null;this.tmp={};delete this.options.type;delete this.options.onSearch;
delete this.options.onRequest;delete this.options.onLoad;delete this.options.onError;delete this.options.onClick;delete this.options.onMouseOver;delete this.options.onMouseOut;delete this.options.onIconClick;d.extend(!0,this,w2obj.field)};d.fn.w2field=function(a,b){if(0==this.length){var e=c.prototype;if(e[a])return e[a].apply(e,Array.prototype.slice.call(arguments,1))}else{if(0==arguments.length)return d(this).data("w2field");"string"==typeof a&&"object"==typeof b&&(a=d.extend(!0,{},b,{type:a}));
"string"==typeof a&&"undefined"==typeof b&&(a={type:a});a.type=String(a.type).toLowerCase();return this.each(function(b,e){var k=d(e).data("w2field");if("undefined"==typeof k)return k=new c(a),d.extend(k,{handlers:[]}),e&&(k.el=d(e)[0]),k.init(),d(e).data("w2field",k),k;k.clear();if("clear"!=a.type)return k=new c(a),d.extend(k,{handlers:[]}),e&&(k.el=d(e)[0]),k.init(),d(e).data("w2field",k),k})}};c.prototype={custom:{},pallete:["000000 444444 666666 999999 CCCCCC EEEEEE F3F3F3 FFFFFF".split(" "),
"FF011B FF9838 FFFD59 01FD55 00FFFE 0424F3 9B24F4 FF21F5".split(" "),"F4CCCC FCE5CD FFF2CC D9EAD3 D0E0E3 CFE2F3 D9D1E9 EAD1DC".split(" "),"EA9899 F9CB9C FEE599 B6D7A8 A2C4C9 9FC5E8 B4A7D6 D5A6BD".split(" "),"E06666 F6B26B FED966 93C47D 76A5AF 6FA8DC 8E7CC3 C27BA0".split(" "),"CC0814 E69138 F1C232 6AA84F 45818E 3D85C6 674EA7 A54D79".split(" "),"99050C B45F17 BF901F 37761D 124F5C 0A5394 351C75 741B47".split(" "),"660205 783F0B 7F6011 274E12 0C343D 063762 20124D 4C1030".split(" ")],addType:function(a,
b){a=String(a).toLowerCase();this.custom[a]=b;return!0},removeType:function(a){a=String(a).toLowerCase();if(!this.custom[a])return!1;delete this.custom[a];return!0},init:function(){var a=this,b=this.options,c;if("function"==typeof this.custom[this.type])this.custom[this.type].call(this,b);else if(-1==["INPUT","TEXTAREA"].indexOf(this.el.tagName))console.log("ERROR: w2field could only be applied to INPUT or TEXTAREA.",this.el);else{switch(this.type){case "text":case "int":case "float":case "money":case "currency":case "percent":case "alphanumeric":case "hex":c=
{min:null,max:null,step:1,placeholder:"",autoFormat:!0,currencyPrefix:w2utils.settings.currencyPrefix,currencySuffix:w2utils.settings.currencySuffix,currencyPrecision:w2utils.settings.currencyPrecision,decimalSymbol:w2utils.settings.decimalSymbol,groupSymbol:w2utils.settings.groupSymbol,arrows:!1,keyboard:!0,precision:null,silent:!0,prefix:"",suffix:""};b=this.options=d.extend(!0,{},c,b);b.numberRE=new RegExp("["+b.groupSymbol+"]","g");b.moneyRE=new RegExp("["+b.currencyPrefix+b.currencySuffix+b.groupSymbol+
"]","g");b.percentRE=new RegExp("["+b.groupSymbol+"%]","g");-1!=["text","alphanumeric","hex"].indexOf(this.type)&&(b.arrows=!1,b.keyboard=!1);this.addPrefix();this.addSuffix();d(this.el).attr("placeholder")&&""==b.placeholder&&(b.placeholder=d(this.el).attr("placeholder"));d(this.el).attr("placeholder",b.placeholder);break;case "color":c={prefix:"#",suffix:'<div style="width: '+(parseInt(d(this.el).css("font-size"))||12)+'px">&nbsp;</div>',placeholder:"",arrows:!1,keyboard:!1};d.extend(b,c);this.addPrefix();
this.addSuffix();d(this.el).attr("maxlength",6);""!=d(this.el).val()&&setTimeout(function(){d(a.el).change()},1);d(this.el).attr("placeholder")&&""==b.placeholder&&(b.placeholder=d(this.el).attr("placeholder"));d(this.el).attr("placeholder",b.placeholder);break;case "date":c={format:w2utils.settings.date_format,placeholder:"",keyboard:!0,silent:!0,start:"",end:"",blocked:{},colored:{}};b=this.options=d.extend(!0,{},c,b);d(this.el).attr("placeholder")&&""==b.placeholder&&(b.placeholder=d(this.el).attr("placeholder"));
d(this.el).attr("placeholder",b.placeholder?b.placeholder:b.format);break;case "time":c={format:w2utils.settings.time_format,placeholder:"",keyboard:!0,silent:!0,start:"",end:""};b=this.options=d.extend(!0,{},c,b);d(this.el).attr("placeholder")&&""==b.placeholder&&(b.placeholder=d(this.el).attr("placeholder"));d(this.el).attr("placeholder",b.placeholder?b.placeholder:"h12"==b.format?"hh:mi pm":"hh:mi");break;case "list":case "combo":c={items:[],selected:{},placeholder:"",url:null,postData:{},minLength:1,
cacheMax:250,maxDropHeight:350,match:"begins",silent:!0,icon:null,iconStyle:"",onSearch:null,onRequest:null,onLoad:null,onError:null,onIconClick:null,renderDrop:null,prefix:"",suffix:"",openOnFocus:!1,markSearch:!1};b.items=this.normMenu(b.items);if("list"==this.type&&(c.openOnFocus=!0,c.suffix='<div class="arrow-down" style="margin-top: '+(parseInt(d(this.el).height())-6)/2+'px;"></div>',d(this.el).addClass("w2ui-select"),!d.isPlainObject(b.selected)))for(var f in b.items){var g=b.items[f];if(g&&
g.id==b.selected){b.selected=d.extend(!0,{},g);break}}this.options=b=d.extend({},c,b,{align:"both",altRows:!0});d.isPlainObject(b.selected)||(b.selected={});d(this.el).data("selected",b.selected);b.url&&this.request(0);"list"==this.type&&this.addFocus();this.addPrefix();this.addSuffix();setTimeout(function(){a.refresh()},10);d(this.el).attr("placeholder")&&""==b.placeholder&&(b.placeholder=d(this.el).attr("placeholder"));d(this.el).attr("placeholder",b.placeholder).attr("autocomplete","off");"undefined"!=
typeof b.selected.text&&d(this.el).val(b.selected.text);break;case "enum":c={items:[],selected:[],placeholder:"",max:0,url:null,postData:{},minLength:1,cacheMax:250,maxWidth:250,maxHeight:350,maxDropHeight:350,match:"contains",silent:!0,openOnFocus:!1,markSearch:!0,renderDrop:null,renderItem:null,style:"",onSearch:null,onRequest:null,onLoad:null,onError:null,onClick:null,onAdd:null,onNew:null,onRemove:null,onMouseOver:null,onMouseOut:null};b=d.extend({},c,b,{align:"both",suffix:"",altRows:!0});b.items=
this.normMenu(b.items);b.selected=this.normMenu(b.selected);this.options=b;d.isArray(b.selected)||(b.selected=[]);d(this.el).data("selected",b.selected);b.url&&this.request(0);this.addSuffix();this.addMulti();break;case "file":c={selected:[],placeholder:w2utils.lang("Attach files by dragging and dropping or Click to Select"),max:0,maxSize:0,maxFileSize:0,maxWidth:250,maxHeight:350,maxDropHeight:350,silent:!0,renderItem:null,style:"",onClick:null,onAdd:null,onRemove:null,onMouseOver:null,onMouseOut:null},
this.options=b=d.extend({},c,b,{align:"both",altRows:!0}),d.isArray(b.selected)||(b.selected=[]),d(this.el).data("selected",b.selected),d(this.el).attr("placeholder")&&(b.placeholder=d(this.el).attr("placeholder")),this.addMulti()}this.tmp={onChange:function(b){a.change.call(a,b)},onClick:function(b){a.click.call(a,b)},onFocus:function(b){a.focus.call(a,b)},onBlur:function(b){a.blur.call(a,b)},onKeydown:function(b){a.keyDown.call(a,b)},onKeyup:function(b){a.keyUp.call(a,b)},onKeypress:function(b){a.keyPress.call(a,
b)}};d(this.el).addClass("w2field").data("w2field",this).on("change",this.tmp.onChange).on("click",this.tmp.onClick).on("focus",this.tmp.onFocus).on("blur",this.tmp.onBlur).on("keydown",this.tmp.onKeydown).on("keyup",this.tmp.onKeyup).on("keypress",this.tmp.onKeypress).css({"box-sizing":"border-box","-webkit-box-sizing":"border-box","-moz-box-sizing":"border-box","-ms-box-sizing":"border-box","-o-box-sizing":"border-box"});this.change(d.Event("change"))}},clear:function(){var a=this.options;-1!=["money",
"currency"].indexOf(this.type)&&d(this.el).val(d(this.el).val().replace(a.moneyRE,""));"percent"==this.type&&d(this.el).val(d(this.el).val().replace(/%/g,""));"color"==this.type&&d(this.el).removeAttr("maxlength");"list"==this.type&&d(this.el).removeClass("w2ui-select");-1!=["date","time"].indexOf(this.type)&&d(this.el).attr("placeholder")==a.format&&d(this.el).attr("placeholder","");this.type="clear";a=d(this.el).data("tmp");if(this.tmp){"undefined"!=typeof a&&(a&&a["old-padding-left"]&&d(this.el).css("padding-left",
a["old-padding-left"]),a&&a["old-padding-right"]&&d(this.el).css("padding-right",a["old-padding-right"]));d(this.el).val(this.clean(d(this.el).val())).removeClass("w2field").removeData().off("change",this.tmp.onChange).off("click",this.tmp.onClick).off("focus",this.tmp.onFocus).off("blur",this.tmp.onBlur).off("keydown",this.tmp.onKeydown).off("keyup",this.tmp.onKeyup).off("keypress",this.tmp.onKeypress);for(var b in this.helpers)d(this.helpers[b]).remove();this.helpers={}}},refresh:function(){var a=
this,b=this.options,c=d(this.el).data("selected"),f=(new Date).getTime();-1!=["list"].indexOf(this.type)&&(d(a.el).parent().css("white-space","nowrap"),a.helpers.prefix&&a.helpers.prefix.hide(),setTimeout(function(){if(a.helpers.focus){!d.isEmptyObject(c)&&b.icon?b.prefix='<span class="w2ui-icon '+b.icon+'"style="cursor: pointer; font-size: 14px; display: inline-block; margin-top: -1px; color: #7F98AD;'+b.iconStyle+'"></span>':b.prefix="";a.addPrefix();var f=a.helpers.focus.find("input");""==d(f).val()?
(d(f).css("opacity",0).prev().css("opacity",0),d(a.el).val(c&&null!=c.text?c.text:""),d(a.el).attr("placeholder",b.placeholder||"")):(d(f).css("opacity",1).prev().css("opacity",1),d(a.el).val(""),d(a.el).removeAttr("placeholder"),setTimeout(function(){a.helpers.prefix&&a.helpers.prefix.hide();b.icon?(d(f).css("margin-left","17px"),d(a.helpers.focus).find(".icon-search").attr("style","position: absolute; opacity: 0; margin: 4px 0px 0px 2px; background-position: left !important;width: 11px !important; opacity: 1")):
(d(f).css("margin-left","0px"),d(a.helpers.focus).find(".icon-search").attr("style","position: absolute; opacity: 0; margin: 4px 0px 0px 2px; background-position: left !important;width: 0px !important; opacity: 0"))},1));d(a.el).prop("readonly")||d(a.el).prop("disabled")?setTimeout(function(){d(a.helpers.prefix).css("opacity","0.6");d(a.helpers.suffix).css("opacity","0.6")},1):setTimeout(function(){d(a.helpers.prefix).css("opacity","1");d(a.helpers.suffix).css("opacity","1")},1)}},1));if(-1!=["enum",
"file"].indexOf(this.type)){var g="",k;for(k in c)var h=c[k],l="",l="function"==typeof b.renderItem?b.renderItem(h,k,'<div class="w2ui-list-remove" title="'+w2utils.lang("Remove")+'" index="'+k+'">&nbsp;&nbsp;</div>'):'<div class="w2ui-list-remove" title="'+w2utils.lang("Remove")+'" index="'+k+'">&nbsp;&nbsp;</div>'+("enum"==a.type?h.text:h.name+'<span class="file-size"> - '+w2utils.size(h.size)+"</span>"),g=g+('<li index="'+k+'" style="max-width: '+parseInt(b.maxWidth)+"px; "+(h.style?h.style:"")+
'">'+l+"</li>");k=a.helpers.multi;h=k.find("ul");k.attr("style",k.attr("style")+";"+b.style);d(a.el).prop("readonly")||d(a.el).prop("disabled")?(k.addClass("w2ui-readonly"),k.css("pointer-events","none").find("li").css("opacity","0.6"),d(a.helpers.multi).find("input").prop("readonly",!0)):(k.removeClass("w2ui-readonly"),k.css("pointer-events","auto").find("li").css("opacity","1"),d(a.helpers.multi).find("input").prop("readonly",!1));k.find(".w2ui-enum-placeholder").remove();h.find("li").not("li.nomouse").remove();
""!=g?h.prepend(g):"undefined"!=typeof b.placeholder&&(g="padding-top: "+d(this.el).css("padding-top")+";padding-left: "+d(this.el).css("padding-left")+"; box-sizing: "+d(this.el).css("box-sizing")+"; line-height: "+d(this.el).css("line-height")+"; font-size: "+d(this.el).css("font-size")+"; font-family: "+d(this.el).css("font-family")+"; ",k.prepend('<div class="w2ui-enum-placeholder" style="'+g+'">'+b.placeholder+"</div>"));k.find("li").data("mouse","out").on("click",function(b){var f=c[d(b.target).attr("index")];
if(!d(b.target).hasClass("nomouse")){b.stopPropagation();var g=a.trigger({phase:"before",type:"click",target:a.el,originalEvent:b.originalEvent,item:f});if(!0!==g.isCancelled){if(d(b.target).hasClass("w2ui-list-remove")){if(d(a.el).attr("readonly")||d(a.el).attr("disabled"))return;g=a.trigger({phase:"before",type:"remove",target:a.el,originalEvent:b.originalEvent,item:f});if(!0===g.isCancelled)return;d().w2overlay();c.splice(d(b.target).attr("index"),1);d(a.el).trigger("change");d(b.target).parent().fadeOut("fast");
setTimeout(function(){a.refresh();a.trigger(d.extend(g,{phase:"after"}))},300)}if("file"==a.type&&!d(b.target).hasClass("w2ui-list-remove")){var h="";/image/i.test(f.type)&&(h='<div style="padding: 3px;">    <img src="'+(f.content?"data:"+f.type+";base64,"+f.content:"")+'" style="max-width: 300px;"         onload="var w = $(this).width(); var h = $(this).height();             if (w < 300 & h < 300) return;             if (w >= h && w > 300) $(this).width(300);            if (w < h && h > 300) $(this).height(300);"        onerror="this.style.display = \'none\'"    ></div>');
h+='<div style="padding: 8px;">    <table cellpadding="2">    <tr><td style="padding: 3px; text-align: right; color: #777;">'+w2utils.lang("Name")+':</td><td style="padding: 3px">'+f.name+'</td></tr>    <tr><td style="padding: 3px; text-align: right; color: #777;">'+w2utils.lang("Size")+':</td><td style="padding: 3px">'+w2utils.size(f.size)+'</td></tr>    <tr><td style="padding: 3px; text-align: right; color: #777;">'+w2utils.lang("Type")+':</td><td style="padding: 3px">        <span style="width: 200px; display: block-inline; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">'+
f.type+'</span>    </td></tr>    <tr><td style="padding: 3px; text-align: right; color: #777;">'+w2utils.lang("Modified")+':</td><td style="padding: 3px">'+w2utils.date(f.modified)+"</td></tr>    </table></div>";d(b.target).w2overlay(h)}a.trigger(d.extend(g,{phase:"after"}))}}}).on("mouseover",function(b){var f=b.target;"LI"!=f.tagName&&(f=f.parentNode);if(!d(f).hasClass("nomouse")){if("out"==d(f).data("mouse")){var g=c[d(f).attr("index")];b=a.trigger({phase:"before",type:"mouseOver",target:a.el,
originalEvent:b.originalEvent,item:g});if(!0===b.isCancelled)return;a.trigger(d.extend(b,{phase:"after"}))}d(f).data("mouse","over")}}).on("mouseout",function(b){var f=b.target;"LI"!=f.tagName&&(f=f.parentNode);d(f).hasClass("nomouse")||(d(f).data("mouse","leaving"),setTimeout(function(){if("leaving"==d(f).data("mouse")){d(f).data("mouse","out");var g=c[d(f).attr("index")],g=a.trigger({phase:"before",type:"f",target:a.el,originalEvent:b.originalEvent,item:g});!0!==g.isCancelled&&a.trigger(d.extend(g,
{phase:"after"}))}},0))});d(this.el).height("auto");g=d(k).find("> div").height()+2*w2utils.getSize(k,"+height");26>g&&(g=26);g>b.maxHeight&&(g=b.maxHeight);0<k.length&&(k[0].scrollTop=1E3);h=w2utils.getSize(d(this.el),"height")-2;h>g&&(g=h);d(k).css({height:g+"px",overflow:g==b.maxHeight?"auto":"hidden"});g<b.maxHeight&&d(k).prop("scrollTop",0);d(this.el).css({height:g+2+"px"})}return(new Date).getTime()-f},reset:function(){var a=this.type;this.clear();this.type=a;this.init()},clean:function(a){var b=
this.options;a=String(a).trim();-1!=["int","float","money","currency","percent"].indexOf(this.type)&&("string"==typeof a&&(a=a.replace(b.decimalSymbol,".")),b.autoFormat&&-1!=["money","currency"].indexOf(this.type)&&(a=String(a).replace(b.moneyRE,"")),b.autoFormat&&"percent"==this.type&&(a=String(a).replace(b.percentRE,"")),b.autoFormat&&-1!=["int","float"].indexOf(this.type)&&(a=String(a).replace(b.numberRE,"")),parseFloat(a)==a&&(null!==b.min&&a<b.min&&(a=b.min,d(this.el).val(b.min)),null!==b.max&&
a>b.max&&(a=b.max,d(this.el).val(b.max))),a=""!==a&&w2utils.isFloat(a)?Number(a):"");return a},format:function(a){var b=this.options;if(b.autoFormat&&""!=a)switch(this.type){case "money":case "currency":a=w2utils.formatNumber(Number(a).toFixed(b.currencyPrecision),b.groupSymbol);""!=a&&(a=b.currencyPrefix+a+b.currencySuffix);break;case "percent":a=w2utils.formatNumber(b.precision?Number(a).toFixed(b.precision):a,b.groupSymbol);""!=a&&(a+="%");break;case "float":a=w2utils.formatNumber(b.precision?
Number(a).toFixed(b.precision):a,b.groupSymbol);break;case "int":a=w2utils.formatNumber(a,b.groupSymbol)}return a},change:function(a){var b=this,c=b.options;if(-1!=["int","float","money","currency","percent"].indexOf(this.type)){var f=d(this.el).val(),g=this.format(this.clean(d(this.el).val()));if(""!=f&&f!=g)return d(this.el).val(g).change(),a.stopPropagation(),a.preventDefault(),!1}"color"==this.type&&(a="#"+d(this.el).val(),6!=d(this.el).val().length&&3!=d(this.el).val().length&&(a=""),d(this.el).next().find("div").css("background-color",
a),d(b.el).is(":focus")&&this.updateOverlay());-1!=["list","enum","file"].indexOf(this.type)&&(b.refresh(),setTimeout(function(){b.refresh()},5));-1!=["date","time"].indexOf(this.type)&&(a=parseInt(b.el.value),w2utils.isInt(b.el.value)&&3E3<a&&("time"==this.type&&d(b.el).val(w2utils.formatTime(new Date(a),c.format)).change(),"date"==this.type&&d(b.el).val(w2utils.formatDate(new Date(a),c.format)).change()))},click:function(a){a.stopPropagation();-1!=["list","combo","enum"].indexOf(this.type)&&(d(this.el).is(":focus")||
this.focus(a));-1!=["date","time","color"].indexOf(this.type)&&this.updateOverlay()},focus:function(a){var b=this;if(-1!==["color","date","time"].indexOf(b.type)){if(d(b.el).attr("readonly")||d(b.el).attr("disabled"))return;0<d("#w2ui-overlay").length&&d("#w2ui-overlay")[0].hide();setTimeout(function(){b.updateOverlay()},150)}if(-1!=["list","combo","enum"].indexOf(b.type)){if(d(b.el).attr("readonly")||d(b.el).attr("disabled"))return;0<d("#w2ui-overlay").length&&d("#w2ui-overlay")[0].hide();setTimeout(function(){"list"==
b.type&&d(b.el).is(":focus")?d(b.helpers.focus).find("input").focus():(b.search(),setTimeout(function(){b.updateOverlay()},1))},1)}"file"==b.type&&d(b.helpers.multi).css({outline:"auto 5px #7DB4F3","outline-offset":"-2px"})},blur:function(a){var b=this;a=b.options;var c=d(b.el).val().trim();-1!="color date time list combo enum".split(" ").indexOf(b.type)&&0<d("#w2ui-overlay").length&&d("#w2ui-overlay")[0].hide();-1==["int","float","money","currency","percent"].indexOf(b.type)||""===c||b.checkType(c)||
(d(b.el).val("").change(),!1===a.silent&&(d(b.el).w2tag("Not a valid number"),setTimeout(function(){d(b.el).w2tag("")},3E3)));-1!=["date","time"].indexOf(b.type)&&(""===c||b.inRange(b.el.value)?("date"!=b.type||""===c||w2utils.isDate(b.el.value,a.format)||(d(b.el).val("").removeData("selected").change(),!1===a.silent&&(d(b.el).w2tag("Not a valid date"),setTimeout(function(){d(b.el).w2tag("")},3E3))),"time"!=b.type||""===c||w2utils.isTime(b.el.value)||(d(b.el).val("").removeData("selected").change(),
!1===a.silent&&(d(b.el).w2tag("Not a valid time"),setTimeout(function(){d(b.el).w2tag("")},3E3)))):(d(b.el).val("").removeData("selected").change(),!1===a.silent&&(d(b.el).w2tag("Not in range"),setTimeout(function(){d(b.el).w2tag("")},3E3))));"enum"==b.type&&d(b.helpers.multi).find("input").val("").width(20);"file"==b.type&&d(b.helpers.multi).css({outline:"none"})},keyPress:function(a){var b=this;if(-1!="int float money currency percent hex color alphanumeric".split(" ").indexOf(b.type)){if(a.metaKey||
a.ctrlKey||a.altKey||a.charCode!=a.keyCode&&0<a.keyCode)return;var c=String.fromCharCode(a.charCode);if(!b.checkType(c,!0)&&13!=a.keyCode)return a.preventDefault(),a.stopPropagation?a.stopPropagation():a.cancelBubble=!0,!1}-1!=["date","time"].indexOf(b.type)&&setTimeout(function(){b.updateOverlay()},1)},keyDown:function(a,b){var c=this,f=c.options,g=a.keyCode||b&&b.keyCode;if(-1!=["int","float","money","currency","percent"].indexOf(c.type)){if(!f.keyboard||d(c.el).attr("readonly"))return;var k=!1,
h=parseFloat(d(c.el).val().replace(f.moneyRE,""))||0,l=f.step;if(a.ctrlKey||a.metaKey)l=10;switch(g){case 38:if(a.shiftKey)break;d(c.el).val(h+l<=f.max||null===f.max?Number((h+l).toFixed(12)):f.max).change();k=!0;break;case 40:if(a.shiftKey)break;d(c.el).val(h-l>=f.min||null===f.min?Number((h-l).toFixed(12)):f.min).change();k=!0}k&&(a.preventDefault(),setTimeout(function(){c.el.setSelectionRange(c.el.value.length,c.el.value.length)},0))}if("date"==c.type){if(!f.keyboard||d(c.el).attr("readonly"))return;
var k=!1,m=864E5,l=1;if(a.ctrlKey||a.metaKey)l=10;h=w2utils.isDate(d(c.el).val(),f.format,!0);h||(h=new Date,m=0);switch(g){case 38:if(a.shiftKey)break;k=w2utils.formatDate(h.getTime()+m,f.format);10==l&&(k=w2utils.formatDate(new Date(h.getFullYear(),h.getMonth()+1,h.getDate()),f.format));d(c.el).val(k).change();k=!0;break;case 40:if(a.shiftKey)break;k=w2utils.formatDate(h.getTime()-m,f.format);10==l&&(k=w2utils.formatDate(new Date(h.getFullYear(),h.getMonth()-1,h.getDate()),f.format));d(c.el).val(k).change();
k=!0}k&&(a.preventDefault(),setTimeout(function(){c.el.setSelectionRange(c.el.value.length,c.el.value.length);c.updateOverlay()},0))}if("time"==c.type){if(!f.keyboard||d(c.el).attr("readonly"))return;k=!1;l=a.ctrlKey||a.metaKey?60:1;h=d(c.el).val();h=c.toMin(h)||c.toMin((new Date).getHours()+":"+((new Date).getMinutes()-1));switch(g){case 38:if(a.shiftKey)break;h+=l;k=!0;break;case 40:if(a.shiftKey)break;h-=l;k=!0}k&&(d(c.el).val(c.fromMin(h)).change(),a.preventDefault(),setTimeout(function(){c.el.setSelectionRange(c.el.value.length,
c.el.value.length)},0))}if("color"==c.type){if(d(c.el).attr("readonly"))return;86==a.keyCode&&(a.ctrlKey||a.metaKey)&&(d(c.el).prop("maxlength",7),setTimeout(function(){var a=d(c).val();"#"==a.substr(0,1)&&(a=a.substr(1));w2utils.isHex(a)||(a="");d(c).val(a).prop("maxlength",6).change()},20));if((a.ctrlKey||a.metaKey)&&!a.shiftKey){if("undefined"==typeof c.tmp.cind1)c.tmp.cind1=-1,c.tmp.cind2=-1;else{switch(g){case 38:c.tmp.cind1--;break;case 40:c.tmp.cind1++;break;case 39:c.tmp.cind2++;break;case 37:c.tmp.cind2--}0>
c.tmp.cind1&&(c.tmp.cind1=0);c.tmp.cind1>this.pallete.length-1&&(c.tmp.cind1=this.pallete.length-1);0>c.tmp.cind2&&(c.tmp.cind2=0);c.tmp.cind2>this.pallete[0].length-1&&(c.tmp.cind2=this.pallete[0].length-1)}-1!=[37,38,39,40].indexOf(g)&&(d(c.el).val(this.pallete[c.tmp.cind1][c.tmp.cind2]).change(),a.preventDefault())}}if(-1!=["list","combo","enum"].indexOf(c.type)&&!d(c.el).attr("readonly")){k=!1;l=d(c.el).data("selected");h=d(c.helpers.focus).find("input");"list"==c.type&&-1==[37,38,39,40].indexOf(g)&&
c.refresh();switch(g){case 27:"list"==c.type&&(""!=d(h).val()&&d(h).val(""),a.stopPropagation());break;case 13:if(0==d("#w2ui-overlay").length)break;var m=f.items[f.index],n=d(c.helpers.multi).find("input");if("enum"==c.type){if(null!=m){var p=c.trigger({phase:"before",type:"add",target:c.el,originalEvent:a.originalEvent,item:m});if(!0===p.isCancelled)return;m=p.item;l.length>=f.max&&0<f.max&&l.pop();delete m.hidden;delete c.tmp.force_open;l.push(m);d(c.el).change();n.val("").width(20);c.refresh()}else{m=
{id:n.val(),text:n.val()};p=c.trigger({phase:"before",type:"new",target:c.el,originalEvent:a.originalEvent,item:m});if(!0===p.isCancelled)return;m=p.item;"function"==typeof c.onNew&&(l.length>=f.max&&0<f.max&&l.pop(),delete c.tmp.force_open,l.push(m),d(c.el).change(),n.val("").width(20),c.refresh())}c.trigger(d.extend(p,{phase:"after"}))}else m&&d(c.el).data("selected",m).val(m.text).change(),""==d(c.el).val()&&d(c.el).data("selected")&&d(c.el).removeData("selected").val("").change(),"list"==c.type&&
(h.val(""),c.refresh()),c.tmp.force_hide=!0;break;case 8:case 46:if("enum"==c.type&&8==g&&""==d(c.helpers.multi).find("input").val()&&0<l.length){m=l[l.length-1];p=c.trigger({phase:"before",type:"remove",target:c.el,originalEvent:a.originalEvent,item:m});if(!0===p.isCancelled)return;l.pop();d(c.el).trigger("change");c.refresh();c.trigger(d.extend(p,{phase:"after"}))}"list"==c.type&&""==d(h).val()&&(d(c.el).data("selected",{}).change(),c.refresh());break;case 38:f.index=w2utils.isInt(f.index)?parseInt(f.index):
0;for(f.index--;0<f.index&&f.items[f.index].hidden;)f.index--;if(0==f.index&&f.items[f.index].hidden)for(;f.items[f.index]&&f.items[f.index].hidden;)f.index++;k=!0;break;case 40:f.index=w2utils.isInt(f.index)?parseInt(f.index):-1;for(f.index++;f.index<f.items.length-1&&f.items[f.index].hidden;)f.index++;if(f.index==f.items.length-1&&f.items[f.index].hidden)for(;f.items[f.index]&&f.items[f.index].hidden;)f.index--;l=c.el;-1!=["enum"].indexOf(c.type)&&(l=c.helpers.multi.find("input"));""==d(l).val()&&
0==d("#w2ui-overlay").length?c.tmp.force_open=!0:k=!0}k?(0>f.index&&(f.index=0),f.index>=f.items.length&&(f.index=f.items.length-1),c.updateOverlay(),a.preventDefault(),setTimeout(function(){if("enum"==c.type){var a=c.helpers.multi.find("input").get(0);a.setSelectionRange(a.value.length,a.value.length)}else"list"==c.type?(a=c.helpers.focus.find("input").get(0),a.setSelectionRange(a.value.length,a.value.length)):c.el.setSelectionRange(c.el.value.length,c.el.value.length)},0)):("enum"==c.type&&(l=c.helpers.multi.find("input"),
f=l.val(),l.width(8*(f.length+2)+"px")),-1==[16,17,18,20,37,39,91].indexOf(g)&&setTimeout(function(){c.tmp.force_hide||c.request();c.search()},1))}},keyUp:function(a){"color"==this.type&&86==a.keyCode&&(a.ctrlKey||a.metaKey)&&d(this).prop("maxlength",6)},clearCache:function(){this.options.items=[];this.tmp.xhr_loading=!1;this.tmp.xhr_search="";this.tmp.xhr_total=-1;this.search()},request:function(a){var b=this,c=this.options,f=d(b.el).val()||"";if(c.url){if("enum"==b.type)var g=d(b.helpers.multi).find("input"),
f=0==g.length?"":g.val();"list"==b.type&&(g=d(b.helpers.focus).find("input"),f=0==g.length?"":g.val());0!=c.minLength&&f.length<c.minLength?(c.items=[],this.updateOverlay()):("undefined"==typeof a&&(a=350),"undefined"==typeof b.tmp.xhr_search&&(b.tmp.xhr_search=""),"undefined"==typeof b.tmp.xhr_total&&(b.tmp.xhr_total=-1),c.url&&1!=d(b.el).prop("readonly")&&(0===c.items.length&&0!==b.tmp.xhr_total||b.tmp.xhr_total==c.cacheMax&&f.length>b.tmp.xhr_search.length||f.length>=b.tmp.xhr_search.length&&f.substr(0,
b.tmp.xhr_search.length)!=b.tmp.xhr_search||f.length<b.tmp.xhr_search.length)&&(b.tmp.xhr_loading=!0,b.search(),clearTimeout(b.tmp.timeout),b.tmp.timeout=setTimeout(function(){var a=c.url,g={search:f,max:c.cacheMax};d.extend(g,c.postData);var l=b.trigger({phase:"before",type:"request",target:b.el,url:a,postData:g});!0!==l.isCancelled&&(a=l.url,g=l.postData,b.tmp.xhr&&b.tmp.xhr.abort(),a={type:"GET",url:a,data:g,dataType:"JSON"},"JSON"==w2utils.settings.dataType&&(a.type="POST",a.data=JSON.stringify(a.data),
a.contentType="application/json"),b.tmp.xhr=d.ajax(a).done(function(a,k,l){k=b.trigger({phase:"before",type:"load",target:b.el,search:g.search,data:a,xhr:l});!0!==k.isCancelled&&(a=k.data,"string"==typeof a&&(a=JSON.parse(a)),"success"!=a.status?console.log("ERROR: server did not return proper structure. It should return",{status:"success",items:[{id:1,text:"item"}]}):(a.items.length>c.cacheMax&&a.items.splice(c.cacheMax,1E5),b.tmp.xhr_loading=!1,b.tmp.xhr_search=f,b.tmp.xhr_total=a.items.length,
c.items=b.normMenu(a.items),b.tmp.emptySet=""==f&&0==a.items.length?!0:!1,b.search(),b.trigger(d.extend(k,{phase:"after"}))))}).fail(function(a,c,e){e=b.trigger({phase:"before",type:"error",target:b.el,search:f,error:{status:c,error:e,rawResponseText:a.responseText},xhr:a});if(!0!==e.isCancelled){if("abort"!=c){var g;try{g=d.parseJSON(a.responseText)}catch(h){}console.log("ERROR: Server communication failed.","\n   EXPECTED:",{status:"success",items:[{id:1,text:"item"}]},"\n         OR:",{status:"error",
message:"error message"},"\n   RECEIVED:","object"==typeof g?g:a.responseText)}b.clearCache();b.trigger(d.extend(e,{phase:"after"}))}}),b.trigger(d.extend(l,{phase:"after"})))},a)))}},search:function(){var a=this.options,b=d(this.el).val(),c=this.el,f=[],g=d(this.el).data("selected");if("enum"==this.type){var c=d(this.helpers.multi).find("input"),b=c.val(),k;for(k in g)g[k]&&f.push(g[k].id)}if("list"==this.type)for(k in c=d(this.helpers.focus).find("input"),b=c.val(),g)g[k]&&f.push(g[k].id);c=this.trigger({phase:"before",
type:"search",target:c,search:b});if(!0!==c.isCancelled){if(!0!==this.tmp.xhr_loading){var g=0,h;for(h in a.items){k=a.items[h];var l="",m="";-1!=["is","begins"].indexOf(a.match)&&(l="^");-1!=["is","ends"].indexOf(a.match)&&(m="$");try{(new RegExp(l+b+m,"i")).test(k.text)||"..."==k.text?k.hidden=!1:k.hidden=!0}catch(n){}"enum"==this.type&&-1!=d.inArray(k.id,f)&&(k.hidden=!0);!0!==k.hidden&&g++}if("combo"!=this.type)for(a.index=0;a.items[a.index]&&a.items[a.index].hidden;)a.index++;else a.index=-1;
0>=g&&(a.index=-1);a.spinner=!1;this.updateOverlay();setTimeout(function(){var c=d("#w2ui-overlay").html()||"";a.markSearch&&-1!=c.indexOf("$.fn.w2menuHandler")&&d("#w2ui-overlay").w2marker(b)},1)}else a.items.splice(0,a.cacheMax),a.spinner=!0,this.updateOverlay();this.trigger(d.extend(c,{phase:"after"}))}},updateOverlay:function(){var a=this,b=this.options;if("color"==this.type){if(d(a.el).attr("readonly"))return;0==d("#w2ui-overlay").length?d(a.el).w2overlay(a.getColorHTML()):d("#w2ui-overlay").html(a.getColorHTML());
d("#w2ui-overlay .color").on("mousedown",function(b){var c=d(b.originalEvent.target).attr("name");b=d(b.originalEvent.target).attr("index").split(":");a.tmp.cind1=b[0];a.tmp.cind2=b[1];d(a.el).val(c).change();d(this).html("&#149;")}).on("mouseup",function(){setTimeout(function(){0<d("#w2ui-overlay").length&&d("#w2ui-overlay").removeData("keepOpen")[0].hide()},10)})}if("date"==this.type){if(d(a.el).attr("readonly"))return;0==d("#w2ui-overlay").length&&d(a.el).w2overlay('<div class="w2ui-reset w2ui-calendar" onclick="event.stopPropagation();"></div>',
{css:{"background-color":"#f5f5f5"}});var c,f,g=w2utils.isDate(d(a.el).val(),a.options.format,!0);g&&(c=g.getMonth()+1,f=g.getFullYear());(function l(b,c){d("#w2ui-overlay > div > div").html(a.getMonthHTML(b,c));d("#w2ui-overlay .w2ui-calendar-title").on("mousedown",function(){if(d(this).next().hasClass("w2ui-calendar-jump"))d(this).next().remove();else{var b,c;d(this).after('<div class="w2ui-calendar-jump" style=""></div>');d(this).next().hide().html(a.getYearHTML()).fadeIn(200);setTimeout(function(){d("#w2ui-overlay .w2ui-calendar-jump").find(".w2ui-jump-month, .w2ui-jump-year").on("click",
function(){d(this).hasClass("w2ui-jump-month")&&(d(this).parent().find(".w2ui-jump-month").removeClass("selected"),d(this).addClass("selected"),c=d(this).attr("name"));d(this).hasClass("w2ui-jump-year")&&(d(this).parent().find(".w2ui-jump-year").removeClass("selected"),d(this).addClass("selected"),b=d(this).attr("name"));null!=b&&null!=c&&(d("#w2ui-overlay .w2ui-calendar-jump").fadeOut(100),setTimeout(function(){l(parseInt(c)+1,b)},100))});d("#w2ui-overlay .w2ui-calendar-jump >:last-child").prop("scrollTop",
2E3)},1)}});d("#w2ui-overlay .w2ui-date").on("mousedown",function(){var b=d(this).attr("date");d(a.el).val(b).change();d(this).css({"background-color":"#B6D5FB","border-color":"#aaa"})}).on("mouseup",function(){setTimeout(function(){0<d("#w2ui-overlay").length&&d("#w2ui-overlay").removeData("keepOpen")[0].hide()},10)});d("#w2ui-overlay .previous").on("mousedown",function(){var b=a.options.current.split("/");b[0]=parseInt(b[0])-1;l(b[0],b[1])});d("#w2ui-overlay .next").on("mousedown",function(){var b=
a.options.current.split("/");b[0]=parseInt(b[0])+1;l(b[0],b[1])})})(c,f)}if("time"==this.type){if(d(a.el).attr("readonly"))return;0==d("#w2ui-overlay").length&&d(a.el).w2overlay('<div class="w2ui-reset w2ui-calendar-time" onclick="event.stopPropagation();"></div>',{css:{"background-color":"#fff"}});var k="h24"==this.options.format?!0:!1;d("#w2ui-overlay > div").html(a.getHourHTML());d("#w2ui-overlay .w2ui-time").on("mousedown",function(b){d(this).css({"background-color":"#B6D5FB","border-color":"#aaa"});
b=d(this).attr("hour");d(a.el).val((12<b&&!k?b-12:b)+":00"+(k?"":12>b?" am":" pm")).change()}).on("mouseup",function(){var b=d(this).attr("hour");0<d("#w2ui-overlay").length&&d("#w2ui-overlay")[0].hide();d(a.el).w2overlay('<div class="w2ui-reset w2ui-calendar-time"></div>',{css:{"background-color":"#fff"}});d("#w2ui-overlay > div").html(a.getMinHTML(b));d("#w2ui-overlay .w2ui-time").on("mousedown",function(){d(this).css({"background-color":"#B6D5FB","border-color":"#aaa"});var c=d(this).attr("min");
d(a.el).val((12<b&&!k?b-12:b)+":"+(10>c?0:"")+c+(k?"":12>b?" am":" pm")).change()}).on("mouseup",function(){setTimeout(function(){0<d("#w2ui-overlay").length&&d("#w2ui-overlay").removeData("keepOpen")[0].hide()},10)})})}-1!=["list","combo","enum"].indexOf(this.type)&&(f=c=this.el,"enum"==this.type&&(c=d(this.helpers.multi),f=d(c).find("input")),"list"==this.type&&(f=d(this.helpers.focus).find("input")),d(f).is(":focus")&&(!1===b.openOnFocus&&""==d(f).val()&&!0!==a.tmp.force_open?d().w2overlay():a.tmp.force_hide?
(d().w2overlay(),setTimeout(function(){delete a.tmp.force_hide},1)):(""!=d(f).val()&&delete a.tmp.force_open,0==d("#w2ui-overlay").length&&(b.index=0),g=w2utils.lang("No matches"),null!=b.url&&d(f).val().length<b.minLength&&!0!==a.tmp.emptySet&&(g=b.minLength+" "+w2utils.lang("letters or more...")),null!=b.url&&""==d(f).val()&&!0!==a.tmp.emptySet&&(g=w2utils.lang("Type to search....")),d(c).w2menu("refresh",d.extend(!0,{},b,{search:!1,render:b.renderDrop,maxHeight:b.maxDropHeight,msgNoItems:g,onSelect:function(c){if("enum"==
a.type){var e=d(a.el).data("selected");if(c.item){var f=a.trigger({phase:"before",type:"add",target:a.el,originalEvent:c.originalEvent,item:c.item});!0!==f.isCancelled&&(e.length>=b.max&&0<b.max&&e.pop(),delete c.item.hidden,e.push(c.item),d(a.el).data("selected",e).change(),d(a.helpers.multi).find("input").val("").width(20),a.refresh(),0<d("#w2ui-overlay").length&&d("#w2ui-overlay")[0].hide(),a.trigger(d.extend(f,{phase:"after"})))}}else d(a.el).data("selected",c.item).val(c.item.text).change(),
a.helpers.focus&&a.helpers.focus.find("input").val("")}})))))},inRange:function(a){var b=!1;if("date"==this.type){var c=w2utils.isDate(a,this.options.format,!0);if(c){if(this.options.start||this.options.end){var f="string"==typeof this.options.start?this.options.start:d(this.options.start).val(),g="string"==typeof this.options.end?this.options.end:d(this.options.end).val(),f=w2utils.isDate(f,this.options.format,!0),g=w2utils.isDate(g,this.options.format,!0),c=new Date(c);f||(f=c);g||(g=c);c>=f&&c<=
g&&(b=!0)}else b=!0;this.options.blocked&&-1!=d.inArray(a,this.options.blocked)&&(b=!1)}}"time"==this.type&&(this.options.start||this.options.end?(a=this.toMin(a),c=this.toMin(this.options.start),f=this.toMin(this.options.end),c||(c=a),f||(f=a),a>=c&&a<=f&&(b=!0)):b=!0);return b},checkType:function(a,b){switch(this.type){case "int":if(b&&-1!=["-",this.options.groupSymbol].indexOf(a))break;return w2utils.isInt(a.replace(this.options.numberRE,""));case "percent":a=a.replace(/%/g,"");case "float":if(b&&
-1!=["-",w2utils.settings.decimalSymbol,this.options.groupSymbol].indexOf(a))break;return w2utils.isFloat(a.replace(this.options.numberRE,""));case "money":case "currency":if(b&&-1!=["-",this.options.decimalSymbol,this.options.groupSymbol,this.options.currencyPrefix,this.options.currencySuffix].indexOf(a))break;return w2utils.isFloat(a.replace(this.options.moneyRE,""));case "hex":case "color":return w2utils.isHex(a);case "alphanumeric":return w2utils.isAlphaNumeric(a)}return!0},addPrefix:function(){var a=
this;setTimeout(function(){if("clear"!==a.type){var b;b=d(a.el).data("tmp")||{};b["old-padding-left"]&&d(a.el).css("padding-left",b["old-padding-left"]);b["old-padding-left"]=d(a.el).css("padding-left");d(a.el).data("tmp",b);a.helpers.prefix&&d(a.helpers.prefix).remove();""!==a.options.prefix&&(d(a.el).before('<div class="w2ui-field-helper">'+a.options.prefix+"</div>"),b=d(a.el).prev(),b.css({color:d(a.el).css("color"),"font-family":d(a.el).css("font-family"),"font-size":d(a.el).css("font-size"),
"padding-top":d(a.el).css("padding-top"),"padding-bottom":d(a.el).css("padding-bottom"),"padding-left":d(a.el).css("padding-left"),"padding-right":0,"margin-top":parseInt(d(a.el).css("margin-top"),10)+2+"px","margin-bottom":parseInt(d(a.el).css("margin-bottom"),10)+1+"px","margin-left":d(a.el).css("margin-left"),"margin-right":0}).on("click",function(b){a.options.icon&&"function"==typeof a.onIconClick?(b=a.trigger({phase:"before",type:"iconClick",target:a.el,el:d(this).find("span.w2ui-icon")[0]}),
!0!==b.isCancelled&&a.trigger(d.extend(b,{phase:"after"}))):"list"==a.type?d(a.helpers.focus).find("input").focus():d(a.el).focus()}),d(a.el).css("padding-left",b.width()+parseInt(d(a.el).css("padding-left"),10)+"px"),a.helpers.prefix=b)}},1)},addSuffix:function(){var a=this,b,c;setTimeout(function(){if("clear"!==a.type){var f=d(a.el).data("tmp")||{};f["old-padding-right"]&&d(a.el).css("padding-right",f["old-padding-right"]);f["old-padding-right"]=d(a.el).css("padding-right");d(a.el).data("tmp",f);
c=parseInt(d(a.el).css("padding-right"),10);a.options.arrows&&(a.helpers.arrows&&d(a.helpers.arrows).remove(),d(a.el).after('<div class="w2ui-field-helper" style="border: 1px solid transparent">&nbsp;    <div class="w2ui-field-up" type="up">        <div class="arrow-up" type="up"></div>    </div>    <div class="w2ui-field-down" type="down">        <div class="arrow-down" type="down"></div>    </div></div>'),w2utils.getSize(a.el,"height"),b=d(a.el).next(),b.css({color:d(a.el).css("color"),"font-family":d(a.el).css("font-family"),
"font-size":d(a.el).css("font-size"),height:d(a.el).height()+parseInt(d(a.el).css("padding-top"),10)+parseInt(d(a.el).css("padding-bottom"),10)+"px",padding:0,"margin-top":parseInt(d(a.el).css("margin-top"),10)+1+"px","margin-bottom":0,"border-left":"1px solid silver"}).css("margin-left","-"+(b.width()+parseInt(d(a.el).css("margin-right"),10)+12)+"px").on("mousedown",function(b){function c(){clearTimeout(d("body").data("_field_update_timer"));d("body").off("mouseup",c)}function e(c){d(a.el).focus();
a.keyDown(d.Event("keydown"),{keyCode:"up"==d(b.target).attr("type")?38:40});!1!==c&&d("body").data("_field_update_timer",setTimeout(e,60))}d("body").on("mouseup",c);d("body").data("_field_update_timer",setTimeout(e,700));e(!1)}),c+=b.width()+12,d(a.el).css("padding-right",c+"px"),a.helpers.arrows=b);""!==a.options.suffix&&(a.helpers.suffix&&d(a.helpers.suffix).remove(),d(a.el).after('<div class="w2ui-field-helper">'+a.options.suffix+"</div>"),b=d(a.el).next(),b.css({color:d(a.el).css("color"),"font-family":d(a.el).css("font-family"),
"font-size":d(a.el).css("font-size"),"padding-top":d(a.el).css("padding-top"),"padding-bottom":d(a.el).css("padding-bottom"),"padding-left":"3px","padding-right":d(a.el).css("padding-right"),"margin-top":parseInt(d(a.el).css("margin-top"),10)+2+"px","margin-bottom":parseInt(d(a.el).css("margin-bottom"),10)+1+"px"}).on("click",function(b){"list"==a.type?d(a.helpers.focus).find("input").focus():d(a.el).focus()}),b.css("margin-left","-"+(w2utils.getSize(b,"width")+parseInt(d(a.el).css("margin-right"),
10)+2)+"px"),c+=b.width()+3,d(a.el).css("padding-right",c+"px"),a.helpers.suffix=b)}},1)},addFocus:function(){var a=this;d(a.helpers.focus).remove();var b=d(a.el).attr("tabIndex");b&&-1!=b&&(a.el._tabIndex=b);a.el._tabIndex&&(b=a.el._tabIndex);b='<div class="w2ui-field-helper">    <div class="w2ui-icon icon-search"></div>    <input type="text" autocomplete="off" tabindex="'+b+'"><div>';d(a.el).attr("tabindex",-1).before(b);b=d(a.el).prev();a.helpers.focus=b;b.css({width:d(a.el).width(),"margin-top":d(a.el).css("margin-top"),
"margin-left":parseInt(d(a.el).css("margin-left"))+parseInt(d(a.el).css("padding-left"))+"px","margin-bottom":d(a.el).css("margin-bottom"),"margin-right":d(a.el).css("margin-right")}).find("input").css({cursor:"default",width:"100%",outline:"none",opacity:1,margin:0,border:"1px solid transparent",padding:d(a.el).css("padding-top"),"padding-left":0,"margin-left":0,"background-color":"transparent"});b.find("input").on("click",function(b){0==d("#w2ui-overlay").length&&a.focus(b);b.stopPropagation()}).on("focus",
function(b){d(a.el).css({outline:"auto 5px #7DB4F3","outline-offset":"-2px"});d(this).val("");d(a.el).triggerHandler("focus");b.stopPropagation?b.stopPropagation():b.cancelBubble=!0}).on("blur",function(b){d(a.el).css("outline","none");d(this).val("");a.refresh();d(a.el).triggerHandler("blur");b.stopPropagation?b.stopPropagation():b.cancelBubble=!0}).on("keyup",function(b){a.keyUp(b)}).on("keydown",function(b){a.keyDown(b)}).on("keypress",function(b){a.keyPress(b)});b.on("click",function(a){d(this).find("input").focus()});
a.refresh()},addMulti:function(){var a=this;d(a.helpers.multi).remove();var b="",c="margin-top     : 0px; margin-bottom  : 0px; margin-left    : "+d(a.el).css("margin-left")+"; margin-right   : "+d(a.el).css("margin-right")+"; width          : "+(w2utils.getSize(a.el,"width")-parseInt(d(a.el).css("margin-left"),10)-parseInt(d(a.el).css("margin-right"),10))+"px;";"enum"==a.type&&(b='<div class="w2ui-field-helper w2ui-list" style="'+c+'; box-sizing: border-box">    <div style="padding: 0px; margin: 0px; margin-right: 20px; display: inline-block">    <ul>        <li style="padding-left: 0px; padding-right: 0px" class="nomouse">            <input type="text" style="width: 20px" autocomplete="off" '+
(d(a.el).attr("readonly")?"readonly":"")+">        </li>","    </ul>    </div></div>");"file"==a.type&&(b='<div class="w2ui-field-helper w2ui-list" style="'+c+'; box-sizing: border-box">    <div style="padding: 0px; margin: 0px; margin-right: 20px; display: inline-block">    <ul><li style="padding-left: 0px; padding-right: 0px" class="nomouse"></li></ul>    <input class="file-input" type="file" name="attachment" multiple style="display: none" tabindex="-1">',"    </div></div>");d(a.el).before(b).css({"background-color":"transparent",
"border-color":"transparent"});var f=d(a.el).prev();a.helpers.multi=f;"enum"==a.type&&(d(a.el).attr("tabindex",-1),f.find("input").on("click",function(b){0==d("#w2ui-overlay").length&&a.focus(b);d(a.el).triggerHandler("click")}).on("focus",function(b){d(f).css({outline:"auto 5px #7DB4F3","outline-offset":"-2px"});d(a.el).triggerHandler("focus");b.stopPropagation?b.stopPropagation():b.cancelBubble=!0}).on("blur",function(b){d(f).css("outline","none");d(a.el).triggerHandler("blur");b.stopPropagation?
b.stopPropagation():b.cancelBubble=!0}).on("keyup",function(b){a.keyUp(b)}).on("keydown",function(b){a.keyDown(b)}).on("keypress",function(b){f.find(".w2ui-enum-placeholder").remove();a.keyPress(b)}),f.on("click",function(a){d(this).find("input").focus()}));"file"==a.type&&(d(a.el).css("outline","none"),f.on("click",function(b){d(a.el).focus();d(a.el).attr("readonly")||(a.blur(b),f.find("input").click())}).on("dragenter",function(b){d(a.el).attr("readonly")||d(f).addClass("w2ui-file-dragover")}).on("dragleave",
function(b){d(a.el).attr("readonly")||0==d(b.target).parents(".w2ui-field-helper").length&&d(f).removeClass("w2ui-file-dragover")}).on("drop",function(b){if(!d(a.el).attr("readonly")){d(f).removeClass("w2ui-file-dragover");for(var c=b.originalEvent.dataTransfer.files,e=0,l=c.length;e<l;e++)a.addFile.call(a,c[e]);b.preventDefault();b.stopPropagation()}}).on("dragover",function(a){a.preventDefault();a.stopPropagation()}),f.find("input").on("click",function(a){a.stopPropagation()}).on("change",function(){if("undefined"!==
typeof this.files)for(var b=0,c=this.files.length;b<c;b++)a.addFile.call(a,this.files[b])}));a.refresh()},addFile:function(a){var b=this,c=this.options,f=d(b.el).data("selected"),g={name:a.name,type:a.type,modified:a.lastModifiedDate,size:a.size,content:null},k=0,h=0,l;for(l in f){if(f[l].name==a.name&&f[l].size==a.size)return;k+=f[l].size;h++}var m=b.trigger({phase:"before",type:"add",target:b.el,file:g,total:h,totalSize:k});!0!==m.isCancelled&&(0!==c.maxFileSize&&g.size>c.maxFileSize?(a="Maximum file size is "+
w2utils.size(c.maxFileSize),!1===c.silent&&d(b.el).w2tag(a),console.log("ERROR: "+a)):0!==c.maxSize&&k+g.size>c.maxSize?(a="Maximum total size is "+w2utils.size(c.maxSize),!1===c.silent&&d(b.el).w2tag(a),console.log("ERROR: "+a)):0!==c.max&&h>=c.max?(a="Maximum number of files is "+c.max,!1===c.silent&&d(b.el).w2tag(a),console.log("ERROR: "+a)):(f.push(g),"undefined"!==typeof FileReader?(c=new FileReader,c.onload=function(){return function(a){a=a.target.result;var c=a.indexOf(",");g.content=a.substr(c+
1);b.refresh();d(b.el).trigger("change");b.trigger(d.extend(m,{phase:"after"}))}}(),c.readAsDataURL(a)):(b.refresh(),d(b.el).trigger("change"))))},normMenu:function(a){if(d.isArray(a)){for(var b=0;b<a.length;b++)"string"==typeof a[b]?a[b]={id:a[b],text:a[b]}:("undefined"!=typeof a[b].text&&"undefined"==typeof a[b].id&&(a[b].id=a[b].text),"undefined"==typeof a[b].text&&"undefined"!=typeof a[b].id&&(a[b].text=a[b].id),"undefined"!=typeof a[b].caption&&(a[b].text=a[b].caption));return a}if("object"==
typeof a){var c=[];for(b in a)c.push({id:b,text:a[b]});return c}},getColorHTML:function(){for(var a='<div class="w2ui-color"><table cellspacing="5">',b=0;8>b;b++){for(var a=a+"<tr>",c=0;8>c;c++)a+='<td>    <div class="color" style="background-color: #'+this.pallete[b][c]+';" name="'+this.pallete[b][c]+'" index="'+b+":"+c+'">        '+(d(this.el).val()==this.pallete[b][c]?"&#149;":"&nbsp;")+"    </div></td>";a+="</tr>";2>b&&(a+='<tr><td style="height: 8px" colspan="8"></td></tr>')}return a+"</table></div>"},
getMonthHTML:function(a,b){var c=new Date,d=w2utils.settings.fullmonths,g="31 28 31 30 31 30 31 31 30 31 30 31".split(" "),k=c.getFullYear()+"/"+(Number(c.getMonth())+1)+"/"+c.getDate();b=w2utils.isInt(b)?parseInt(b):c.getFullYear();a=w2utils.isInt(a)?parseInt(a):c.getMonth()+1;12<a&&(a-=12,b++);if(1>a||0===a)a+=12,b--;g[1]=b/4==Math.floor(b/4)?"29":"28";this.options.current=a+"/"+b;for(var c=new Date(b,a-1,1),c=c.getDay(),h=w2utils.settings.shortdays,l="",m=0,n=h.length;m<n;m++)l+="<td>"+h[m]+"</td>";
d='<div class="w2ui-calendar-title title">    <div class="w2ui-calendar-previous previous"> <div></div> </div>    <div class="w2ui-calendar-next next"> <div></div> </div> '+d[a-1]+", "+b+'</div><table class="w2ui-calendar-days" cellspacing="0">    <tr class="w2ui-day-title">'+l+"</tr>    <tr>";for(l=h=1;43>l;l++){if(0===c&&1==l){for(m=0;6>m;m++)d+='<td class="w2ui-day-empty">&nbsp;</td>';l+=6}else if(l<c||h>g[a-1]){d+='<td class="w2ui-day-empty">&nbsp;</td>';0===l%7&&(d+="</tr><tr>");continue}var p=
b+"/"+a+"/"+h,m="";6==l%7&&(m=" w2ui-saturday");0===l%7&&(m=" w2ui-sunday");p==k&&(m+=" w2ui-today");var n=h,r="",u="",p=w2utils.formatDate(p,this.options.format);this.options.colored&&void 0!==this.options.colored[p]&&(tmp=this.options.colored[p].split(":"),u="background-color: "+tmp[0]+";",r="color: "+tmp[1]+";");d+='<td class="'+(this.inRange(p)?"w2ui-date ":"w2ui-blocked")+m+'" style="'+r+u+'" date="'+p+'">'+n+"</td>";if(0===l%7||0===c&&1==l)d+="</tr><tr>";h++}return d+"</tr></table>"},getYearHTML:function(){var a=
w2utils.settings.shortmonths,b="",c="",d;for(d in a)b+='<div class="w2ui-jump-month" name="'+d+'">'+a[d]+"</div>";for(a=1950;2020>=a;a++)c+='<div class="w2ui-jump-year" name="'+a+'">'+a+"</div>";return"<div>"+b+"</div><div>"+c+"</div>"},getHourHTML:function(){for(var a=[],b="h24"==this.options.format?!0:!1,c=0;24>c;c++){var d=(12<=c&&!b?c-12:c)+":00"+(b?"":12>c?" am":" pm");12!=c||b||(d="12:00 pm");a[Math.floor(c/8)]||(a[Math.floor(c/8)]="");var g=this.fromMin(this.toMin(d)),k=this.fromMin(this.toMin(d)+
59);a[Math.floor(c/8)]+='<div class="'+(this.inRange(g)||this.inRange(k)?"w2ui-time ":"w2ui-blocked")+'" hour="'+c+'">'+d+"</div>"}return'<div class="w2ui-calendar-time"><table><tr>    <td>'+a[0]+"</td>    <td>"+a[1]+"</td>    <td>"+a[2]+"</td></tr></table></div>"},getMinHTML:function(a){"undefined"==typeof a&&(a=0);for(var b="h24"==this.options.format?!0:!1,c=[],d=0;60>d;d+=5){var g=(12<a&&!b?a-12:a)+":"+(10>d?0:"")+d+" "+(b?"":12>a?"am":"pm"),k=20>d?0:40>d?1:2;c[k]||(c[k]="");c[k]+='<div class="'+
(this.inRange(g)?"w2ui-time ":"w2ui-blocked")+'" min="'+d+'">'+g+"</div>"}return'<div class="w2ui-calendar-time"><table><tr>    <td>'+c[0]+"</td>    <td>"+c[1]+"</td>    <td>"+c[2]+"</td></tr></table></div>"},toMin:function(a){if("string"!=typeof a)return null;var b=a.split(":");if(2==b.length)b[0]=parseInt(b[0]),b[1]=parseInt(b[1]),-1!=a.indexOf("pm")&&12!=b[0]&&(b[0]+=12);else return null;return 60*b[0]+b[1]},fromMin:function(a){var b="";1440<=a&&(a%=1440);0>a&&(a=1440+a);b=Math.floor(a/60);a=(10>
a%60?"0":"")+a%60;return b=-1!=this.options.format.indexOf("h24")?b+":"+a:(12>=b?b:b-12)+":"+a+" "+(12<=b?"pm":"am")}};d.extend(c.prototype,w2utils.event);w2obj.field=c})(jQuery);
(function(){var d=function(c){this.name=null;this.header="";this.box=null;this.url="";this.routeData={};this.formHTML=this.formURL="";this.recid=this.page=0;this.fields=[];this.actions={};this.record={};this.original={};this.postData={};this.toolbar={};this.tabs={};this.style="";this.focus=0;this.msgNotJSON=w2utils.lang("Return data is not in JSON format.");this.msgAJAXerror=w2utils.lang("AJAX error. See console for more details.");this.msgRefresh=w2utils.lang("Refreshing...");this.msgSaving=w2utils.lang("Saving...");
this.onError=this.onToolbar=this.onAction=this.onDestroy=this.onResize=this.onRefresh=this.onRender=this.onChange=this.onSave=this.onSubmit=this.onValidate=this.onLoad=this.onRequest=null;this.isGenerated=!1;this.last={xhr:null};$.extend(!0,this,w2obj.form,c)};$.fn.w2form=function(c){if("object"!==typeof c&&c){if(w2ui[$(this).attr("name")])return a=w2ui[$(this).attr("name")],a[c].apply(a,Array.prototype.slice.call(arguments,1)),this;console.log("ERROR: Method "+c+" does not exist on jQuery.w2form")}else{var a=
this;if(w2utils.checkName(c,"w2form")){var b=c.record,e=c.original,f=c.fields,g=c.toolbar,k=c.tabs,h=new d(c);$.extend(h,{record:{},original:{},fields:[],tabs:{},toolbar:{},handlers:[]});if($.isArray(k)){$.extend(!0,h.tabs,{tabs:[]});for(var l in k){var m=k[l];"object"===typeof m?h.tabs.tabs.push(m):h.tabs.tabs.push({id:m,caption:m})}}else $.extend(!0,h.tabs,k);$.extend(!0,h.toolbar,g);for(var n in f)g=$.extend(!0,{},f[n]),"undefined"==typeof g.name&&"undefined"!=typeof g.field&&(g.name=g.field),
"undefined"==typeof g.field&&"undefined"!=typeof g.name&&(g.field=g.name),h.fields[n]=g;for(n in b)$.isPlainObject(b[n])?h.record[n]=$.extend(!0,{},b[n]):h.record[n]=b[n];for(n in e)$.isPlainObject(e[n])?h.original[n]=$.extend(!0,{},e[n]):h.original[n]=e[n];0<a.length&&(h.box=a[0]);""!=h.formURL?$.get(h.formURL,function(a){h.formHTML=a;h.isGenerated=!0;if(0!=$(h.box).length||0!=a.length)$(h.box).html(a),h.render(h.box)}):""==h.formHTML&&(0!=$(this).length&&""!=$.trim($(this).html())?h.formHTML=$(this).html():
h.formHTML=h.generateHTML());w2ui[h.name]=h;""==h.formURL&&(-1==String(h.formHTML).indexOf("w2ui-page")&&(h.formHTML='<div class="w2ui-page page-0">'+h.formHTML+"</div>"),$(h.box).html(h.formHTML),h.isGenerated=!0,h.render(h.box));return h}}};d.prototype={get:function(c,a){if(0===arguments.length){var b=[],d;for(d in this.fields)null!=this.fields[d].name&&b.push(this.fields[d].name);return b}for(b in this.fields)if(this.fields[b].name==c)return!0===a?b:this.fields[b];return null},set:function(c,a){for(var b in this.fields)if(this.fields[b].name==
c)return $.extend(this.fields[b],a),this.refresh(),!0;return!1},reload:function(c){("object"!=typeof this.url?this.url:this.url.get)&&0!=this.recid?this.request(c):"function"==typeof c&&c()},clear:function(){this.recid=0;this.record={};$().w2tag();this.refresh()},error:function(c){var a=this.trigger({target:this.name,type:"error",message:c,xhr:this.last.xhr});!0===a.isCancelled?"function"==typeof callBack&&callBack():(setTimeout(function(){w2alert(c,"Error")},1),this.trigger($.extend(a,{phase:"after"})))},
validate:function(c){"undefined"==typeof c&&(c=!0);$().w2tag();var a=[],b;for(b in this.fields){var d=this.fields[b];null==this.record[d.name]&&(this.record[d.name]="");switch(d.type){case "int":this.record[d.name]&&!w2utils.isInt(this.record[d.name])&&a.push({field:d,error:w2utils.lang("Not an integer")});break;case "float":this.record[d.name]&&!w2utils.isFloat(this.record[d.name])&&a.push({field:d,error:w2utils.lang("Not a float")});break;case "money":this.record[d.name]&&!w2utils.isMoney(this.record[d.name])&&
a.push({field:d,error:w2utils.lang("Not in money format")});break;case "color":case "hex":this.record[d.name]&&!w2utils.isHex(this.record[d.name])&&a.push({field:d,error:w2utils.lang("Not a hex number")});break;case "email":this.record[d.name]&&!w2utils.isEmail(this.record[d.name])&&a.push({field:d,error:w2utils.lang("Not a valid email")});break;case "checkbox":this.record[d.name]=1==this.record[d.name]?1:0;break;case "date":d.options.format||(d.options.format=w2utils.settings.date_format),this.record[d.name]&&
!w2utils.isDate(this.record[d.name],d.options.format)&&a.push({field:d,error:w2utils.lang("Not a valid date")+": "+d.options.format})}var f=this.record[d.name];d.required&&(""===f||$.isArray(f)&&0==f.length||$.isPlainObject(f)&&$.isEmptyObject(f))&&a.push({field:d,error:w2utils.lang("Required field")});d.equalto&&this.record[d.name]!=this.record[d.equalto]&&a.push({field:d,error:w2utils.lang("Field should be equal to ")+d.equalto})}b=this.trigger({phase:"before",target:this.name,type:"validate",errors:a});
if(!0!==b.isCancelled){if(c)for(var g in b.errors)c=b.errors[g],"radio"==c.field.type?$($(c.field.el).parents("div")[0]).w2tag(c.error,{"class":"w2ui-error"}):-1!=["enum","file"].indexOf(c.field.type)?function(a){setTimeout(function(){var b=$(a.field.el).data("w2field").helpers.multi;$(a.field.el).w2tag(a.error);$(b).addClass("w2ui-error")},1)}(c):$(c.field.el).w2tag(c.error,{"class":"w2ui-error"}),this["goto"](a[0].field.page);this.trigger($.extend(b,{phase:"after"}));return a}},getChanges:function(){var c=
function(a,b,d){for(var f in a)"object"==typeof a[f]?(d[f]=c(a[f],b[f]||{},{}),d[f]&&!$.isEmptyObject(d[f])||delete d[f]):a[f]!=b[f]&&(d[f]=a[f]);return d};return c(this.record,this.original,{})},request:function(c,a){var b=this;"function"==typeof c&&(a=c,c=null);if("undefined"==typeof c||null==c)c={};if(this.url&&("object"!=typeof this.url||this.url.get)){if(null==this.recid||"undefined"==typeof this.recid)this.recid=0;var d={cmd:"get-record"};d.recid=this.recid;$.extend(d,this.postData);$.extend(d,
c);d=this.trigger({phase:"before",type:"request",target:this.name,url:this.url,postData:d});if(!0===d.isCancelled)"function"==typeof a&&a({status:"error",message:"Request aborted."});else{this.record={};this.original={};this.lock(this.msgRefresh);var f=d.url;"object"==typeof d.url&&d.url.get&&(f=d.url.get);if(this.last.xhr)try{this.last.xhr.abort()}catch(h){}if(!$.isEmptyObject(b.routeData)){var g=w2utils.parseRoute(f);if(0<g.keys.length)for(var k=0;k<g.keys.length;k++)null!=b.routeData[g.keys[k].name]&&
(f=f.replace(new RegExp(":"+g.keys[k].name,"g"),b.routeData[g.keys[k].name]))}f={type:"POST",url:f,data:d.postData,dataType:"text"};"HTTP"==w2utils.settings.dataType&&(f.data=String($.param(f.data,!1)).replace(/%5B/g,"[").replace(/%5D/g,"]"));"RESTFULL"==w2utils.settings.dataType&&(f.type="GET",f.data=String($.param(f.data,!1)).replace(/%5B/g,"[").replace(/%5D/g,"]"));"JSON"==w2utils.settings.dataType&&(f.type="POST",f.data=JSON.stringify(f.data),f.contentType="application/json");this.last.xhr=$.ajax(f).done(function(c,
d,e){b.unlock();var f=b.trigger({phase:"before",target:b.name,type:"load",xhr:e});if(!0===f.isCancelled)"function"==typeof a&&a({status:"error",message:"Request aborted."});else{var g=b.last.xhr.responseText;if("error"!=d){if("undefined"!=typeof g&&""!=g){if("object"==typeof g)c=g;else try{eval("data = "+g)}catch(k){}"undefined"==typeof c&&(c={status:"error",message:b.msgNotJSON,responseText:g});"error"==c.status?b.error(c.message):(b.record=$.extend({},c.record),b.original=$.extend({},c.record))}}else b.error("AJAX Error "+
e.status+": "+e.statusText),c={status:"error",message:b.msgAJAXerror,responseText:g};b.trigger($.extend(f,{phase:"after"}));b.refresh();"function"==typeof a&&a(c)}}).fail(function(a,c,d){d=b.trigger({phase:"before",type:"error",error:{status:c,error:d,rawResponseText:a.responseText},xhr:a});if(!0!==d.isCancelled){if("abort"!=c){var e;try{e=$.parseJSON(a.responseText)}catch(f){}console.log("ERROR: Server communication failed.","\n   EXPECTED:",{status:"success",items:[{id:1,text:"item"}]},"\n         OR:",
{status:"error",message:"error message"},"\n   RECEIVED:","object"==typeof e?e:a.responseText)}b.trigger($.extend(d,{phase:"after"}))}});this.trigger($.extend(d,{phase:"after"}))}}},submit:function(c,a){return this.save(c,a)},save:function(c,a){var b=this;$(this.box).find(":focus").change();"function"==typeof c&&(a=c,c=null);if(0===b.validate(!0).length){if("undefined"==typeof c||null==c)c={};!b.url||"object"==typeof b.url&&!b.url.save?console.log("ERROR: Form cannot be saved because no url is defined."):
(b.lock(b.msgSaving+' <span id="'+b.name+'_progress"></span>'),setTimeout(function(){var d={cmd:"save-record"};d.recid=b.recid;$.extend(d,b.postData);$.extend(d,c);d.record=$.extend(!0,{},b.record);d=b.trigger({phase:"before",type:"submit",target:b.name,url:b.url,postData:d});if(!0!==d.isCancelled){var f=d.url;"object"==typeof d.url&&d.url.save&&(f=d.url.save);if(b.last.xhr)try{b.last.xhr.abort()}catch(h){}if(!$.isEmptyObject(b.routeData)){var g=w2utils.parseRoute(f);if(0<g.keys.length)for(var k=
0;k<g.keys.length;k++)null!=b.routeData[g.keys[k].name]&&(f=f.replace(new RegExp(":"+g.keys[k].name,"g"),b.routeData[g.keys[k].name]))}f={type:"POST",url:f,data:d.postData,dataType:"text",xhr:function(){var a=new window.XMLHttpRequest;a.upload.addEventListener("progress",function(a){a.lengthComputable&&(a=Math.round(a.loaded/a.total*100),$("#"+b.name+"_progress").text(""+a+"%"))},!1);return a}};"HTTP"==w2utils.settings.dataType&&(f.data=String($.param(f.data,!1)).replace(/%5B/g,"[").replace(/%5D/g,
"]"));"RESTFULL"==w2utils.settings.dataType&&(0!=b.recid&&(f.type="PUT"),f.data=String($.param(f.data,!1)).replace(/%5B/g,"[").replace(/%5D/g,"]"));"JSON"==w2utils.settings.dataType&&(f.type="POST",f.data=JSON.stringify(f.data),f.contentType="application/json");b.last.xhr=$.ajax(f).done(function(c,d,e){b.unlock();var f=b.trigger({phase:"before",target:b.name,type:"save",xhr:e,status:d});if(!0!==f.isCancelled){var g=e.responseText;if("error"!=d){if("undefined"!=typeof g&&""!=g){if("object"==typeof g)c=
g;else try{eval("data = "+g)}catch(k){}"undefined"==typeof c&&(c={status:"error",message:b.msgNotJSON,responseText:g});"error"==c.status?b.error(c.message):b.original=$.extend({},b.record)}}else b.error("AJAX Error "+e.status+": "+e.statusText),c={status:"error",message:b.msgAJAXerror,responseText:g};b.trigger($.extend(f,{phase:"after"}));b.refresh();"success"==c.status&&"function"==typeof a&&a(c)}}).fail(function(a,c,d){c={status:c,error:d,rawResponseText:a.responseText};a=b.trigger({phase:"before",
type:"error",error:c,xhr:a});!0!==a.isCancelled&&(console.log("ERROR: server communication failed. The server should return",{status:"success"},"OR",{status:"error",message:"error message"},", instead the AJAX request produced this: ",c),b.trigger($.extend(a,{phase:"after"})))});b.trigger($.extend(d,{phase:"after"}))}},50))}},lock:function(c,a){var b=$(this.box).find("> div:first-child"),d=Array.prototype.slice.call(arguments,0);d.unshift(b);w2utils.lock.apply(window,d)},unlock:function(){var c=this;
setTimeout(function(){w2utils.unlock(c.box)},25)},"goto":function(c){"undefined"!=typeof c&&(this.page=c);!0===$(this.box).data("auto-size")&&$(this.box).height(0);this.refresh()},generateHTML:function(){var c=[],a="",b,d;for(d in this.fields){var f="",g=this.fields[d];"undefined"==typeof g.html&&(g.html={});g.html=$.extend(!0,{caption:"",span:6,attr:"",text:"",page:0},g.html);"undefined"==typeof b&&(b=g.html.page);""==g.html.caption&&(g.html.caption=g.name);var k='<input name="'+g.name+'" type="text" '+
g.html.attr+"/>";if("pass"===g.type||"password"===g.type)k='<input name="'+g.name+'" type = "password" '+g.html.attr+"/>";"checkbox"==g.type&&(k='<input name="'+g.name+'" type="checkbox" '+g.html.attr+"/>");"textarea"==g.type&&(k='<textarea name="'+g.name+'" '+g.html.attr+"></textarea>");"toggle"==g.type&&(k='<input name="'+g.name+'" type="checkbox" '+g.html.attr+' class="w2ui-toggle"/><div><div></div></div>');g.html.group&&(""!=a&&(f+="\n   </div>"),f+='\n   <div class="w2ui-group-title">'+g.html.group+
'</div>\n   <div class="w2ui-group">',a=g.html.group);g.html.page!=b&&""!=a&&(c[c.length-1]+="\n   </div>",a="");f+='\n      <div class="w2ui-field '+("undefined"!=typeof g.html.span?"w2ui-span"+g.html.span:"")+'">\n         <label>'+w2utils.lang(g.html.caption)+"</label>\n         <div>"+k+w2utils.lang(g.html.text)+"</div>\n      </div>";"undefined"==typeof c[g.html.page]&&(c[g.html.page]="");c[g.html.page]+=f;b=g.html.page}""!=a&&(c[c.length-1]+="\n   </div>");if(this.tabs.tabs)for(a=0;a<this.tabs.tabs.length;a++)"undefined"==
typeof c[a]&&(c[a]="");for(var h in c)c[h]='<div class="w2ui-page page-'+h+'">'+c[h]+"\n</div>";h="";if(!$.isEmptyObject(this.actions)){a="";h+='\n<div class="w2ui-buttons">';for(var l in this.actions)a=-1!=["save","update","create"].indexOf(l.toLowerCase())?"btn-green":"",h+='\n    <button name="'+l+'" class="btn '+a+'">'+w2utils.lang(l)+"</button>";h+="\n</div>"}return c.join("")+h},action:function(c,a){var b=this.trigger({phase:"before",target:c,type:"action",originalEvent:a});!0!==b.isCancelled&&
("function"==typeof this.actions[c]&&this.actions[c].call(this,a),this.trigger($.extend(b,{phase:"after"})))},resize:function(){function c(){d.width($(a.box).width()).height($(a.box).height());g.css("top",""!=a.header?w2utils.getSize(f,"height"):0);k.css("top",(""!=a.header?w2utils.getSize(f,"height"):0)+("object"==typeof a.toolbar&&$.isArray(a.toolbar.items)&&0<a.toolbar.items.length?w2utils.getSize(g,"height"):0));h.css("top",(""!=a.header?w2utils.getSize(f,"height"):0)+("object"==typeof a.toolbar&&
$.isArray(a.toolbar.items)&&0<a.toolbar.items.length?w2utils.getSize(g,"height")+5:0)+("object"===typeof a.tabs&&$.isArray(a.tabs.tabs)&&0<a.tabs.tabs.length?w2utils.getSize(k,"height")+5:0));h.css("bottom",0<n.length?w2utils.getSize(n,"height"):0)}var a=this,b=this.trigger({phase:"before",target:this.name,type:"resize"});if(!0!==b.isCancelled){var d=$(this.box).find("> div"),f=$(this.box).find("> div .w2ui-form-header"),g=$(this.box).find("> div .w2ui-form-toolbar"),k=$(this.box).find("> div .w2ui-form-tabs"),
h=$(this.box).find("> div .w2ui-page"),l=$(this.box).find("> div .w2ui-page.page-"+this.page),m=$(this.box).find("> div .w2ui-page.page-"+this.page+" > div"),n=$(this.box).find("> div .w2ui-buttons");c();if(0==parseInt($(this.box).height())||!0===$(this.box).data("auto-size"))$(this.box).height((0<f.length?w2utils.getSize(f,"height"):0)+("object"===typeof this.tabs&&$.isArray(this.tabs.tabs)&&0<this.tabs.tabs.length?w2utils.getSize(k,"height"):0)+("object"==typeof this.toolbar&&$.isArray(this.toolbar.items)&&
0<this.toolbar.items.length?w2utils.getSize(g,"height"):0)+(0<h.length?w2utils.getSize(m,"height")+w2utils.getSize(l,"+height")+12:0)+(0<n.length?w2utils.getSize(n,"height"):0)),$(this.box).data("auto-size",!0);c();a.trigger($.extend(b,{phase:"after"}))}},refresh:function(){var c=(new Date).getTime(),a=this;if(this.box&&this.isGenerated&&"undefined"!=typeof $(this.box).html()){$(this.box).find("input, textarea, select").each(function(b,c){var d="undefined"!=typeof $(c).attr("name")?$(c).attr("name"):
$(c).attr("id");if(d=a.get(d)){var e=$(c).parents(".w2ui-page");if(0<e.length)for(var f=0;100>f;f++)if(e.hasClass("page-"+f)){d.page=f;break}}});var b=this.trigger({phase:"before",target:this.name,type:"refresh",page:this.page});if(!0!==b.isCancelled){$(this.box).find(".w2ui-page").hide();$(this.box).find(".w2ui-page.page-"+this.page).show();$(this.box).find(".w2ui-form-header").html(this.header);"object"===typeof this.tabs&&$.isArray(this.tabs.tabs)&&0<this.tabs.tabs.length?($("#form_"+this.name+
"_tabs").show(),this.tabs.active=this.tabs.tabs[this.page].id,this.tabs.refresh()):$("#form_"+this.name+"_tabs").hide();"object"==typeof this.toolbar&&$.isArray(this.toolbar.items)&&0<this.toolbar.items.length?($("#form_"+this.name+"_toolbar").show(),this.toolbar.refresh()):$("#form_"+this.name+"_toolbar").hide();for(var d in this.fields){var f=this.fields[d];"undefined"==typeof f.name&&"undefined"!=typeof f.field&&(f.name=f.field);"undefined"==typeof f.field&&"undefined"!=typeof f.name&&(f.field=
f.name);f.$el=$(this.box).find('[name="'+String(f.name).replace(/\\/g,"\\\\")+'"]');f.el=f.$el[0];"undefined"==typeof f.el&&console.log('ERROR: Cannot associate field "'+f.name+'" with html control. Make sure html control exists with the same name.');f.el&&(f.el.id=f.name);var g=$(f).data("w2field");g&&g.clear();$(f.$el).off("change").on("change",function(){var b=this.value,c=a.record[this.name]?a.record[this.name]:"",d=a.get(this.name);if(-1!=["list","enum","file"].indexOf(d.type)&&$(this).data("selected")){var e=
$(this).data("selected"),f=a.record[this.name];if($.isArray(e)){var b=[],g;for(g in e)b[g]=$.extend(!0,{},e[g])}$.isPlainObject(e)&&(b=$.extend(!0,{},e));if($.isArray(f))for(g in c=[],f)c[g]=$.extend(!0,{},f[g]);$.isPlainObject(f)&&(c=$.extend(!0,{},f))}-1!=["toggle","checkbox"].indexOf(d.type)&&(b=$(this).prop("checked")?!0:!1);-1!=["int","float","percent","money","currency"].indexOf(d.type)&&(b=$(this).data("w2field").clean(b));if(b!==c)if(c=a.trigger({phase:"before",target:this.name,type:"change",
value_new:b,value_previous:c}),!0===c.isCancelled)$(this).val(a.record[this.name]);else{var h=this.value;"select"==this.type&&(h=this.value);"checkbox"==this.type&&(h=this.checked?!0:!1);"radio"==this.type&&d.$el.each(function(a,b){b.checked&&(h=b.value)});-1!="int float percent money currency list combo enum file toggle".split(" ").indexOf(d.type)&&(h=b);-1!=["enum","file"].indexOf(d.type)&&0<h.length&&(b=$(d.el).data("w2field").helpers.multi,$(b).removeClass("w2ui-error"));a.record[this.name]=h;
a.trigger($.extend(c,{phase:"after"}))}});f.required?$(f.el).parent().parent().addClass("w2ui-required"):$(f.el).parent().parent().removeClass("w2ui-required")}$(this.box).find("button, input[type=button]").each(function(b,c){$(c).off("click").on("click",function(b){var c=this.value;this.id&&(c=this.id);this.name&&(c=this.name);a.action(c,b)})});for(d in this.fields){var f=this.fields[d],k="undefined"!=typeof this.record[f.name]?this.record[f.name]:"";if(f.el)switch(f.type=String(f.type).toLowerCase(),
f.options||(f.options={}),f.type){case "text":case "textarea":case "email":case "pass":case "password":f.el.value=k;break;case "int":case "float":case "money":case "currency":case "percent":case "hex":case "alphanumeric":case "color":case "date":case "time":f.el.value=k;$(f.el).w2field($.extend({},f.options,{type:f.type}));break;case "toggle":w2utils.isFloat(k)&&(k=parseFloat(k));$(f.el).prop("checked",k?!0:!1);this.record[f.name]=k?1:0;break;case "list":case "combo":if("list"==f.type){var g=$.isPlainObject(k)?
k.id:k,h=f.options.items;$.isArray(h)&&0<h.length&&!$.isPlainObject(h[0])&&(f.options.items=w2obj.field.prototype.normMenu(h));for(var l in f.options.items)if(h=f.options.items[l],h.id==g){k=$.extend(!0,{},h);a.record[f.name]=k;break}}else"combo"!=f.type||$.isPlainObject(k)?$.isPlainObject(k)&&"undefined"!=typeof k.text?f.el.value=k.text:f.el.value="":f.el.value=k;$.isPlainObject(k)||(k={});$(f.el).w2field($.extend({},f.options,{type:f.type,selected:k}));break;case "enum":case "file":$.isArray(k)||
(k=[]);$(f.el).w2field($.extend({},f.options,{type:f.type,selected:k}));break;case "select":h=f.options.items;if("undefined"!=typeof h&&0<h.length){h=w2obj.field.prototype.normMenu(h);$(f.el).html("");for(var m in h)$(f.el).append('<option value="'+h[m].id+'">'+h[m].text+"</option")}$(f.el).val(k);break;case "radio":$(f.$el).prop("checked",!1).each(function(a,b){$(b).val()==k&&$(b).prop("checked",!0)});break;case "checkbox":$(f.el).prop("checked",k?!0:!1);break;default:$(f.el).w2field($.extend({},
f.options,{type:f.type}))}}g=$(this.box).find(".w2ui-page");for(l=0;l<g.length;l++)1<$(g[l]).find("> *").length&&$(g[l]).wrapInner("<div></div>");this.trigger($.extend(b,{phase:"after"}));this.resize();return(new Date).getTime()-c}}},render:function(c){function a(){var a=$(d.box).find("input, select, textarea");a.length>d.focus&&a[d.focus].focus()}var b=(new Date).getTime(),d=this;"object"==typeof c&&(0<$(this.box).find("#form_"+this.name+"_tabs").length&&$(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-form").html(""),
this.box=c);if(this.isGenerated&&this.box&&(c=this.trigger({phase:"before",target:this.name,type:"render",box:"undefined"!=typeof c?c:this.box}),!0!==c.isCancelled)){$.isEmptyObject(this.original)&&!$.isEmptyObject(this.record)&&(this.original=$.extend(!0,{},this.record));var f="<div>"+(""!=this.header?'<div class="w2ui-form-header">'+this.header+"</div>":"")+'    <div id="form_'+this.name+'_toolbar" class="w2ui-form-toolbar"></div>    <div id="form_'+this.name+'_tabs" class="w2ui-form-tabs"></div>'+
this.formHTML+"</div>";$(this.box).attr("name",this.name).addClass("w2ui-reset w2ui-form").html(f);0<$(this.box).length&&($(this.box)[0].style.cssText+=this.style);"function"!==typeof this.toolbar.render&&(this.toolbar=$().w2toolbar($.extend({},this.toolbar,{name:this.name+"_toolbar",owner:this})),this.toolbar.on("click",function(a){a=d.trigger({phase:"before",type:"toolbar",target:a.target,originalEvent:a});!0!==a.isCancelled&&d.trigger($.extend(a,{phase:"after"}))}));"object"==typeof this.toolbar&&
"function"==typeof this.toolbar.render&&this.toolbar.render($("#form_"+this.name+"_toolbar")[0]);"function"!==typeof this.tabs.render&&(this.tabs=$().w2tabs($.extend({},this.tabs,{name:this.name+"_tabs",owner:this})),this.tabs.on("click",function(a){d["goto"](this.get(a.target,!0))}));"object"==typeof this.tabs&&"function"==typeof this.tabs.render&&this.tabs.render($("#form_"+this.name+"_tabs")[0]);this.trigger($.extend(c,{phase:"after"}));this.resize();("object"!=typeof this.url?this.url:this.url.get)&&
0!=this.recid?this.request():this.refresh();0==$(".w2ui-layout").length&&(this.tmp_resize=function(a){w2ui[d.name].resize()},$(window).off("resize","body").on("resize","body",this.tmp_resize));setTimeout(function(){d.resize();d.refresh()},150);0<=this.focus&&setTimeout(a,500);return(new Date).getTime()-b}},destroy:function(){var c=this.trigger({phase:"before",target:this.name,type:"destroy"});!0!==c.isCancelled&&("object"==typeof this.toolbar&&this.toolbar.destroy&&this.toolbar.destroy(),"object"==
typeof this.tabs&&this.tabs.destroy&&this.tabs.destroy(),0<$(this.box).find("#form_"+this.name+"_tabs").length&&$(this.box).removeAttr("name").removeClass("w2ui-reset w2ui-form").html(""),delete w2ui[this.name],this.trigger($.extend(c,{phase:"after"})),$(window).off("resize","body"))}};$.extend(d.prototype,w2utils.event);w2obj.form=d})();
